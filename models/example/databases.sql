{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE FABALLEY_DB.maplemonk.CUSTOMER_RETENTION_FabAlley AS SELECT year(Acquisition_date) Acquisition_Year, monthname(Acquisition_date) Acquisition_Month, last_day(Acquisition_date) Year_Month, Acquisition_Marketplace, Acquisition_Product, Marketplace, count(distinct customer_id) total_customers, count(distinct case when Acquisition_marketplace = \'Custom\' then customer_id end) Website_Acquired_Customers, count(distinct case when last_day(Acquisition_Date)=last_day(order_date) then order_id end) total_orders, sum(case when last_day(Acquisition_Date)=last_day(order_date) then Selling_price_inr end) total_sales, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) then customer_id end) mn_c, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) mn_c_website, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) then order_id end) mn_o, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) mn_o_website, sum(case when last_day(Acquisition_Date)<>last_day(order_date) then Selling_price_inr end) mn_s, sum(case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) mn_s_website, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then customer_id end) product_mn_c, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_mn_c_website, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then order_id end) product_mn_o, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_mn_o_website, sum(case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then Selling_price_inr end) product_mn_s, sum(case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_mn_s_website, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then customer_id end) m2_c, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then customer_id end) m3_c, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then customer_id end) m4_c, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then customer_id end) m5_c, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then customer_id end) m6_c, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then customer_id end) m7_c, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then customer_id end) m8_c, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then customer_id end) m9_c, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then customer_id end) m10_c, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then customer_id end) m11_c, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then customer_id end) m12_c, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then order_id end) m2_o, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then order_id end) m3_o, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then order_id end) m4_o, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then order_id end) m5_o, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then order_id end) m6_o, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then order_id end) m7_o, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then order_id end) m8_o, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then order_id end) m9_o, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then order_id end) m10_o, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then order_id end) m11_o, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then order_id end) m12_o, sum(case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m2_s, sum(case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m3_s, sum(case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m4_s, sum(case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m5_s, sum(case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m6_s, sum(case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m7_s, sum(case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m8_s, sum(case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m9_s, sum(case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m10_s, sum(case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m11_s, sum(case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m12_s, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) then customer_id end) product_m2_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) then customer_id end) product_m3_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) then customer_id end) product_m4_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) then customer_id end) product_m5_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) then customer_id end) product_m6_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) then customer_id end) product_m7_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) then customer_id end) product_m8_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) then customer_id end) product_m9_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) then customer_id end) product_m10_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) then customer_id end) product_m11_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) then customer_id end) product_m12_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) then order_id end) product_m2_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) then order_id end) product_m3_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) then order_id end) product_m4_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) then order_id end) product_m5_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) then order_id end) product_m6_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) then order_id end) product_m7_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) then order_id end) product_m8_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) then order_id end) product_m9_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) then order_id end) product_m10_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) then order_id end) product_m11_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) then order_id end) product_m12_o, sum(case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m2_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m3_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m4_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m5_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m6_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m7_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m8_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m9_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m10_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m11_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m12_s, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m2_c_website, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m3_c_website, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m4_c_website, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m5_c_website, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m6_c_website, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m7_c_website, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m8_c_website, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m9_c_website, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m10_c_website, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m11_c_website, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m12_c_website, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m2_o_website, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m3_o_website, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m4_o_website, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m5_o_website, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m6_o_website, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m7_o_website, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m8_o_website, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m9_o_website, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m10_o_website, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m11_o_website, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m12_o_website, sum(case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m2_s_website, sum(case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m3_s_website, sum(case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m4_s_website, sum(case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m5_s_website, sum(case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m6_s_website, sum(case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m7_s_website, sum(case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m8_s_website, sum(case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m9_s_website, sum(case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m10_s_website, sum(case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m11_s_website, sum(case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m12_s_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m2_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m3_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m4_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m5_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m6_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m7_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m8_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m9_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m10_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m11_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m12_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m2_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m3_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m4_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m5_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m6_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m7_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m8_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m9_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m10_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m11_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m12_o_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m2_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m3_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m4_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m5_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m6_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m7_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m8_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m9_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m10_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m11_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m12_s_website from ( select customer_id, order_id, acquisition_product, acquisition_marketplace, Marketplace, product_name_final as product_name, order_date, Selling_price_inr, acquisition_date::date as Acquisition_Date from FABALLEY_DB.maplemonk.Fact_item_Website_FabAlley where customer_id is not null and lower(order_status) <> \'cancelled\' )res group by year(Acquisition_Date), monthname(Acquisition_Date), last_day(Acquisition_Date), acquisition_marketplace, Acquisition_Product, marketplace union all SELECT year(Acquisition_Date) Acquisition_Year, monthname(Acquisition_Date) Acquisition_Month, last_day(Acquisition_Date) Year_Month, Acquisition_Marketplace, Acquisition_Product, \'All\' as marketplace, count(distinct customer_id) total_customers, count(distinct case when lower(Acquisition_marketplace) = \'custom\' then customer_id end) Website_Acquired_Customers, count(distinct case when last_day(Acquisition_Date)=last_day(order_date) then order_id end) total_orders, sum(case when last_day(Acquisition_Date)=last_day(order_date) then Selling_price_inr end) total_sales, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) then customer_id end) mn_c, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) mn_c_website, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) then order_id end) mn_o, count(distinct case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) mn_o_website, sum(case when last_day(Acquisition_Date)<>last_day(order_date) then Selling_price_inr end) mn_s, sum(case when last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) mn_s_website, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then customer_id end) product_mn_c, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_mn_c_website, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then order_id end) product_mn_o, count(distinct case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_mn_o_website, sum(case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) then Selling_price_inr end) product_mn_s, sum(case when acquisition_product=product_name and last_day(Acquisition_Date)<>last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_mn_s_website, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then customer_id end) m2_c, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then customer_id end) m3_c, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then customer_id end) m4_c, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then customer_id end) m5_c, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then customer_id end) m6_c, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then customer_id end) m7_c, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then customer_id end) m8_c, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then customer_id end) m9_c, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then customer_id end) m10_c, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then customer_id end) m11_c, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then customer_id end) m12_c, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then order_id end) m2_o, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then order_id end) m3_o, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then order_id end) m4_o, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then order_id end) m5_o, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then order_id end) m6_o, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then order_id end) m7_o, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then order_id end) m8_o, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then order_id end) m9_o, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then order_id end) m10_o, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then order_id end) m11_o, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then order_id end) m12_o, sum(case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m2_s, sum(case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m3_s, sum(case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m4_s, sum(case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m5_s, sum(case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m6_s, sum(case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m7_s, sum(case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m8_s, sum(case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m9_s, sum(case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m10_s, sum(case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m11_s, sum(case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) m12_s, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) then customer_id end) product_m2_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) then customer_id end) product_m3_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) then customer_id end) product_m4_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) then customer_id end) product_m5_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) then customer_id end) product_m6_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) then customer_id end) product_m7_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) then customer_id end) product_m8_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) then customer_id end) product_m9_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) then customer_id end) product_m10_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) then customer_id end) product_m11_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) then customer_id end) product_m12_c, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) then order_id end) product_m2_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) then order_id end) product_m3_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) then order_id end) product_m4_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) then order_id end) product_m5_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) then order_id end) product_m6_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) then order_id end) product_m7_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) then order_id end) product_m8_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) then order_id end) product_m9_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) then order_id end) product_m10_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) then order_id end) product_m11_o, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) then order_id end) product_m12_o, sum(case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m2_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m3_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m4_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m5_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m6_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m7_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m8_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m9_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m10_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m11_s, sum(case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) then Selling_price_inr end) product_m12_s, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m2_c_website, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m3_c_website, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m4_c_website, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m5_c_website, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m6_c_website, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m7_c_website, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m8_c_website, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m9_c_website, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m10_c_website, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m11_c_website, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) m12_c_website, count(distinct case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m2_o_website, count(distinct case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m3_o_website, count(distinct case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m4_o_website, count(distinct case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m5_o_website, count(distinct case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m6_o_website, count(distinct case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m7_o_website, count(distinct case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m8_o_website, count(distinct case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m9_o_website, count(distinct case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m10_o_website, count(distinct case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m11_o_website, count(distinct case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) m12_o_website, sum(case when last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m2_s_website, sum(case when last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m3_s_website, sum(case when last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m4_s_website, sum(case when last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m5_s_website, sum(case when last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m6_s_website, sum(case when last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m7_s_website, sum(case when last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m8_s_website, sum(case when last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m9_s_website, sum(case when last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m10_s_website, sum(case when last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m11_s_website, sum(case when last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) m12_s_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m2_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m3_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m4_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m5_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m6_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m7_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m8_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m9_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m10_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m11_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then customer_id end) product_m12_c_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m2_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m3_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m4_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m5_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m6_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m7_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m8_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m9_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m10_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m11_o_website, count(distinct case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))= last_day(order_date) and lower(Marketplace) = \'custom\' then order_id end) product_m12_o_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,1,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m2_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,2,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m3_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,3,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m4_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,4,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m5_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,5,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m6_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,6,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m7_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,7,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m8_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,8,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m9_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,9,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m10_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,10,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m11_s_website, sum(case when acquisition_product=product_name and last_day(dateadd(month,11,Acquisition_Date))=last_day(order_date) and lower(Marketplace) = \'custom\' then Selling_price_inr end) product_m12_s_website from ( select customer_id, order_id, acquisition_product, acquisition_marketplace, marketplace, product_name_final as product_name, order_date, Selling_price_inr, acquisition_date::date as Acquisition_Date from FABALLEY_DB.maplemonk.Fact_item_Website_FabAlley where customer_id is not null and lower(order_status) <> \'cancelled\' )res group by year(Acquisition_Date), monthname(Acquisition_Date), last_day(Acquisition_Date), acquisition_marketplace, Acquisition_Product;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from FABALLEY_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        