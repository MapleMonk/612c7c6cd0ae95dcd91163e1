{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table eggozdb.maplemonk.ncr_epm_ppp as select pdate, category, ifnull(processed_eggs,0) processed_eggs, ifnull(procured_eggs,0) procured_eggs, ifnull(clean_eggs,0) clean_eggs, ifnull(processing_ub_hairline,0) processing_ub_hairline, ifnull(processing_ub_chatki,0) processing_ub_chatki, ifnull(processing_ub_dirty,0) processing_ub_dirty, ifnull(processing_ub_smallsize,0) processing_ub_smallsize, ifnull(processing_ub_damage,0) processing_ub_damage, ifnull(processing_ub,0) processing_ub, ifnull(processing_loss_bloodspot,0) processing_loss_bloodspot, ifnull(processing_loss_cleaningloss,0) processing_loss_cleaningloss, ifnull(processing_loss_shortqty,0) processing_loss_shortqty, ifnull(processing_loss_qcsampling,0) processing_loss_qcsampling, ifnull(processing_loss_trayloss,0) processing_loss_trayloss, ifnull(processing_loss,0) processing_loss, ifnull(packaging_loss,0) packaging_loss, ifnull(packaging_ub_chatki,0) packaging_ub_chatki, ifnull(packaging_ub_dirty,0) packaging_ub_dirty, ifnull(packaging_ub,0) packaging_ub, ifnull(pending_eggs_to_pack,0) pending_eggs_to_pack from ( select processing.*, packaging.*, procurement.* from ( select pdate, category, sum(\"Processed Eggs\") as processed_eggs, sum(\"Total Clean Eggs\") as clean_eggs, sum(Hairline) as processing_ub_hairline, sum(Chatki) as processing_ub_chatki, sum(Dirty) as processing_ub_dirty, sum(\"Small size\") as processing_ub_smallsize, sum(\"Damage Qty(in eggs)\") as processing_ub_damage, sum(ub) as processing_ub, sum(Bloodspot) processing_loss_bloodspot, sum(\"Cleaning loss\") as processing_loss_cleaningloss, sum(\"Short Qty(in eggs)\") processing_loss_shortqty, sum(\"QC Sampling\") processing_loss_qcsampling, sum(\"Tray Loss (Farm Loss)\") processing_loss_trayloss, sum(loss) as processing_loss from eggozdb.maplemonk.epm_sheet1 where pdate >= \'2022-08-01\' and pdate is not null group by pdate, category order by pdate desc ) processing full outer join ( select pdate as packaging_date, category as packaging_category, sum(loss) packaging_loss, sum(Chatki) as packaging_ub_chatki, sum(Dirty) as packaging_ub_dirty, sum(\"Packaging UB\") as packaging_ub, sum(\"Pending Eggs\") pending_eggs_to_pack from eggozdb.maplemonk.epm_pkg_loss where pdate >= \'2022-08-01\' and pdate is not null group by pdate, category order by pdate ) packaging on processing.pdate = packaging.packaging_date and processing.category = packaging.packaging_category full outer join ( select logdate procurement_date, category as procurement_category, sum(\"Total eggs\") as procured_eggs from eggozdb.maplemonk.epm_sheet1 where logdate >=\'2022-08-01\' and logdate is not null group by logdate, category order by logdate ) procurement on procurement.procurement_date = processing.pdate and procurement.procurement_category = processing.category ) where pdate is not null ; create or replace table eggozdb.maplemonk.ncr_epm_farm_ppp as select pdate, batch_no, farm_name, category, ifnull(procured_eggs,0) procured_eggs, ifnull(processed_eggs,0) processed_eggs, unprocessed_eggs, ifnull(clean_eggs,0) clean_eggs, ifnull(processing_ub,0) processing_ub, ifnull(processing_loss,0) processing_loss, ifnull(packaging_loss,0) packaging_loss, ifnull(packaging_ub,0) packaging_ub, ifnull(pending_eggs_to_pack,0) pending_eggs_to_pack from ( select processing.pdate, processing.batch_no, processing.farm_name, processing.category, processing.procured_eggs, processing.processed_eggs, processing.unprocessed_eggs, processing.clean_eggs, processing.processing_ub, processing.processing_loss, packaging.packaging_loss, packaging.packaging_ub, packaging.pending_eggs_to_pack from ( select pdate, \"Batch no.\" as batch_no, \"Farm Name\" as farm_name, category, sum(\"Unprocesed Eggs\") as unprocessed_eggs, sum(\"Total eggs\") as procured_eggs, sum(\"Processed Eggs\") as processed_eggs, sum(\"Total Clean Eggs\") as clean_eggs, sum(ub) as processing_ub, sum(loss) as processing_loss from eggozdb.maplemonk.epm_sheet1 where pdate >= \'2022-08-01\' and pdate is not null group by pdate, category, batch_no, farm_name order by pdate desc ) processing full outer join ( select \"Batch No.\" as batch_no, \"Farm Name\" as farm_name, category, sum(loss) packaging_loss, sum(\"Packaging UB\") as packaging_ub, sum(\"Pending Eggs\") pending_eggs_to_pack from eggozdb.maplemonk.epm_pkg_loss where pdate >= \'2022-08-01\' and pdate is not null group by category, batch_no, farm_name ) packaging on processing.batch_no = packaging.batch_no ) where pdate is not null ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from EGGOZDB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        