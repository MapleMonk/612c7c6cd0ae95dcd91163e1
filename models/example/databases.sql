{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table prd_db.beardo.dwh_AVP_FactItems_rkworld as with sales as ( select STARTDATE Date ,ASIN ,SHIPPEDCOGS:\"amount\" Shipped_COGS ,SHIPPEDCOGS:\"currencyCode\" Shipped_COGS_Currency_Code ,ifnull(orderedunits,0) Ordered_Units ,ifnull(shippedunits,0) Shipped_Units ,ifnull(orderedrevenue,0) Ordered_Revenue ,ifnull(customerreturns,0) Customer_Returns ,SHIPPEDREVENUE:\"amount\" Shipped_Revenue ,SHIPPEDREVENUE:\"currencyCode\" Shipped_Revenue_Currency_Code ,\'Sourcing_Retail\' Data_Stream from datalake_db.beardo.trn_rkworld_sourcing_get_vendor_sales_report ), sessions as ( select startdate Date ,ASIN ,ifnull(GLANCEVIEWS,0) GLANCEVIEWS ,\'Sourcing_Retail\' Data_Stream from datalake_db.beardo.trn_rkworld_sourcing_get_vendor_traffic_report ), SKUMASTER AS ( select * from (select asm.skucode ,asm.asin product_id ,Product_name_mapped name ,Product_category_mapped category ,Product_Sub_Category_Mapped sub_category ,row_number() over (partition by product_id order by product_id) rw from (select * from ( select *, row_number() over (partition by asin order by skucode) rw from datalake_db.beardo.mst_amazon_sku_mapping) where rw=1) asm left join (select distinct \"Product Code\" skucode, name Product_name_mapped, BUSINESS Product_category_mapped, \"Category Name\" Product_Sub_Category_Mapped from datalake_db.beardo.mst_mapping_sku_master ) p on asm.skucode = p.skucode ) where rw=1 ) select coalesce(sales.Date, sessions.Date) Date ,coalesce(sales.ASIN, sessions.ASIN) ASIN ,SKUMASTER.SKUCODE SKU ,SKUMASTER.name Product_Name_Final ,SKUMASTER.category Mapped_Category ,SKUMASTER.sub_category Mapped_Sub_Category ,ifnull(SALES.Shipped_COGS,0) Shipped_COGS ,SALES.Shipped_COGS_Currency_Code ,ifnull(SALES.Ordered_Units,0) Ordered_Units ,ifnull(SALES.Shipped_Units,0) Shipped_Units ,ifnull(SALES.Ordered_Revenue,0) Ordered_Revenue ,ifnull(SALES.Customer_Returns,0) Customer_Returns ,ifnull(SALES.Shipped_Revenue,0) Shipped_Revenue ,SALES.Shipped_Revenue_Currency_Code ,coalesce(SALES.Data_Stream, Sessions.Data_stream) Data_stream ,ifnull(SESSIONS.GLANCEVIEWS,0) Glance_views from sales full outer join sessions on Sales.date=sessions.date and sales.ASIN=sessions.ASIN left join SKUMASTER on coalesce(sales.ASIN, sessions.ASIN) = SKUMASTER.product_id; create or replace table prd_db.beardo.dwh_AVP_FactItems_kkoc as with sales as ( select STARTDATE Date ,ASIN ,SHIPPEDCOGS:\"amount\" Shipped_COGS ,SHIPPEDCOGS:\"currencyCode\" Shipped_COGS_Currency_Code ,ifnull(orderedunits,0) Ordered_Units ,ifnull(shippedunits,0) Shipped_Units ,ifnull(orderedrevenue,0) Ordered_Revenue ,ifnull(customerreturns,0) Customer_Returns ,SHIPPEDREVENUE:\"amount\" Shipped_Revenue ,SHIPPEDREVENUE:\"currencyCode\" Shipped_Revenue_Currency_Code ,\'Sourcing_Retail\' Data_Stream from datalake_db.beardo.trn_kkoc_sourcing_get_vendor_sales_report ), sessions as ( select startdate Date ,ASIN ,ifnull(GLANCEVIEWS,0) GLANCEVIEWS ,\'Sourcing_Retail\' Data_Stream from datalake_db.beardo.trn_kkoc_sourcing_get_vendor_traffic_report ), SKUMASTER AS ( select * from (select asm.skucode ,asm.asin product_id ,Product_name_mapped name ,Product_category_mapped category ,Product_Sub_Category_Mapped sub_category ,row_number() over (partition by product_id order by product_id) rw from (select * from ( select *, row_number() over (partition by asin order by skucode) rw from datalake_db.beardo.mst_amazon_sku_mapping) where rw=1) asm left join (select distinct \"Product Code\" skucode, name Product_name_mapped, BUSINESS Product_category_mapped, \"Category Name\" Product_Sub_Category_Mapped from datalake_db.beardo.mst_mapping_sku_master ) p on asm.skucode = p.skucode ) where rw=1 ) select coalesce(sales.Date, sessions.Date) Date ,coalesce(sales.ASIN, sessions.ASIN) ASIN ,SKUMASTER.SKUCODE SKU ,SKUMASTER.name Product_Name_Final ,SKUMASTER.category Mapped_Category ,SKUMASTER.sub_category Mapped_Sub_Category ,ifnull(SALES.Shipped_COGS,0) Shipped_COGS ,SALES.Shipped_COGS_Currency_Code ,ifnull(SALES.Ordered_Units,0) Ordered_Units ,ifnull(SALES.Shipped_Units,0) Shipped_Units ,ifnull(SALES.Ordered_Revenue,0) Ordered_Revenue ,ifnull(SALES.Customer_Returns,0) Customer_Returns ,ifnull(SALES.Shipped_Revenue,0) Shipped_Revenue ,SALES.Shipped_Revenue_Currency_Code ,coalesce(SALES.Data_Stream, Sessions.Data_stream) Data_stream ,ifnull(SESSIONS.GLANCEVIEWS,0) Glance_views from sales full outer join sessions on Sales.date=sessions.date and sales.ASIN=sessions.ASIN left join SKUMASTER on coalesce(sales.ASIN, sessions.ASIN) = SKUMASTER.product_id;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from PRD_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        