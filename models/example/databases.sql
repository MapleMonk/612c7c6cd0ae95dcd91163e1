{{ config(
            materialized='table',
                post_hook={
                    "sql": "CREATE OR REPLACE TABLE MAPLEMONK.PUBLIC.Pickrr_Consolidated AS select *, max(days_from_order) over (partition by tracking_id) as days_to_lateststatus from (select BI.ERR, BI.SKU, I.TO_CITY, I.TO_NAME, I.USER_ID, I.TO_EMAIL, I.TO_STATE, I.FROM_CITY, I.FROM_NAME, I.COD_AMOUNT, I.FROM_EMAIL, I.FROM_STATE, I.TO_ADDRESS, I.TO_PINCODE, I.IS_OPEN_NDR, I.COURIER_NAME, I.FROM_ADDRESS, I.FROM_PINCODE, I.INVOICE_VALUE, I.TO_ADDRESS_ID, I.TO_PHONE_NUMBER, I.FROM_PHONE_NUMBER, I.SOURCE_ADDRESS_ID, BI.LOGO, BI.HEIGHT, BI.IS_COD, BI.LENGTH, S.RECEIVED_BY, S.CURRENT_STATUS_VAL, S.CURRENT_STATUS_BODY, CASE WHEN S.CURRENT_STATUS_TIME='' THEN NULL when right(left(S.CURRENT_STATUS_TIME,3),1) = '-' then TO_Date(S.CURRENT_STATUS_TIME,'DD-MM-YYYY HH24:MI') else TO_Date(S.CURRENT_STATUS_TIME,'DD MON YYYY, HH24:MI') end as CURRENT_STATUS_TIME, S.CURRENT_STATUS_TYPE, S.CURRENT_STATUS_LOCATION, BI.WEIGHT, BI.BREADTH, BI.HSN_CODE, BI.QUANTITY, BI.EDD_STAMP, IL.HSN, IL.NAME, IL.PRICE, IL.TAX_PER, IL.ITEM_NAME, IL.ITEM_HEIGHT, IL.ITEM_LENGTH, IL.ITEM_WEIGHT, IL.ITEM_BREADTH, IL.VARIANT_TITLE, IL.SHIPPING_CHARGE, IL.ITEM_TAX_PERCENTAGE, TA.STATUS_NAME, SA.STATUS_BODY, CASE WHEN SA.STATUS_TIME='' THEN NULL when right(left(SA.STATUS_TIME,3),1) = '-' then TO_Date(SA.STATUS_TIME,'DD-MM-YYYY HH24:MI') else TO_Date(SA.STATUS_TIME,'DD MON YYYY, HH24:MI') end as STATUS_TIME, min( CASE WHEN SA.STATUS_TIME='' THEN NULL when right(left(SA.STATUS_TIME,3),1) = '-' then TO_Date(SA.STATUS_TIME,'DD-MM-YYYY HH24:MI') else TO_Date(SA.STATUS_TIME,'DD MON YYYY, HH24:MI') end) over (partition by tracking_id) as orig_order_time, CASE WHEN SA.STATUS_TIME='' THEN NULL when right(left(SA.STATUS_TIME,3),1) = '-' then TO_Date(SA.STATUS_TIME,'DD-MM-YYYY HH24:MI') else TO_Date(SA.STATUS_TIME,'DD MON YYYY, HH24:MI') end - min( CASE WHEN SA.STATUS_TIME='' THEN NULL when right(left(SA.STATUS_TIME,3),1) = '-' then TO_Date(SA.STATUS_TIME,'DD-MM-YYYY HH24:MI') else TO_Date(SA.STATUS_TIME,'DD MON YYYY, HH24:MI') end) over (partition by tracking_id) as days_from_order, SA.PICKRR_STATUS, SA.STATUS_LOCATION, SA.COURIER_STATUS_CODE, SA.PICKRR_SUB_STATUS_CODE, BI.AUTH_TOKEN, BI.CREATED_AT, BI.IS_REVERSE, BI.ORDER_TYPE, cast(BI.TRACKING_ID as varchar) TRACKING_ID, BI.WEB_ADDRESS, BI.BILLING_ZONE, BI.COMPANY_NAME, BI.COURIER_USED, BI.PRODUCT_NAME, BI.SHOW_DETAILS, BI.DISPATCH_MODE, BI.CLIENT_ORDER_ID, BI.PICKRR_ORDER_ID, BI.CLIENT_EXTRA_VAR, BI.ORDER_CREATED_AT, BI.COURIER_PARENT_NAME, BI.COURIER_TRACKING_ID, BI.COURIER_INPUT_WEIGHT from maplemonk.public.pickrr_get_orders_by_ids BI left join maplemonk.public.pickrr_get_orders_by_ids_info I on I._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID = BI._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID left join maplemonk.public.pickrr_get_orders_by_ids_status S on S._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID = BI._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID left join maplemonk.public.pickrr_get_orders_by_ids_item_list IL on IL._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID = BI._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID left join maplemonk.public.pickrr_get_orders_by_ids_track_ARR TA on TA._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID = BI._AIRBYTE_PICKRR_GET_ORDERS_BY_IDS_HASHID left join maplemonk.public.pickrr_get_orders_by_ids_track_ARR_status_array SA on TA._AIRBYTE_TRACK_ARR_HASHID = SA._AIRBYTE_TRACK_ARR_HASHID ) order by STATUS_TIME asc",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from MapleMonk.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            