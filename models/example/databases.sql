{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table SELECT_DB.MAPLEMONK.SELECT_DB_amazonads_consolidated as with SKUMASTER AS ( select * from (select \"Child SKU\" skucode ,\"Channel ID\" product_id ,\"Channel Name\" Channel_Name ,\"Child category\" name ,\"Channel SKU\" Channel_SKU ,\"Parent SKU\" Parent_SKU ,\"Parent category\" category ,\"Child category\" sub_category ,\"Brand Name\" Brand_Name ,MRP ,SP Selling_Price ,row_number() over (partition by \"Channel ID\" order by 1) rw from SELECT_DB.MAPLEMONK.kyari_sku_master_main where lower(\"Channel Name\") like \'%amazon vc%\' ) where rw=1 ), Sessions as ( with ASPTraffic as (select try_cast(DATAENDTIME as date) Date ,\'AMAZON_SELLER_CENTRAL_KYARI\' Marketplace ,parentasin ASIN ,sum(ifnull(trafficbyasin:\"browserPageViews\",0)) Browser_Page_Views ,sum(ifnull(trafficbyasin:\"browserSessions\",0)) Browser_Sessions ,sum(ifnull(trafficbyasin:\"buyBoxPercentage\",0)) BuyBox_Percentage ,sum(ifnull(trafficbyasin:\"mobileAppPageViews\",0)) MobileApp_Page_Views ,sum(ifnull(trafficbyasin:\"mobileAppSessions\",0)) MobileApp_Sessions ,sum(ifnull(trafficbyasin:\"pageViews\",0)) Page_Views ,sum(ifnull(trafficbyasin:\"sessions\",0)) Sessions ,sum(ifnull(sales.value:\"unitsOrdered\"::float,0)) SC_UnitsOrdered ,sum(ifnull(sales.value:\"totalOrderItems\"::float,0)) SC_ItemsOrdered ,sum(ifnull(sales.value:\"orderedProductSales\":\"amount\"::float,0)) SC_Sales from SELECT_DB.maplemonk.asp_kyari_get_sales_and_traffic_report_asin , lateral flatten (input => salesbyasin) Sales group by try_cast(DATAENDTIME as date), Marketplace, parentasin ) , SKUMASTER AS ( select * from (select \"Child SKU\" skucode ,\"Channel ID\" product_id ,\"Channel Name\" Channel_Name ,\"Child category\" name ,\"Channel SKU\" Channel_SKU ,\"Parent SKU\" Parent_SKU ,\"Parent category\" category ,\"Child category\" sub_category ,\"Brand Name\" Brand_Name ,MRP ,SP Selling_Price ,row_number() over (partition by \"Channel ID\" order by 1) rw from SELECT_DB.MAPLEMONK.kyari_sku_master_main where lower(\"Channel Name\") like \'%amazon vc%\' ) where rw=1 ) select a.* ,upper(b.name) Product_Name_Final ,upper(b.category) Mapped_Product_Category ,upper(b.sub_category) Mapped_Sub_Category ,b.skucode SKU from ASPTRAFFIC a left join SKUMASTER b on a.ASIN = b.product_id and lower(b.channel_name) = \'amazon sc\' ), AdCampaignASINMap as ( select * ,count(ASIN) over (partition by lower(campaign) order by 1) ASIN_COUNT from (select * from (Select campaign ,category ,sub_category ,ASIN ,row_number() over (partition by lower(campaign), lower(ASIN) order by 1) rw from SELECT_DB.MAPLEMONK.amazon_brand_campaign_mapping ) where rw=1 ) ), SPSDASIN as ( select DATE ,ASIN ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(impressions,0) end) SD_IMPRESSIONS ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(impressions,0) end) SP_IMPRESSIONS ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(clicks,0) end) SD_CLICKS ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(clicks,0) end) SP_CLICKS ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(conversions,0) end) SD_AD_conversions ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversions,0) END) AS SP_AD_conversions ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(spend,0) END) AS SD_AD_spend ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(spend,0) END) AS SP_AD_spend ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(adsales,0) END) AS SD_adsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(adsales,0) END) AS SP_adsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(conversionssamesku,0) END) AS SD_AD_conversionssamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversionssamesku,0) END) AS SP_AD_conversionssamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(conversionsothersku,0) END) AS SD_AD_conversionsothersku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversionsothersku,0) END) AS SP_AD_conversionsothersku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(salessamesku,0) END) AS SD_AD_salessamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(salessamesku,0) END) AS SP_AD_salessamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(OTHERSKUSALES,0) END) AS SD_AD_OTHERSKUSALES ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(OTHERSKUSALES,0) END) AS SP_AD_OTHERSKUSALES ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(newtobrandsales,0) END) AS SD_AD_newtobrandsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(newtobrandsales,0) END) AS SP_AD_newtobrandsales ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(newtobrandunits,0) end) as SD_AD_newtobrandunits ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(newtobrandunits,0) end) as SP_AD_newtobrandunits ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(newtobrandorders,0) end) as SD_AD_newtobrandorders ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(newtobrandorders,0) end) as SP_AD_newtobrandorders from SELECT_DB.MAPLEMONK.SELECT_DB_amazonads_marketing where lower(campaign_type) like any (\'%products%\', \'%display%\') group by DATE ,ASIN ), SBSBVCampaigns as ( select A.Date ,A.ASIN ,C.sessions ,case when A.ASIN_COUNT = 1 then 1 else div0(C.sessions,sum(C.sessions) over (partition by A.Date, A.Campaignname)) end as Session_Share ,A.campaignname ,A.CAMPAIGN_TYPE ,A.IMPRESSIONS ,case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(impressions,0) end SB_IMPRESSIONS ,SB_IMPRESSIONS SB_Impressions_Normalized ,(sum(ifnull(SB_IMPRESSIONS,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_IMPRESSIONS_SESSION_SHARE , A.Clicks , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(clicks,0) end SB_CLICKS , SB_CLICKS SB_Clicks_Normalized ,(sum(ifnull(SB_CLICKS,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_CLICKS_SESSION_SHARE , A.Ad_CONVERSIONS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_conversions,0) end SB_AD_CONVERSIONS , SB_AD_CONVERSIONS SB_Ad_Conversions_Normalized ,(sum(ifnull(SB_AD_CONVERSIONS,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_CONVERSIONS_SESSION_SHARE , A.SPEND , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(spend,0) end SB_SPEND , SB_SPEND SB_Spend_Normalized ,(sum(ifnull(SB_SPEND,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_SPEND_SESSION_SHARE , A.AD_Sales , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_sales,0) end SB_AD_SALES , SB_AD_SALES SB_Ad_Sales_Normalized ,(sum(ifnull(SB_AD_SALES,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_SALES_SESSION_SHARE , A.Ad_CONVERSIONSSAMESKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_conversionssamesku,0) end SB_AD_CONVERSIONS_SAME_SKU , SB_AD_CONVERSIONS_SAME_SKU SB_Ad_Conversions_Same_SKU_Normalized ,(sum(ifnull(SB_AD_CONVERSIONS_SAME_SKU,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_CONVERSIONS_SAME_SKU_SESSION_SHARE , A.AD_CONVERSIONOTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_conversionothersku,0) end SB_CONVERSIONOTHERSKU , SB_CONVERSIONOTHERSKU SB_ConversionOtherSKU_Normalized ,(sum(ifnull(SB_CONVERSIONOTHERSKU,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_CONVERSIONOTHERSKU_SESSION_SHARE , A.AD_SalesSAMESKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_salessamesku,0) end SB_SALES_SAMESKU , SB_SALES_SAMESKU SB_Sales_SameSKU_Normalized ,(sum(ifnull(SB_SALES_SAMESKU,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_SALES_SAMESKU_SESSION_SHARE , A.AD_SalesOTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_salesothersku,0) end SB_SALES_OTHERSKU , SB_SALES_OTHERSKU SB_Sales_OtherSKU_Normalized ,(sum(ifnull(SB_SALES_OTHERSKU,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_SALES_OTHERSKU_SESSION_SHARE , A.AD_NEWTOBRAND_ORDERS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_orders,0) end SB_AD_NEWTOBRAND_ORDERS , SB_AD_NEWTOBRAND_ORDERS SB_AD_NEWTOBRAND_ORDERS_Normalized ,(sum(ifnull(SB_AD_NEWTOBRAND_ORDERS,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_NEWTOBRAND_ORDERS_SESSION_SHARE , A.AD_NEWTOBRAND_SALES , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_sales,0) end SB_AD_NEWTOBRAND_SALES , SB_AD_NEWTOBRAND_SALES SB_AD_NEWTOBRAND_SALES_Normalized ,(sum(ifnull(SB_AD_NEWTOBRAND_SALES,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_NEWTOBRAND_SALES_SESSION_SHARE , A.AD_NEWTOBRAND_UNITS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_units,0) end SB_AD_NEWTOBRAND_UNITS , SB_AD_NEWTOBRAND_UNITS SB_AD_NEWTOBRAND_UNITS_Normalized ,(sum(ifnull(SB_AD_NEWTOBRAND_UNITS,0)) over (partition by A.Date, A.Campaignname))*Session_Share as SB_AD_NEWTOBRAND_UNITS_SESSION_SHARE from ( select A.DATE ,A.CAMPAIGN_TYPE ,Upper(A.campaignname) campaignname ,B.ASIN ,max(B.ASIN_COUNT) ASIN_COUNT ,div0(sum(ifnull(impressions,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) IMPRESSIONS ,div0(sum(ifnull(clicks,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) CLICKS ,div0(sum(ifnull(conversions,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) Ad_CONVERSIONS ,div0(sum(ifnull(SPEND,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) SPEND ,div0(sum(ifnull(adsales,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_Sales ,div0(sum(ifnull(conversionssamesku,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) Ad_CONVERSIONSSAMESKU ,div0(sum(ifnull(conversionsothersku,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_CONVERSIONOTHERSKU ,div0(sum(ifnull(salessamesku,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_SalesSAMESKU ,div0(sum(ifnull(OTHERSKUSALES,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_SalesOTHERSKU ,div0(sum(ifnull(newtobrandorders,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_NEWTOBRAND_ORDERS ,div0(sum(ifnull(newtobrandsales,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_NEWTOBRAND_SALES ,div0(sum(ifnull(newtobrandunits,0)),count(1) over (partition by upper(A.campaignname), A.DATE order by 1)) AD_NEWTOBRAND_UNITS from SELECT_DB.MAPLEMONK.SELECT_DB_amazonads_marketing A left join AdCampaignASINMap B on lower(A.campaignname) = lower(B.campaign) where lower(A.campaign_type) like any (\'%brand%\') group by A.DATE ,A.CAMPAIGN_TYPE ,upper(A.campaignname) ,B.ASIN ) A left join sessions C on A.date=C.date and A.ASIN = C.ASIN ), SBSBVASIN_WOALLPRODUCT as ( select Date ,ASIN ,avg(sessions) sessions ,sum(ifnull(SB_Impressions_Normalized,0)) SB_Impressions_Same_Share ,sum(ifnull(SB_Clicks_Normalized,0)) SB_Clicks_Same_Share ,sum(ifnull(SB_Ad_Conversions_Normalized,0)) SB_Ad_Conversions_Same_Share ,sum(ifnull(SB_Spend_Normalized,0)) SB_Spend_Same_Share ,sum(ifnull(SB_Ad_Sales_Normalized,0)) SB_Ad_Sales_Same_Share ,sum(ifnull(SB_Ad_Conversions_Same_SKU_Normalized,0)) SB_Ad_Conversions_Same_SKU_Same_Share ,sum(ifnull(SB_ConversionOtherSKU_Normalized,0)) SB_ConversionOtherSKU_Same_Share ,sum(ifnull(SB_Sales_SameSKU_Normalized,0)) SB_Sales_SameSKU_Same_Share ,sum(ifnull(SB_Sales_OtherSKU_Normalized,0)) SB_Sales_OtherSKU_Same_Share ,sum(ifnull(SB_AD_NEWTOBRAND_ORDERS_Normalized,0)) SB_AD_NEWTOBRAND_ORDERS_Same_Share ,sum(ifnull(SB_AD_NEWTOBRAND_SALES_Normalized,0)) SB_AD_NEWTOBRAND_SALES_Same_Share ,sum(ifnull(SB_AD_NEWTOBRAND_UNITS_Normalized,0)) SB_AD_NEWTOBRAND_UNITS_Same_Share ,sum(ifnull(SB_Impressions_Session_Share,0)) SB_Impressions_Session_Share ,sum(ifnull(SB_Clicks_Session_Share,0)) SB_Clicks_Session_Share ,sum(ifnull(SB_Ad_Conversions_Session_Share,0)) SB_Ad_Conversions_Session_Share ,sum(ifnull(SB_Spend_Session_Share,0)) SB_Spend_Session_Share ,sum(ifnull(SB_Ad_Sales_Session_Share,0)) SB_Ad_Sales_Session_Share ,sum(ifnull(SB_Ad_Conversions_Same_SKU_Session_Share,0)) SB_Ad_Conversions_Same_SKU_Session_Share ,sum(ifnull(SB_ConversionOtherSKU_Session_Share,0)) SB_ConversionOtherSKU_Session_Share ,sum(ifnull(SB_Sales_SameSKU_Session_Share,0)) SB_Sales_SameSKU_Session_Share ,sum(ifnull(SB_Sales_OtherSKU_Session_Share,0)) SB_Sales_OtherSKU_Session_Share ,sum(ifnull(SB_AD_NEWTOBRAND_ORDERS_Session_Share,0)) SB_AD_NEWTOBRAND_ORDERS_Session_Share ,sum(ifnull(SB_AD_NEWTOBRAND_SALES_Session_Share,0)) SB_AD_NEWTOBRAND_SALES_Session_Share ,sum(ifnull(SB_AD_NEWTOBRAND_UNITS_Session_Share,0)) SB_AD_NEWTOBRAND_UNITS_Session_Share from SBSBVCampaigns where asin is not null group by Date ,ASIN ), SBSBVASIN_ALLPRODUCT as ( select Date ,sum(ifnull(SB_Impressions_Normalized,0)) SB_Impressions_ALLPRODUCTS ,sum(ifnull(SB_Clicks_Normalized,0)) SB_Clicks_ALLPRODUCTS ,sum(ifnull(SB_Ad_Conversions_Normalized,0)) SB_Ad_Conversions_ALLPRODUCTS ,sum(ifnull(SB_Spend_Normalized,0)) SB_Spend_ALLPRODUCTS ,sum(ifnull(SB_Ad_Sales_Normalized,0)) SB_Ad_Sales_ALLPRODUCTS ,sum(ifnull(SB_Ad_Conversions_Same_SKU_Normalized,0)) SB_Ad_Conversions_Same_SKU_ALLPRODUCTS ,sum(ifnull(SB_ConversionOtherSKU_Normalized,0)) SB_ConversionOtherSKU_ALLPRODUCTS ,sum(ifnull(SB_Sales_SameSKU_Normalized,0)) SB_Sales_SameSKU_ALLPRODUCTS ,sum(ifnull(SB_Sales_OtherSKU_Normalized,0)) SB_Sales_OtherSKU_ALLPRODUCTS ,sum(ifnull(SB_AD_NEWTOBRAND_ORDERS_Normalized,0)) SB_AD_NEWTOBRAND_ORDERS_ALLPRODUCTS ,sum(ifnull(SB_AD_NEWTOBRAND_SALES_Normalized,0)) SB_AD_NEWTOBRAND_SALES_ALLPRODUCTS ,sum(ifnull(SB_AD_NEWTOBRAND_UNITS_Normalized,0)) SB_AD_NEWTOBRAND_UNITS_ALLPRODUCTS from SBSBVCampaigns where asin is null group by Date ), SBSBVASIN_ALLPRODUCT_FINAL as ( select A.Date ,A.ASIN ,count(1) over (partition by A.Date) countasins ,div0(A.Sessions,sum(A.sessions) over (partition by A.Date)) session_share ,ifnull(B.SB_Impressions_ALLPRODUCTS,0)*Session_Share as SB_Impression_Session_Share ,ifnull(B.SB_Clicks_ALLPRODUCTS,0)*Session_Share as SB_Clicks_Session_Share ,ifnull(B.SB_Ad_Conversions_ALLPRODUCTS,0)*Session_Share as SB_Ad_Conversions_Session_Share ,ifnull(B.SB_Spend_ALLPRODUCTS,0)*Session_Share as SB_Spend_Session_Share ,ifnull(B.SB_Ad_Sales_ALLPRODUCTS,0)*Session_Share as SB_Ad_Sales_Session_Share ,ifnull(B.SB_Ad_Conversions_Same_SKU_ALLPRODUCTS,0)*Session_Share as SB_Ad_Conversions_Same_SKU_Session_Share ,ifnull(B.SB_ConversionOtherSKU_ALLPRODUCTS,0)*Session_Share as SB_ConversionOtherSKU_Session_Share ,ifnull(B.SB_Sales_SameSKU_ALLPRODUCTS,0)*Session_Share as SB_Sales_SameSKU_Session_Share ,ifnull(B.SB_Sales_OtherSKU_ALLPRODUCTS,0)*Session_Share as SB_Sales_OtherSKU_Session_Share ,ifnull(B.SB_AD_NEWTOBRAND_ORDERS_ALLPRODUCTS,0)*Session_Share as SB_AD_NEWTOBRAND_ORDERS_Session_Share ,ifnull(B.SB_AD_NEWTOBRAND_SALES_ALLPRODUCTS,0)*Session_Share as SB_AD_NEWTOBRAND_SALES_Session_Share ,ifnull(B.SB_AD_NEWTOBRAND_UNITS_ALLPRODUCTS,0)*Session_Share as SB_AD_NEWTOBRAND_UNITS_Session_Share ,div0(ifnull(B.SB_Impressions_ALLPRODUCTS,0),countasins) as SB_Impressions_Same_Share ,div0(ifnull(B.SB_Clicks_ALLPRODUCTS,0),countasins) as SB_Clicks_Same_Share ,div0(ifnull(B.SB_Ad_Conversions_ALLPRODUCTS,0),countasins) as SB_Ad_Conversions_Same_Share ,div0(ifnull(B.SB_Spend_ALLPRODUCTS,0),countasins) as SB_Spend_Same_Share ,div0(ifnull(B.SB_Ad_Sales_ALLPRODUCTS,0),countasins) as SB_Ad_Sales_Same_Share ,div0(ifnull(B.SB_Ad_Conversions_Same_SKU_ALLPRODUCTS,0),countasins) as SB_Ad_Conversions_Same_SKU_Same_Share ,div0(ifnull(B.SB_ConversionOtherSKU_ALLPRODUCTS,0),countasins) as SB_ConversionOtherSKU_Same_Share ,div0(ifnull(B.SB_Sales_SameSKU_ALLPRODUCTS,0),countasins) as SB_Sales_SameSKU_Same_Share ,div0(ifnull(B.SB_Sales_OtherSKU_ALLPRODUCTS,0),countasins) as SB_Sales_OtherSKU_Same_Share ,div0(ifnull(B.SB_AD_NEWTOBRAND_ORDERS_ALLPRODUCTS,0),countasins) as SB_AD_NEWTOBRAND_ORDERS_Same_Share ,div0(ifnull(B.SB_AD_NEWTOBRAND_SALES_ALLPRODUCTS,0),countasins) as SB_AD_NEWTOBRAND_SALES_Same_Share ,div0(ifnull(B.SB_AD_NEWTOBRAND_UNITS_ALLPRODUCTS,0),countasins) as SB_AD_NEWTOBRAND_UNITS_Same_Share from Sessions A left join SBSBVASIN_ALLPRODUCT B on A.Date = B.DATE ), SBSBVASIN as ( select coalesce(A.Date, B.date) date ,coalesce(A.ASIN, B.ASIN) ASIN ,B.Session_Share ,(ifnull(A.SB_Impressions_Session_Share,0) + ifnull(B.SB_Impression_Session_Share,0)) as SB_Impression_Session_Share ,(ifnull(A.SB_Clicks_Session_Share,0) + ifnull(B.SB_Clicks_Session_Share,0)) as SB_Clicks_Session_Share ,(ifnull(A.SB_Ad_Conversions_Session_Share,0) + ifnull(B.SB_Ad_Conversions_Session_Share,0)) as SB_Ad_Conversions_Session_Share ,(ifnull(A.SB_Spend_Session_Share,0) + ifnull(B.SB_Spend_Session_Share,0)) as SB_Spend_Session_Share ,(ifnull(A.SB_Ad_Sales_Session_Share,0) + ifnull(B.SB_Ad_Sales_Session_Share,0)) as SB_Ad_Sales_Session_Share ,(ifnull(A.SB_Ad_Conversions_Same_SKU_Session_Share,0) + ifnull(B.SB_Ad_Conversions_Same_SKU_Session_Share,0)) as SB_Ad_Conversions_Same_SKU_Session_Share ,(ifnull(A.SB_ConversionOtherSKU_Session_Share,0) + ifnull(B.SB_ConversionOtherSKU_Session_Share,0)) as SB_ConversionOtherSKU_Session_Share ,(ifnull(A.SB_Sales_SameSKU_Session_Share,0) + ifnull(B.SB_Sales_SameSKU_Session_Share,0)) as SB_Sales_SameSKU_Session_Share ,(ifnull(A.SB_Sales_OtherSKU_Session_Share,0) + ifnull(B.SB_Sales_OtherSKU_Session_Share,0)) as SB_Sales_OtherSKU_Session_Share ,(ifnull(A.SB_AD_NEWTOBRAND_ORDERS_Session_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_ORDERS_Session_Share,0)) as SB_AD_NEWTOBRAND_ORDERS_Session_Share ,(ifnull(A.SB_AD_NEWTOBRAND_SALES_Session_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_SALES_Session_Share,0)) as SB_AD_NEWTOBRAND_SALES_Session_Share ,(ifnull(A.SB_AD_NEWTOBRAND_UNITS_Session_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_UNITS_Session_Share,0)) as SB_AD_NEWTOBRAND_UNITS_Session_Share ,(ifnull(A.SB_Impressions_Same_Share,0) + ifnull(B.SB_Impressions_Same_Share,0)) as SB_Impressions_Same_Share ,(ifnull(A.SB_Clicks_Same_Share,0) + ifnull(B.SB_Clicks_Same_Share,0)) as SB_Clicks_Same_Share ,(ifnull(A.SB_Ad_Conversions_Same_Share,0) + ifnull(B.SB_Ad_Conversions_Same_Share,0)) as SB_Ad_Conversions_Same_Share ,(ifnull(A.SB_Spend_Same_Share,0) + ifnull(B.SB_Spend_Same_Share,0)) as SB_Spend_Same_Share ,(ifnull(A.SB_Ad_Sales_Same_Share,0) + ifnull(B.SB_Ad_Sales_Same_Share,0)) as SB_Ad_Sales_Same_Share ,(ifnull(A.SB_Ad_Conversions_Same_SKU_Same_Share,0) + ifnull(B.SB_Ad_Conversions_Same_SKU_Same_Share,0)) as SB_Ad_Conversions_Same_SKU_Same_Share ,(ifnull(A.SB_ConversionOtherSKU_Same_Share,0) + ifnull(B.SB_ConversionOtherSKU_Same_Share,0)) as SB_ConversionOtherSKU_Same_Share ,(ifnull(A.SB_Sales_SameSKU_Same_Share,0) + ifnull(B.SB_Sales_SameSKU_Same_Share,0)) as SB_Sales_SameSKU_Same_Share ,(ifnull(A.SB_Sales_OtherSKU_Same_Share,0) + ifnull(B.SB_Sales_OtherSKU_Same_Share,0)) as SB_Sales_OtherSKU_Same_Share ,(ifnull(A.SB_AD_NEWTOBRAND_ORDERS_Same_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_ORDERS_Same_Share,0)) as SB_AD_NEWTOBRAND_ORDERS_Same_Share ,(ifnull(A.SB_AD_NEWTOBRAND_SALES_Same_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_SALES_Same_Share,0)) as SB_AD_NEWTOBRAND_SALES_Same_Share ,(ifnull(A.SB_AD_NEWTOBRAND_UNITS_Same_Share,0) + ifnull(B.SB_AD_NEWTOBRAND_UNITS_Same_Share,0)) as SB_AD_NEWTOBRAND_UNITS_Same_Share from SBSBVASIN_WOALLPRODUCT A full outer join SBSBVASIN_ALLPRODUCT_FINAL B on A.date = B.date ) select coalesce(A.Date, B.Date) Date ,coalesce(A.ASIN, B.ASIN) ASIN ,\'AMAZON_SELLER_CENTRAL_KYARI\' Marketplace ,C.Name Product_Name_Final ,C.Category Category ,C.Sub_category Sub_Category ,C.brand_name brand_name ,SD_IMPRESSIONS ,SP_IMPRESSIONS ,SD_CLICKS ,SP_CLICKS ,SD_AD_conversions ,SP_AD_conversions ,SD_AD_spend ,SP_AD_spend ,SD_adsales ,SP_adsales ,SD_AD_conversionssamesku ,SP_AD_conversionssamesku ,SD_AD_conversionsothersku ,SP_AD_conversionsothersku ,SD_AD_salessamesku ,SP_AD_salessamesku ,SD_AD_OTHERSKUSALES ,SP_AD_OTHERSKUSALES ,SD_AD_newtobrandsales ,SP_AD_newtobrandsales ,SD_AD_newtobrandunits ,SP_AD_newtobrandunits ,SD_AD_newtobrandorders ,SP_AD_newtobrandorders ,SB_Impression_Session_Share ,SB_Clicks_Session_Share ,SB_Ad_Conversions_Session_Share ,SB_Spend_Session_Share ,SB_Ad_Sales_Session_Share ,SB_Ad_Conversions_Same_SKU_Session_Share ,SB_ConversionOtherSKU_Session_Share ,SB_Sales_SameSKU_Session_Share ,SB_Sales_OtherSKU_Session_Share ,SB_AD_NEWTOBRAND_ORDERS_Session_Share ,SB_AD_NEWTOBRAND_SALES_Session_Share ,SB_AD_NEWTOBRAND_UNITS_Session_Share ,SB_Impressions_Same_Share ,SB_Clicks_Same_Share ,SB_Ad_Conversions_Same_Share ,SB_Spend_Same_Share ,SB_Ad_Sales_Same_Share ,SB_Ad_Conversions_Same_SKU_Same_Share ,SB_ConversionOtherSKU_Same_Share ,SB_Sales_SameSKU_Same_Share ,SB_Sales_OtherSKU_Same_Share ,SB_AD_NEWTOBRAND_ORDERS_Same_Share ,SB_AD_NEWTOBRAND_SALES_Same_Share ,SB_AD_NEWTOBRAND_UNITS_Same_Share ,(ifnull(SB_Impressions_Same_Share,0) + ifnull(SD_IMPRESSIONS,0) + ifnull(SP_IMPRESSIONS,0)) as Total_IMPRESSIONS_Same_Share ,(ifnull(SB_Clicks_Same_Share,0) + ifnull(SD_CLICKS,0) + ifnull(SP_CLICKS,0)) as Total_CLICKS_Same_Share ,(ifnull(SB_Ad_Conversions_Same_Share,0) + ifnull(SD_AD_conversions,0) + ifnull(SP_AD_conversions,0)) as Total_AD_conversions_Same_Share ,(ifnull(SB_Spend_Same_Share,0) + ifnull(SD_AD_spend,0) + ifnull(SP_AD_spend,0)) as Total_AD_spend_Same_Share ,(ifnull(SB_Ad_Sales_Same_Share,0) + ifnull(SD_adsales,0) + ifnull(SP_adsales,0)) as Total_adsales_Same_Share ,(ifnull(SB_Ad_Conversions_Same_SKU_Same_Share,0) + ifnull(SD_AD_conversionssamesku,0) + ifnull(SP_AD_conversionssamesku,0)) as Total_AD_conversionssamesku_Same_Share ,(ifnull(SB_ConversionOtherSKU_Same_Share,0) + ifnull(SD_AD_conversionsothersku,0) + ifnull(SP_AD_conversionsothersku,0)) as Total_AD_conversionsothersku_Same_Share ,(ifnull(SB_Sales_SameSKU_Same_Share,0) + ifnull(SD_AD_salessamesku,0) + ifnull(SP_AD_salessamesku,0)) as Total_AD_salessamesku_Same_Share ,(ifnull(SB_Sales_OtherSKU_Same_Share,0) + ifnull(SD_AD_OTHERSKUSALES,0) + ifnull(SP_AD_OTHERSKUSALES,0)) as Total_AD_OTHERSKUSALES_Same_Share ,(ifnull(SB_AD_NEWTOBRAND_ORDERS_Same_Share,0) + ifnull(SD_AD_newtobrandsales,0) + ifnull(SP_AD_newtobrandsales,0)) as Total_AD_newtobrandsales_Same_Share ,(ifnull(SB_AD_NEWTOBRAND_SALES_Same_Share,0) + ifnull(SD_AD_newtobrandunits,0) + ifnull(SP_AD_newtobrandunits,0)) as Total_AD_newtobrandunits_Same_Share ,(ifnull(SB_AD_NEWTOBRAND_UNITS_Same_Share,0) + ifnull(SD_AD_newtobrandorders,0) + ifnull(SP_AD_newtobrandorders,0)) as Total_AD_newtobrandorders_Same_Share ,(ifnull(SB_Impression_Session_Share,0) + ifnull(SD_IMPRESSIONS,0) + ifnull(SP_IMPRESSIONS,0)) as Total_IMPRESSIONS_Session_Share ,(ifnull(SB_Clicks_Session_Share,0) + ifnull(SD_CLICKS,0) + ifnull(SP_CLICKS,0)) as Total_CLICKS_Session_Share ,(ifnull(SB_Ad_Conversions_Session_Share,0) + ifnull(SD_AD_conversions,0) + ifnull(SP_AD_conversions,0)) as Total_AD_conversions_Session_Share ,(ifnull(SB_Spend_Session_Share,0) + ifnull(SD_AD_spend,0) + ifnull(SP_AD_spend,0)) as Total_AD_spend_Session_Share ,(ifnull(SB_Ad_Sales_Session_Share,0) + ifnull(SD_adsales,0) + ifnull(SP_adsales,0)) as Total_adsales_Session_Share ,(ifnull(SB_Ad_Conversions_Same_SKU_Session_Share,0) + ifnull(SD_AD_conversionssamesku,0) + ifnull(SP_AD_conversionssamesku,0)) as Total_AD_conversionssamesku_Session_Share ,(ifnull(SB_ConversionOtherSKU_Session_Share,0) + ifnull(SD_AD_conversionsothersku,0) + ifnull(SP_AD_conversionsothersku,0)) as Total_AD_conversionsothersku_Session_Share ,(ifnull(SB_Sales_SameSKU_Session_Share,0) + ifnull(SD_AD_salessamesku,0) + ifnull(SP_AD_salessamesku,0)) as Total_AD_salessamesku_Session_Share ,(ifnull(SB_Sales_OtherSKU_Session_Share,0) + ifnull(SD_AD_OTHERSKUSALES,0) + ifnull(SP_AD_OTHERSKUSALES,0)) as Total_AD_OTHERSKUSALES_Session_Share ,(ifnull(SB_AD_NEWTOBRAND_ORDERS_Session_Share,0) + ifnull(SD_AD_newtobrandsales,0) + ifnull(SP_AD_newtobrandsales,0)) as Total_AD_newtobrandsales_Session_Share ,(ifnull(SB_AD_NEWTOBRAND_SALES_Session_Share,0) + ifnull(SD_AD_newtobrandunits,0) + ifnull(SP_AD_newtobrandunits,0)) as Total_AD_newtobrandunits_Session_Share ,(ifnull(SB_AD_NEWTOBRAND_UNITS_Session_Share,0) + ifnull(SD_AD_newtobrandorders,0) + ifnull(SP_AD_newtobrandorders,0)) as Total_AD_newtobrandorders_Session_Share from SPSDASIN A full outer join SBSBVASIN B on A.Date=B.Date and A.ASIN =B.ASIN left join SKUMASTER C on coalesce(A.ASIN, B.ASIN) = C.product_id;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from SELECT_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        