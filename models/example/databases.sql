{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table hox_db.maplemonk.HOX_BLANKO_Easyecom_Tax_Fact_Items as select o.report_type, o.Company_Name, o.seller_gst, case when b.Reference_Code is not null and b.REASON_FOR_CHANGE = \'Marketplace name\' then trim(NEW_MP_NAME) else trim(o.marketplace) end as marketplace, o.Reference_Code, o.order_type, o.Order_status, o.Invoice_status, o.Report_date, o.Parent_Quantity, o.Quantity, o.SKU, o.component_sku_name, o.Invoice_amount, o.Selling_price, o.absolute_invoice_amount, o.Tax_exclusive_gross, o.Total_tax_amount, o.Shipping_charge, o.Promotion_discount, o.payment_mode, o.Suborder_No from ( select \'Easyecom sale\' as report_type, case when trim(UPPER(\"Company Name\")) in (\'BLANKO GGN\', \'MOJOJOJO CREATORS PVT LTD GGN\') then \'BLANKO GGN\' when trim(upper(\"Company Name\")) in (\'BLANKO BLR\', \'MOJOJOJO CREATORS PVT LTD BLR\') then \'BLANKO BLR\' else \"Company Name\" end as Company_Name, \"Seller GST Num\" as seller_gst, case when \"Reference Code\" = \'HOX_BLANKO_0070_PR\' then \'Shopify\' when right(\"Reference Code\",2) = \'_R\' and lower(\"MP Name\") like \'%shopify%\' then \'Retail Customers\' when lower(\"Reference Code\") like \'%int%\' and lower(\"MP Name\") like \'%retail customer%\' then \'Shopify\' when lower(\"Reference Code\") like \'%b2bsc%\' and not(lower(\"Reference Code\") like any (\'%sample%\',\'%_foc_%\')) then \"MP Name\"||\'_sale\' when lower(\"Reference Code\") like \'od%\' and lower(\"MP Name\") like \'%retail customers%\' then \'Flipkart\' when lower(\"MP Name\") like \'%offline%\' then \'Retail Customers\' else \"MP Name\" end as marketplace, \"Reference Code\" as Reference_Code, case when \"Reference Code\" = \'HOX_BLANKO_0070_PR\' then \'B2C\' else \"Order Type\" end as order_type, \"Order Status\" as Order_status, \"Invoice Status\" as Invoice_status, try_cast(\"Invoice Date\" as timestamp) as Report_date, try_cast(\"Parent Quantity\" as float) as Parent_Quantity, try_cast(\"Item Quantity\" as float) as Quantity, trim(replace(\"Parent SKU\", \'`\', \'\')) as SKU, trim(replace(\"Component SKU\", \'`\', \'\')) as component_sku_name, try_cast(\"Order Invoice Amount\" as float) as Invoice_amount, try_cast(\"Selling Price\" as float) as Selling_price, abs(try_cast(\"Order Invoice Amount\" as float)) as absolute_invoice_amount, try_cast(\"Taxable Value\" as float) as Tax_exclusive_gross, try_cast(\"TAX\" as float) as Total_tax_amount, try_cast(\"Shipping Charge(Excluding Tax)\" as float) as Shipping_charge, try_cast(\"Promotion Discount(Excluding Tax)\" as float) as Promotion_discount, \"Payment Mode\" as payment_mode, \"Suborder No\" as Suborder_No from HOX_DB.MAPLEMONK.easyecom_hox_blanko_tax_sales WHERE \"Reference Code\" not like \'%_DEL_%\' and \"Order Type\" <> \'STN\' union all select \'Easyecom return\' as report_type, case when trim(UPPER(\"Company Name\")) in (\'BLANKO GGN\', \'MOJOJOJO CREATORS PVT LTD GGN\') then \'BLANKO GGN\' when trim(upper(\"Company Name\")) in (\'BLANKO BLR\', \'MOJOJOJO CREATORS PVT LTD BLR\') then \'BLANKO BLR\' else \"Company Name\" end as Company_Name, \"Seller GST Num\" as seller_gst, case when \"Reference Code\" = \'HOX_BLANKO_0070_PR\' then \'Shopify\' when right(\"Reference Code\",2) = \'_R\' and lower(\"MP Name\") like \'%shopify%\' then \'Retail Customers\' when lower(\"Reference Code\") like \'%int%\' and lower(\"MP Name\") like \'%retail customer%\' then \'Shopify\' when lower(\"Reference Code\") like \'%b2bsc%\' and not(lower(\"Reference Code\") like any (\'%sample%\',\'%_foc_%\')) then \"MP Name\"||\'_sale\' when lower(\"Reference Code\") like \'od%\' and lower(\"MP Name\") like \'%retail customers%\' then \'Flipkart\' when lower(\"MP Name\") like \'%offline%\' then \'Retail Customers\' else \"MP Name\" end as marketplace, \"Reference Code\" as Reference_Code, case when \"Reference Code\" = \'HOX_BLANKO_0070_PR\' then \'B2C\' else \"Order Type\" end as order_type, \"Order Status\" as Order_status, \"Invoice Status\" as Invoice_status, try_cast(\"Return Date\" as timestamp) as Report_date, try_cast(\"Parent Quantity\" as float) as Parent_Quantity, try_cast(\"Item Quantity\" as float) as Quantity, trim(replace(\"Parent SKU\", \'`\', \'\')) as SKU, trim(replace(\"Component SKU\", \'`\', \'\')) as component_sku_name, (try_cast(\"Order Invoice Amount\" as float) * -1.00) as Invoice_amount, try_cast(\"Selling Price\" as float) as Selling_price, abs(try_cast(\"Order Invoice Amount\" as float)) as absolute_invoice_amount, try_cast(\"Taxable Value\" as float) as Tax_exclusive_gross, try_cast(\"TAX\" as float) as Total_tax_amount, try_cast(\"Shipping Charge(Excluding Tax)\" as float) as Shipping_charge, try_cast(\"Promotion Discount(Excluding Tax)\" as float) as Promotion_discount, \"Payment Mode\" as payment_mode, \"Suborder No\" as Suborder_No from HOX_DB.MAPLEMONK.easyecom_hox_blanko_tax_returns WHERE \"Reference Code\" not like \'%_DEL_%\' and \"Reference Code\" <> \'Amazon_FBA_Blanko_13\' )as o left join HOX_DB.MAPLEMONK.order_details_changes b on o.Reference_Code = b.Reference_Code",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from HOX_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        