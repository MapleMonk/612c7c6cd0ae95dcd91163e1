{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table connectyai_db.connectyai.pharma_sample_consolidated_metrics as select coalesce(sales.country,patient_share.country,treated_population.country,treated_days.country,compliance.country,price_per_treated_day.country) COUNTRY ,coalesce(sales.CLASS,patient_share.CLASS,treated_population.CLASS,treated_days.CLASS,compliance.CLASS,price_per_treated_day.CLASS) CLASS ,coalesce(sales.MOLECULE,patient_share.MOLECULE,treated_population.MOLECULE,treated_days.MOLECULE,compliance.MOLECULE,price_per_treated_day.MOLECULE) MOLECULE ,coalesce(sales.TYPE_OF_DRUG,patient_share.TYPE_OF_DRUG,treated_population.TYPE_OF_DRUG,treated_days.TYPE_OF_DRUG,compliance.TYPE_OF_DRUG,price_per_treated_day.TYPE_OF_DRUG) TYPE_OF_DRUG ,coalesce(sales.YEAR,patient_share.YEAR,treated_population.YEAR,treated_days.YEAR,compliance.YEAR,price_per_treated_day.YEAR) YEAR ,SALES_IN_USD ,PATIENT_SHARE ,TREATED_POPULATION ,TREATED_DAYS ,COMPLIANCE ,PRICE_PER_TREATED_DAY_IN_USD from connectyai_db.connectyai.Pharma_Sample_Sales_Fact_Items Sales full outer join connectyai_db.connectyai.Pharma_SAMPLE_PATIENT_SHARE_FACT_ITEMS PATIENT_SHARE on SALES.COUNTRY = PATIENT_SHARE.COUNTRY and sales.CLASS = patient_share.CLASS and sales.MOLECULE = patient_share.MOLECULE and sales.TYPE_OF_DRUG = patient_share.TYPE_OF_DRUG and sales.YEAR = patient_share.YEAR full outer join connectyai_db.connectyai.Pharma_SAMPLE_TREATED_POPULATION_FACT_ITEMS TREATED_POPULATION on COALESCE(SALES.COUNTRY, PATIENT_SHARE.COUNTRY) = TREATED_POPULATION.COUNTRY and COALESCE(SALES.CLASS, PATIENT_SHARE.CLASS) = TREATED_POPULATION.CLASS and COALESCE(SALES.MOLECULE, PATIENT_SHARE.MOLECULE) = TREATED_POPULATION.MOLECULE and COALESCE(SALES.TYPE_OF_DRUG, PATIENT_SHARE.TYPE_OF_DRUG) = TREATED_POPULATION.TYPE_OF_DRUG and COALESCE(SALES.YEAR, PATIENT_SHARE.YEAR) = TREATED_POPULATION.YEAR full outer join connectyai_db.connectyai.Pharma_SAMPLE_TREATED_DAYS_FACT_ITEMS TREATED_DAYS on COALESCE(SALES.COUNTRY, PATIENT_SHARE.COUNTRY, TREATED_POPULATION.COUNTRY) = TREATED_DAYS.COUNTRY and COALESCE(SALES.CLASS, PATIENT_SHARE.CLASS, TREATED_POPULATION.CLASS) = TREATED_DAYS.CLASS and COALESCE(SALES.MOLECULE, PATIENT_SHARE.MOLECULE, TREATED_POPULATION.MOLECULE) = TREATED_DAYS.MOLECULE and COALESCE(SALES.TYPE_OF_DRUG, PATIENT_SHARE.TYPE_OF_DRUG, TREATED_POPULATION.TYPE_OF_DRUG) = TREATED_DAYS.TYPE_OF_DRUG and COALESCE(SALES.YEAR, PATIENT_SHARE.YEAR, TREATED_POPULATION.YEAR) = TREATED_DAYS.YEAR full outer join connectyai_db.connectyai.Pharma_SAMPLE_COMPLIANCE_FACT_ITEMS COMPLIANCE on COALESCE(SALES.COUNTRY, PATIENT_SHARE.COUNTRY, TREATED_POPULATION.COUNTRY, TREATED_DAYS.COUNTRY) = COMPLIANCE.COUNTRY and COALESCE(SALES.CLASS, PATIENT_SHARE.CLASS, TREATED_POPULATION.CLASS, TREATED_DAYS.CLASS) = COMPLIANCE.CLASS and COALESCE(SALES.MOLECULE, PATIENT_SHARE.MOLECULE, TREATED_POPULATION.MOLECULE, TREATED_DAYS.MOLECULE) = COMPLIANCE.MOLECULE and COALESCE(SALES.TYPE_OF_DRUG, PATIENT_SHARE.TYPE_OF_DRUG, TREATED_POPULATION.TYPE_OF_DRUG, TREATED_DAYS.TYPE_OF_DRUG) = COMPLIANCE.TYPE_OF_DRUG and COALESCE(SALES.YEAR, PATIENT_SHARE.YEAR, TREATED_POPULATION.YEAR, TREATED_DAYS.YEAR) = COMPLIANCE.YEAR full outer join connectyai_db.connectyai.Pharma_SAMPLE_PRICE_PER_TREATED_DAY_IN_USD_FACT_ITEMS PRICE_PER_TREATED_DAY on COALESCE(SALES.COUNTRY, PATIENT_SHARE.COUNTRY, TREATED_POPULATION.COUNTRY, TREATED_DAYS.COUNTRY,COMPLIANCE.COUNTRY) = PRICE_PER_TREATED_DAY.COUNTRY and COALESCE(SALES.CLASS, PATIENT_SHARE.CLASS, TREATED_POPULATION.CLASS, TREATED_DAYS.CLASS,COMPLIANCE.CLASS) = PRICE_PER_TREATED_DAY.CLASS and COALESCE(SALES.MOLECULE, PATIENT_SHARE.MOLECULE, TREATED_POPULATION.MOLECULE, TREATED_DAYS.MOLECULE,COMPLIANCE.MOLECULE) = PRICE_PER_TREATED_DAY.MOLECULE and COALESCE(SALES.TYPE_OF_DRUG, PATIENT_SHARE.TYPE_OF_DRUG, TREATED_POPULATION.TYPE_OF_DRUG, TREATED_DAYS.TYPE_OF_DRUG,COMPLIANCE.TYPE_OF_DRUG) = PRICE_PER_TREATED_DAY.TYPE_OF_DRUG and COALESCE(SALES.YEAR, PATIENT_SHARE.YEAR, TREATED_POPULATION.YEAR, TREATED_DAYS.YEAR,COMPLIANCE.YEAR) = PRICE_PER_TREATED_DAY.YEAR ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from CONNECTYAI_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        