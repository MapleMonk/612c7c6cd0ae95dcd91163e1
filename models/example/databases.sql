{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table describe table SLEEPYCAT_DB.MAPLEMONK.SLEEPYCAT_DB_AA_Sponsored_Brands_Intermediate_v2 as with brands_keywords as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:adId::int,metric:keywordId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:attributedSales14d::float attributedSales14d ,metric:attributedConversions14d::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:attributedOrdersNewToBrand14d::float attributedOrdersNewToBrand14d ,metric:attributedSalesNewToBrand14d::float attributedSalesNewToBrand14d ,metric:attributedUnitsOrderedNewToBrand14d::float attributedUnitsOrderedNewToBrand14d ,metric:attributedConversions14dSameSKU::float attributedConversions14dSameSKU ,metric:attributedSales14dSameSKU::float attributedSales14dSameSKU ,IFNULL(metric:attributedSales14d::float,0)- IFNULL(metric:attributedSales14dSameSKU::float,0) attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) +IFNULL(metric:clicks::float,0) +IFNULL(metric:cost::float,0) +IFNULL(metric:attributedSales14d::float,0) +IFNULL(metric:attributedConversions14d::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:adId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:keywordId::int, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) desc) as rw from SLEEPYCAT_DB.MAPLEMONK.Amazon_Advertisement_SC_AmazonAds_SPONSORED_BRANDS_REPORT_STREAM where RECORDTYPE = \'keywords\' ) a where rw =1 or tt>0 ), brands_campaigns as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:adId::int,metric:keywordId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:attributedSales14d::float attributedSales14d ,metric:attributedConversions14d::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:attributedOrdersNewToBrand14d::float attributedOrdersNewToBrand14d ,metric:attributedSalesNewToBrand14d::float attributedSalesNewToBrand14d ,metric:attributedUnitsOrderedNewToBrand14d::float attributedUnitsOrderedNewToBrand14d ,metric:attributedConversions14dSameSKU::float attributedConversions14dSameSKU ,metric:attributedSales14dSameSKU::float attributedSales14dSameSKU ,IFNULL(metric:attributedSales14d::float,0)- IFNULL(metric:attributedSales14dSameSKU::float,0) attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) +IFNULL(metric:clicks::float,0) +IFNULL(metric:cost::float,0) +IFNULL(metric:attributedSales14d::float,0) +IFNULL(metric:attributedConversions14d::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:adId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:keywordId::int, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) desc) as rw from SLEEPYCAT_DB.MAPLEMONK.Amazon_Advertisement_SC_AmazonAds_SPONSORED_BRANDS_REPORT_STREAM where RECORDTYPE = \'campaigns\' ) a where rw =1 or tt>0 ) select primary_key ,TO_DATE(REPORTDATE,\'YYYYMMDD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedOrdersNewToBrand14d ,attributedSalesNewToBrand14d ,attributedUnitsOrderedNewToBrand14d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from brands_keywords where rw2=1 union all select primary_key ,TO_DATE(REPORTDATE,\'YYYYMMDD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedOrdersNewToBrand14d ,attributedSalesNewToBrand14d ,attributedUnitsOrderedNewToBrand14d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from brands_campaigns where rw2 = 1 and campaignId not in (select distinct campaignId from brands_keywords) ; create or replace table SLEEPYCAT_DB.MAPLEMONK.SLEEPYCAT_DB_AA_Sponsored_Brands_Video_Intermediate_v2 as with brandVideos_keywords as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:keywordId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:attributedSales14d::float attributedSales14d ,metric:attributedConversions14d::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:attributedConversions14dSameSKU::float attributedConversions14dSameSKU ,metric:attributedSales14dSameSKU::float attributedSales14dSameSKU ,IFNULL(metric:attributedSales14d::float,0)- IFNULL(metric:attributedSales14dSameSKU::float,0) attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:keywordId::int , metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) DESC) as rw from SLEEPYCAT_DB.MAPLEMONK.Amazon_Advertisement_SC_AmazonAds_SPONSORED_BRANDS_VIDEO_REPORT_STREAM where RECORDTYPE = \'keywords\' ) a where rw =1 or tt>0 ), brandVideos_campaigns as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:keywordId::int,metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:attributedSales14d::float attributedSales14d ,metric:attributedConversions14d::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:attributedConversions14dSameSKU::float attributedConversions14dSameSKU ,metric:attributedSales14dSameSKU::float attributedSales14dSameSKU ,IFNULL(metric:attributedSales14d::float,0)- IFNULL(metric:attributedSales14dSameSKU::float,0) attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:keywordId::int , metric:campaignBudgetType::varchar,metric:keywordText::varchar, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:attributedSales14d::float,0) + IFNULL(metric:attributedConversions14d::float,0) DESC) as rw from SLEEPYCAT_DB.MAPLEMONK.Amazon_Advertisement_SC_AmazonAds_SPONSORED_BRANDS_VIDEO_REPORT_STREAM where RECORDTYPE = \'campaigns\' ) a where rw =1 or tt>0 ) select primary_key ,TO_DATE(REPORTDATE,\'YYYYMMDD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from brandVideos_keywords where rw2=1 union all select primary_key ,TO_DATE(REPORTDATE,\'YYYYMMDD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from BRANDVIDEOS_CAMPAIGNS where rw2=1 and campaignid not in (select distinct campaignid from brandVideos_keywords) ; create or replace table SLEEPYCAT_DB.MAPLEMONK.SLEEPYCAT_DB_AA_Sponsored_Brands_Intermediate_V3 as with brandsv3keywords as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:campaignBudgetType::varchar,metric:keywordId::int,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:sales::float attributedSales14d ,metric:purchases::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:newToBrandPurchases14d::float attributedOrdersNewToBrand14d ,metric:newToBrandSales14d::float attributedSalesNewToBrand14d ,metric:newToBrandUnitsSold14d::float attributedUnitsOrderedNewToBrand14d ,null attributedConversions14dSameSKU ,null attributedSales14dSameSKU ,null attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) +IFNULL(metric:clicks::float,0) +IFNULL(metric:cost::float,0) +IFNULL(metric:sales::float,0) +IFNULL(metric:purchases::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:campaignBudgetType::varchar,metric:keywordId::int,metric:keywordText::varchar, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:sales::float,0) + IFNULL(metric:purchases::float,0) desc) as rw from SLEEPYCAT_DB.MAPLEMONK.AMAZON_ADVERTISEMENT_SC_AMAZONADS_SPONSORED_BRANDS_REPORT_STREAM_V3_MM where RECORDTYPE = \'keywords\' ) a where rw =1 or tt>0 ), brandsv3campaigns as ( select * ,row_number()over(partition by primary_key order by _AIRBYTE_EMITTED_AT desc) as rw2 from (select array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:campaignBudgetType::varchar,metric:keywordId::int,metric:keywordText::varchar, metric:matchType::varchar)),\'\') primary_key ,REPORTDATE ,RECORDTYPE ,PROFILEID ,metric:campaignId::int as campaignId ,metric:campaignName::varchar as campaignName ,metric:adGroupId::int adGroupId ,metric:adGroupName::varchar as adGroupName ,metric:campaignStatus::varchar campaignStatus ,metric:campaignBudgetType::varchar campaignBudgetType ,NULL adId ,metric:keywordText::varchar keywordText ,metric:keywordStatus::varchar keywordStatus ,metric:keywordId::int keywordId ,metric:matchType::varchar matchType ,NULL targetId ,NULL targetingType ,NULL targetingExpression ,NULL targetingText ,\'INR\' currency ,NULL asin ,NULL otherAsin ,NULL sku ,metric:impressions::float impressions ,metric:clicks::float clicks ,metric:cost::float cost ,metric:sales::float attributedSales14d ,metric:purchases::float attributedConversions14d ,NULL attributedSales7d ,NULL attributedConversions7d ,metric:newToBrandPurchases14d::float attributedOrdersNewToBrand14d ,metric:newToBrandSales14d::float attributedSalesNewToBrand14d ,metric:newToBrandUnitsSold14d::float attributedUnitsOrderedNewToBrand14d ,null attributedConversions14dSameSKU ,null attributedSales14dSameSKU ,null attributedSales14dOtherSKU ,IFNULL(metric:impressions::float,0) +IFNULL(metric:clicks::float,0) +IFNULL(metric:cost::float,0) +IFNULL(metric:sales::float,0) +IFNULL(metric:purchases::float,0) as tt ,_AIRBYTE_EMITTED_AT ,row_number() over (partition by array_to_string(array_compact(array_construct( REPORTDATE,RECORDTYPE,PROFILEID,metric:campaignId::int,metric:adGroupId::int,metric:campaignBudgetType::varchar,metric:keywordId::int,metric:keywordText::varchar, metric:matchType::varchar)),\'\') order by IFNULL(metric:impressions::float,0) + IFNULL(metric:clicks::float,0) + IFNULL(metric:cost::float,0) + IFNULL(metric:sales::float,0) + IFNULL(metric:purchases::float,0) desc) as rw from SLEEPYCAT_DB.MAPLEMONK.AMAZON_ADVERTISEMENT_SC_AMAZONADS_SPONSORED_BRANDS_REPORT_STREAM_V3_MM where RECORDTYPE = \'campaigns\' ) a where rw =1 or tt>0 ) select primary_key ,TO_DATE(REPORTDATE,\'YYYY-MM-DD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedOrdersNewToBrand14d ,attributedSalesNewToBrand14d ,attributedUnitsOrderedNewToBrand14d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from brandsv3keywords where rw2 =1 union all select primary_key ,TO_DATE(REPORTDATE,\'YYYY-MM-DD\') AS Date ,RECORDTYPE ,PROFILEID ,campaignId ,campaignName ,adGroupId ,adGroupName ,campaignStatus ,campaignBudgetType ,adId ,keywordId ,keywordText ,keywordStatus ,matchType ,targetId ,targetingType ,targetingExpression ,targetingText ,currency ,asin ,otherAsin ,sku ,impressions ,clicks ,cost ,attributedSales14d ,attributedConversions14d ,attributedSales7d ,attributedConversions7d ,attributedOrdersNewToBrand14d ,attributedSalesNewToBrand14d ,attributedUnitsOrderedNewToBrand14d ,attributedConversions14dSameSKU ,attributedSales14dSameSKU ,attributedSales14dOtherSKU ,\'EU\' as region from brandsv3campaigns where rw2 =1 and campaignid not in (select distinct campaignid from brandsv3keywords) ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from SLEEPYCAT_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        