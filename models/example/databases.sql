{{ config(
            materialized='table',
                post_hook={
                    "sql": "CREATE OR REPLACE TABLE VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_fact_items as select \'UAE\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_UAE_fact_items UNION ALL select \'SG\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_SG_fact_items UNION ALL select \'JP\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_JP_fact_items UNION ALL select \'AU\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_AU_fact_items union all select \'CA\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon CA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_CA_fact_items union all select \'IN\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_INDIA_fact_items UNION ALL select \'UK\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon UK MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_UK_fact_items UNION ALL select \'USA\' as REGION ,SHOP_NAME ,ORDER_ID ,ORDER_NAME ,CUSTOMER_ID ,PHONE ,TAGS ,LINE_ITEM_ID ,SKU ,PRODUCT_ID ,CURRENCY ,IS_REFUND ,CITY ,STATE ,PINCODE ,PRODUCT_NAME ,CATEGORY ,ORDER_STATUS ,ORDER_TIMESTAMP ,LINE_ITEM_SALES ,SHIPPING_PRICE ,QUANTITY ,TAX ,TAX_RATE ,DISCOUNT ,DISCOUNT_BEFORE_TAX ,GROSS_SALES_AFTER_TAX ,GROSS_SALES_BEFORE_TAX ,NET_SALES_BEFORE_TAX ,TOTAL_SALES ,SOURCE ,LANDING_UTM_MEDIUM ,LANDING_UTM_SOURCE ,LANDING_UTM_CAMPAIGN ,REFERRING_UTM_MEDIUM ,REFERRING_UTM_SOURCE ,LANDING_UTM_CHANNEL ,REFERRING_UTM_CHANNEL ,FINAL_UTM_CHANNEL ,NEW_CUSTOMER_FLAG ,ACQUISITION_CHANNEL ,ACQUISITION_PRODUCT ,SHIPPING_TAX ,SHIP_PROMOTION_DISCOUNT ,GIFT_WRAP_PRICE ,GIFT_WRAP_TAX ,COMMON_SKU ,PRODUCT_NAME_FINAL ,PRODUCT_CATEGORY ,\"Category_2-Type_of_Tea\" Category_2_Type_of_Tea ,\"Category_3-Type_of_Product\" Category_3_Type_of_Product ,\"Category_4-Pack_type\" Category_4_Pack_type ,\"Mother SKU\" Mother_SKU ,WEIGHT ,\"Amazon USA MSRP\" Amazon_MSRP ,BRAND from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_USA_fact_items ; create or replace table VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_fact_items as select FI.* ,CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.LINE_ITEM_SALES * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.LINE_ITEM_SALES WHEN FI.CURRENCY = \'USD\' THEN FI.LINE_ITEM_SALES * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.LINE_ITEM_SALES * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.LINE_ITEM_SALES * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.LINE_ITEM_SALES * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.LINE_ITEM_SALES * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.LINE_ITEM_SALES * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.LINE_ITEM_SALES * EX.AED_INR END AS LINE_ITEM_SALES_INR, CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.TAX * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.TAX WHEN FI.CURRENCY = \'USD\' THEN FI.TAX * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.TAX * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.TAX * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.TAX * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.TAX * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.TAX * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.TAX * EX.AED_INR END AS TAX_INR, CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.DISCOUNT * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.DISCOUNT WHEN FI.CURRENCY = \'USD\' THEN FI.DISCOUNT * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.DISCOUNT * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.DISCOUNT * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.DISCOUNT * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.DISCOUNT * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.DISCOUNT * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.DISCOUNT * EX.AED_INR END AS DISCOUNT_INR, CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.TOTAL_SALES * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.TOTAL_SALES WHEN FI.CURRENCY = \'USD\' THEN FI.TOTAL_SALES * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.TOTAL_SALES * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.TOTAL_SALES * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.TOTAL_SALES * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.TOTAL_SALES * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.TOTAL_SALES * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.TOTAL_SALES * EX.AED_INR END AS TOTAL_SALES_INR, CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.TOTAL_SALES * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.TOTAL_SALES WHEN FI.CURRENCY = \'USD\' THEN FI.TOTAL_SALES * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.TOTAL_SALES * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.TOTAL_SALES * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.TOTAL_SALES * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.TOTAL_SALES * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.TOTAL_SALES * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.TOTAL_SALES * EX.AED_INR END AS SUBTOTAL_PRICE_INR, CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.SHIPPING_PRICE * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.SHIPPING_PRICE WHEN FI.CURRENCY = \'USD\' THEN FI.SHIPPING_PRICE * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.SHIPPING_PRICE * EX.GBP_INR WHEN FI.CURRENCY = \'AUS\' THEN FI.SHIPPING_PRICE * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.SHIPPING_PRICE * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.SHIPPING_PRICE * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.SHIPPING_PRICE * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.SHIPPING_PRICE * EX.AED_INR END AS SHIPPING_PRICE_INR from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_amazon_fact_items FI LEFT JOIN( SELECT date, RATES:INR AS EUR_INR, (RATES:EUR/RATES:USD)*RATES:INR AS USD_INR, (RATES:EUR/RATES:GBP)*RATES:INR AS GBP_INR, (RATES:EUR/RATES:AUD)*RATES:INR AS AUD_INR, (RATES:EUR/RATES:JPY)*RATES:INR AS JPY_INR, (RATES:EUR/RATES:SGD)*RATES:INR AS SGD_INR, (RATES:EUR/RATES:CAD)*RATES:INR AS CAD_INR, (RATES:EUR/RATES:AED)*RATES:INR AS AED_INR FROM( SELECT *, ROW_NUMBER()OVER(PARTITION BY BASE, DATE ORDER BY _AIRBYTE_EMITTED_AT DESC) RW FROM VAHDAM_DB.MAPLEMONK.EXCHANGE_RATES ) A WHERE RW = 1 ) EX ON FI.ORDER_TIMESTAMP::DATE = EX.date;",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from VAHDAM_DB.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            