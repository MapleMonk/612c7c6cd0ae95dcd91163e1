{{ config(
            materialized='table',
                post_hook={
                    "sql": "create or replace table rpsg_db.maplemonk.sales_invoice_return_consolidated as with cte as ( select distinct customer_id_final ,order_date::date as last_date from rpsg_db.maplemonk.sales_consolidated_drv where lower(shop_name) like any (\'%shopify%\',\'%woocommerce%\') and lower(final_status) like \'deliver%\' ), cte2 as ( select distinct customer_id_final ,reference_code,order_date::date as order_Date from rpsg_db.maplemonk.sales_consolidated_drv where lower(shop_name) like any (\'%shopify%\',\'%woocommerce%\') ), final_cte as ( select cte2.*,cte.last_date,row_number() over(partition by cte2.reference_code order by ifnull(last_date,\'2000-01-01\') desc)rw from cte2 left join cte on cte2.customer_id_final = cte.customer_id_final and cte2.order_date > cte.last_date ), assign_tag as ( select reference_code as rf ,datediff(\'day\',last_date,order_date) as num_days ,case when num_days >= 0 and num_days <= 30 then \'Repeat_New_Tag\' when num_days >= 0 and num_days <= 90 then \'Active_Tag\' when num_days >= 91 and num_days <= 180 then \'Lapser_Tag\' when num_days >= 181 and num_days <= 270 then \'Inactive_Tag\' when num_days >= 271 and num_days <= 600 then \'Dormant_Tag\' when num_days >= 600 then \'Deep_Dormant_Tag\' end As tag_Type from (select distinct reference_code,last_date,order_date from final_cte where rw = 1 ) ), booked_cte as ( select distinct customer_id_final ,order_date::date as last_date from rpsg_db.maplemonk.sales_consolidated_drv where lower(shop_name) like any (\'%shopify%\',\'%woocommerce%\') ), booked_cte2 as ( select distinct customer_id_final ,reference_code,order_date::date as order_Date from rpsg_db.maplemonk.sales_consolidated_drv where lower(shop_name) like any (\'%shopify%\',\'%woocommerce%\') ), booked_final_cte as ( select cte2.*,cte.last_date,row_number() over(partition by cte2.reference_code order by ifnull(last_date,\'2000-01-01\') desc)rw from booked_cte2 cte2 left join booked_cte cte on cte2.customer_id_final = cte.customer_id_final and cte2.order_date > cte.last_date ), booked_assign_tag as ( select reference_code as rf ,datediff(\'day\',last_date,order_date) as num_days ,case when num_days >= 0 and num_days <= 30 then \'Repeat_New_Tag\' when num_days >= 0 and num_days <= 90 then \'Active_Tag\' when num_days >= 91 and num_days <= 180 then \'Lapser_Tag\' when num_days >= 181 and num_days <= 270 then \'Inactive_Tag\' when num_days >= 271 and num_days <= 600 then \'Dormant_Tag\' when num_days >= 600 then \'Deep_Dormant_Tag\' end As booked_tag_Type from (select distinct reference_code,last_date,order_date from booked_final_cte where rw = 1 ) ) select order_date ,final_channel ,shop_name ,MARKETPLACE ,sku ,product_id ,upper(product_name_mapped) product_name_mapped ,upper(category) category ,ORDER_STATUS ,SHIPPING_STATUS ,final_status , CITY , STATE ,NEW_CUSTOMER_FLAG ,FINAL_UTM_CAMPAIGN as final_campaign ,FINAL_SOURCE ,FINAL_MEDIUM ,REPORT_CATEGORY ,CUSTOMER_ID_FINAL ,MAPLE_MONK_ID_PHONE ,GA_CHANNEL ,GA_SOURCE ,GA_MEDIUM ,GA_CAMPAIGN ,VIEW_ID ,PRE_FINAL_CHANNEL ,AWB ,CARRIER_ID ,COURIER ,CUSTOMER_NAME ,EMAIL ,PHONE ,MARKETPLACE_ID ,ORDER_ID ,LINE_ITEM_ID ,INVOICE_ID ,REFERENCE_CODE ,MANIFEST_DATE ,SHIPPING_LAST_UPDATE_DATE ,SKU_TYPE ,PRODUCTNAME ,CURRENCY ,RETURN_FLAG ,SHIPPING_PRICE ,NUMBER_OF_PRODUCTS_IN_COMBO ,SUBORDER_QUANTITY ,SHIPPED_QUANTITY ,RETURNED_QUANTITY ,CANCELLED_QUANTITY ,RETURN_SALES ,CANCEL_SALES ,TAX ,SUBORDER_MRP ,PRODUCT_PACK ,PRODUCT_QUANTITY ,DISCOUNT ,SELLING_PRICE ,MRP_SALES ,DISCOUNT_MRP ,WAREHOUSE_NAME ,DAYS_IN_SHIPMENT ,CHANNEL ,SHOPIFY_UTM_SOURCE ,SHOPIFY_UTM_MEDIUM ,UTM_CAMPAIGN ,PAYMENT_MODE ,IMPORT_DATE ,LAST_UPDATE_DATE ,INVOICE_DATE ,COMPANY_NAME ,PIN_CODE ,SHOPIFY_UTM_CAMPAIGN ,EASYECOM_SYNC_FLAG ,CANCELLED_AT ,DELIVERED_TIME ,RETURN_DATE ,STATUS ,\"Mapped Status\" ,NEW_CUSTOMER_FLAG_MONTH ,ACQUISITION_PRODUCT ,ACQUISITION_CHANNEL ,ACQUISITION_MARKETPLACE ,ACQUISITION_DATE ,SAME_DAY_ORDERNO ,CLICKPOST_STATUS ,OFFLINE_STATUS ,MONTHS_FROM_ACQUISITION ,RW_C ,BOOKED_CUSTOMER_FLAG ,CLICKPOST_DELIVERED_DATE ,null as invoice_customer_id_final ,null as invoice_MAPLE_MONK_ID_PHONE ,null as invoice_GA_CHANNEL ,null as invoice_GA_SOURCE ,null as invoice_GA_MEDIUM ,null as invoice_GA_CAMPAIGN ,null as invoice_VIEW_ID ,null as invoice_PRE_FINAL_CHANNEL ,null as invoice_AWB ,null as invoice_CARRIER_ID ,null as invoice_COURIER ,null as invoice_CUSTOMER_NAME ,null as invoice_EMAIL ,null as invoice_PHONE ,null as invoice_MARKETPLACE_ID ,null as invoice_ORDER_ID ,null as invoice_LINE_ITEM_ID ,null as invoice_INVOICE_ID ,null as invoice_REFERENCE_CODE ,null as invoice_MANIFEST_DATE ,null as invoice_SHIPPING_LAST_UPDATE_DATE ,null as invoice_SKU_TYPE ,null as invoice_PRODUCTNAME ,null as invoice_CURRENCY ,null as invoice_RETURN_FLAG ,null as invoice_SHIPPING_PRICE ,null as invoice_NUMBER_OF_PRODUCTS_IN_COMBO ,null as invoice_SUBORDER_QUANTITY ,null as invoice_SHIPPED_QUANTITY ,null as invoice_RETURNED_QUANTITY ,null as invoice_CANCELLED_QUANTITY ,null as invoice_RETURN_SALES ,null as invoice_CANCEL_SALES ,null as invoice_TAX ,null as invoice_SUBORDER_MRP ,null as invoice_PRODUCT_PACK ,null as invoice_PRODUCT_QUANTITY ,null as invoice_DISCOUNT ,null as invoice_SELLING_PRICE ,null as invoice_MRP_SALES ,null as invoice_DISCOUNT_MRP ,null as invoice_WAREHOUSE_NAME ,null as invoice_DAYS_IN_SHIPMENT ,null as invoice_CHANNEL ,null as invoice_SHOPIFY_UTM_SOURCE ,null as invoice_SHOPIFY_UTM_MEDIUM ,null as invoice_UTM_CAMPAIGN ,null as invoice_PAYMENT_MODE ,null as invoice_IMPORT_DATE ,null as invoice_LAST_UPDATE_DATE ,null as invoice_INVOICE_DATE ,null as invoice_COMPANY_NAME ,null as invoice_PIN_CODE ,null as invoice_SHOPIFY_UTM_CAMPAIGN ,null as invoice_EASYECOM_SYNC_FLAG ,null as invoice_CANCELLED_AT ,null as invoice_DELIVERED_TIME ,null as invoice_RETURN_DATE ,null as invoice_STATUS ,null as \"invoice Mapped Status\" ,null as invoice_NEW_CUSTOMER_FLAG_MONTH ,null as invoice_ACQUISITION_PRODUCT ,null as invoice_ACQUISITION_CHANNEL ,null as invoice_ACQUISITION_MARKETPLACE ,null as invoice_ACQUISITION_DATE ,null as invoice_SAME_DAY_ORDERNO ,null as invoice_CLICKPOST_STATUS ,null as invoice_OFFLINE_STATUS ,null as invoice_MONTHS_FROM_ACQUISITION ,null as invoice_RW_C ,null as invoice_BOOKED_CUSTOMER_FLAG ,null as invoice_CLICKPOST_DELIVERED_DATE ,null as return_reference_code ,null as return_quantity ,null as return_amount_without_tax ,null as return_shipping_charge ,null as return_tax ,null as total_return_amount ,tag_type ,booked_tag_type from (select * from rpsg_db.maplemonk.SALES_CONSOLIDATED_DRV where lower(marketplace) like any (\'%shopify%\',\'%wooco%\',\'%historical%\')) sc left join assign_tag at on sc.reference_code = at.rf left join booked_assign_tag bt on sc.reference_code = bt.rf union all select try_to_date(invoice_date)::timestamp as date ,final_channel ,shop_name ,MARKETPLACE ,sku ,product_id ,upper(product_name_mapped)product_name_mapped ,upper(category)category ,ORDER_STATUS ,SHIPPING_STATUS ,final_status , CITY , STATE ,NEW_CUSTOMER_FLAG ,FINAL_UTM_CAMPAIGN as final_campign ,FINAL_SOURCE ,FINAL_MEDIUM ,REPORT_CATEGORY ,null as CUSTOMER_ID_FINAL ,null as MAPLE_MONK_ID_PHONE ,null as GA_CHANNEL ,null as GA_SOURCE ,null as GA_MEDIUM ,null as GA_CAMPAIGN ,null as VIEW_ID ,null as PRE_FINAL_CHANNEL ,null as AWB ,null as CARRIER_ID ,null as COURIER ,null as CUSTOMER_NAME ,null as EMAIL ,null as PHONE ,null as MARKETPLACE_ID ,null as ORDER_ID ,null as LINE_ITEM_ID ,null as INVOICE_ID ,null as REFERENCE_CODE ,null as MANIFEST_DATE ,null as SHIPPING_LAST_UPDATE_DATE ,null as SKU_TYPE ,null as PRODUCTNAME ,null as CURRENCY ,null as RETURN_FLAG ,null as SHIPPING_PRICE ,null as NUMBER_OF_PRODUCTS_IN_COMBO ,null as SUBORDER_QUANTITY ,null as SHIPPED_QUANTITY ,null as RETURNED_QUANTITY ,null as CANCELLED_QUANTITY ,null as RETURN_SALES ,null as CANCEL_SALES ,null as TAX ,null as SUBORDER_MRP ,null as PRODUCT_PACK ,null as PRODUCT_QUANTITY ,null as DISCOUNT ,null as SELLING_PRICE ,null as MRP_SALES ,null as DISCOUNT_MRP ,null as WAREHOUSE_NAME ,null as DAYS_IN_SHIPMENT ,null as CHANNEL ,null as SHOPIFY_UTM_SOURCE ,null as SHOPIFY_UTM_MEDIUM ,null as UTM_CAMPAIGN ,null as PAYMENT_MODE ,null as IMPORT_DATE ,null as LAST_UPDATE_DATE ,null as INVOICE_DATE ,null as COMPANY_NAME ,null as PIN_CODE ,null as SHOPIFY_UTM_CAMPAIGN ,null as EASYECOM_SYNC_FLAG ,null as CANCELLED_AT ,null as DELIVERED_TIME ,null as RETURN_DATE ,null as STATUS ,null as \"Mapped Status\" ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,null as ACQUISITION_DATE ,null as SAME_DAY_ORDERNO ,null as CLICKPOST_STATUS ,null as OFFLINE_STATUS ,null as MONTHS_FROM_ACQUISITION ,null as RW_C ,null as BOOKED_CUSTOMER_FLAG ,null as CLICKPOST_DELIVERED_DATE ,customer_id_final as invoice_customer_id_final ,MAPLE_MONK_ID_PHONE as invoice_MAPLE_MONK_ID_PHONE ,GA_CHANNEL as invoice_GA_CHANNEL ,GA_SOURCE as invoice_GA_SOURCE ,GA_MEDIUM as invoice_GA_MEDIUM ,GA_CAMPAIGN as invoice_GA_CAMPAIGN ,VIEW_ID as invoice_VIEW_ID ,PRE_FINAL_CHANNEL as invoice_PRE_FINAL_CHANNEL ,AWB as invoice_AWB ,CARRIER_ID as invoice_CARRIER_ID ,COURIER as invoice_COURIER ,CUSTOMER_NAME as invoice_CUSTOMER_NAME ,EMAIL as invoice_EMAIL ,PHONE as invoice_PHONE ,MARKETPLACE_ID as invoice_MARKETPLACE_ID ,ORDER_ID as invoice_ORDER_ID ,LINE_ITEM_ID as invoice_LINE_ITEM_ID ,INVOICE_ID as invoice_INVOICE_ID ,REFERENCE_CODE as invoice_REFERENCE_CODE ,MANIFEST_DATE as invoice_MANIFEST_DATE ,SHIPPING_LAST_UPDATE_DATE as invoice_SHIPPING_LAST_UPDATE_DATE ,SKU_TYPE as invoice_SKU_TYPE ,PRODUCTNAME as invoice_PRODUCTNAME ,CURRENCY as invoice_CURRENCY ,RETURN_FLAG as invoice_RETURN_FLAG ,SHIPPING_PRICE as invoice_SHIPPING_PRICE ,NUMBER_OF_PRODUCTS_IN_COMBO as invoice_NUMBER_OF_PRODUCTS_IN_COMBO ,SUBORDER_QUANTITY as invoice_SUBORDER_QUANTITY ,SHIPPED_QUANTITY as invoice_SHIPPED_QUANTITY ,RETURNED_QUANTITY as invoice_RETURNED_QUANTITY ,CANCELLED_QUANTITY as invoice_CANCELLED_QUANTITY ,RETURN_SALES as invoice_RETURN_SALES ,CANCEL_SALES as invoice_CANCEL_SALES ,TAX as invoice_TAX ,SUBORDER_MRP as invoice_SUBORDER_MRP ,PRODUCT_PACK as invoice_PRODUCT_PACK ,PRODUCT_QUANTITY as invoice_PRODUCT_QUANTITY ,DISCOUNT as invoice_DISCOUNT ,SELLING_PRICE as invoice_SELLING_PRICE ,MRP_SALES as invoice_MRP_SALES ,DISCOUNT_MRP as invoice_DISCOUNT_MRP ,WAREHOUSE_NAME as invoice_WAREHOUSE_NAME ,DAYS_IN_SHIPMENT as invoice_DAYS_IN_SHIPMENT ,CHANNEL as invoice_CHANNEL ,SHOPIFY_UTM_SOURCE as invoice_SHOPIFY_UTM_SOURCE ,SHOPIFY_UTM_MEDIUM as invoice_SHOPIFY_UTM_MEDIUM ,UTM_CAMPAIGN as invoice_UTM_CAMPAIGN ,PAYMENT_MODE as invoice_PAYMENT_MODE ,IMPORT_DATE as invoice_IMPORT_DATE ,LAST_UPDATE_DATE as invoice_LAST_UPDATE_DATE ,INVOICE_DATE as invoice_INVOICE_DATE ,COMPANY_NAME as invoice_COMPANY_NAME ,PIN_CODE as invoice_PIN_CODE ,SHOPIFY_UTM_CAMPAIGN as invoice_SHOPIFY_UTM_CAMPAIGN ,EASYECOM_SYNC_FLAG as invoice_EASYECOM_SYNC_FLAG ,CANCELLED_AT as invoice_CANCELLED_AT ,DELIVERED_TIME as invoice_DELIVERED_TIME ,RETURN_DATE as invoice_RETURN_DATE ,STATUS as invoice_STATUS ,\"Mapped Status\" as \"invoice Mapped Status\" ,NEW_CUSTOMER_FLAG_MONTH as invoice_NEW_CUSTOMER_FLAG_MONTH ,ACQUISITION_PRODUCT as invoice_ACQUISITION_PRODUCT ,ACQUISITION_CHANNEL as invoice_ACQUISITION_CHANNEL ,ACQUISITION_MARKETPLACE as invoice_ACQUISITION_MARKETPLACE ,ACQUISITION_DATE as invoice_ACQUISITION_DATE ,SAME_DAY_ORDERNO as invoice_SAME_DAY_ORDERNO ,CLICKPOST_STATUS as invoice_CLICKPOST_STATUS ,OFFLINE_STATUS as invoice_OFFLINE_STATUS ,MONTHS_FROM_ACQUISITION as invoice_MONTHS_FROM_ACQUISITION ,RW_C as invoice_RW_C ,BOOKED_CUSTOMER_FLAG as invoice_BOOKED_CUSTOMER_FLAG ,CLICKPOST_DELIVERED_DATE as invoice_CLICKPOST_DELIVERED_DATE ,null as return_reference_code ,null as return_quantity ,null as return_amount_without_tax ,null as return_shipping_charge ,null as return_tax ,null as total_return_amount ,tag_type ,booked_tag_type from (select * from rpsg_db.maplemonk.SALES_CONSOLIDATED_DRV where lower(marketplace) like any (\'%shopify%\',\'%wooco%\',\'%historical%\')) sc left join assign_tag at on sc.reference_code = at.rf left join booked_assign_tag bt on sc.reference_code = bt.rf union all select return_date::timestamp as return_date ,channel ,upper(case when marketplace_id in (\'177\',\'180\') then \'Shopify_AyurvedicSource\' when marketplace_id in (\'26\') then \'Shopify_DRV\' when marketplace_id in (\'179\') then \'Shopify_Herbobuild\' else marketplace end) as shop_name ,shop_name as marketplace ,sku ,product_id ,upper(product_name_mapped)product_name_mapped ,upper(category) category ,null as ORDER_STATUS ,null as SHIPPING_STATUS ,null as final_status ,null as CITY ,null as STATE ,NEW_CUSTOMER_FLAG ,final_campaign ,null as FINAL_SOURCE ,null as FINAL_MEDIUM ,REPORT_CATEGORY ,null as CUSTOMER_ID_FINAL ,null as MAPLE_MONK_ID_PHONE ,null as GA_CHANNEL ,null as GA_SOURCE ,null as GA_MEDIUM ,null as GA_CAMPAIGN ,null as VIEW_ID ,null as PRE_FINAL_CHANNEL ,null as AWB ,null as CARRIER_ID ,null as COURIER ,null as CUSTOMER_NAME ,null as EMAIL ,null as PHONE ,null as MARKETPLACE_ID ,null as ORDER_ID ,null as LINE_ITEM_ID ,null as INVOICE_ID ,null as REFERENCE_CODE ,null as MANIFEST_DATE ,null as SHIPPING_LAST_UPDATE_DATE ,null as SKU_TYPE ,null as PRODUCTNAME ,null as CURRENCY ,null as RETURN_FLAG ,null as SHIPPING_PRICE ,null as NUMBER_OF_PRODUCTS_IN_COMBO ,null as SUBORDER_QUANTITY ,null as SHIPPED_QUANTITY ,null as RETURNED_QUANTITY ,null as CANCELLED_QUANTITY ,null as RETURN_SALES ,null as CANCEL_SALES ,null as TAX ,null as SUBORDER_MRP ,null as PRODUCT_PACK ,null as PRODUCT_QUANTITY ,null as DISCOUNT ,null as SELLING_PRICE ,null as MRP_SALES ,null as DISCOUNT_MRP ,null as WAREHOUSE_NAME ,null as DAYS_IN_SHIPMENT ,null as CHANNEL ,null as SHOPIFY_UTM_SOURCE ,null as SHOPIFY_UTM_MEDIUM ,null as UTM_CAMPAIGN ,null as PAYMENT_MODE ,null as IMPORT_DATE ,null as LAST_UPDATE_DATE ,null as INVOICE_DATE ,null as COMPANY_NAME ,null as PIN_CODE ,null as SHOPIFY_UTM_CAMPAIGN ,null as EASYECOM_SYNC_FLAG ,null as CANCELLED_AT ,null as DELIVERED_TIME ,null as RETURN_DATE ,null as STATUS ,null as \"Mapped Status\" ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,null as ACQUISITION_DATE ,null as SAME_DAY_ORDERNO ,null as CLICKPOST_STATUS ,null as OFFLINE_STATUS ,null as MONTHS_FROM_ACQUISITION ,null as RW_C ,null as BOOKED_CUSTOMER_FLAG ,null as CLICKPOST_DELIVERED_DATE ,null as invoice_customer_id_final ,null as invoice_MAPLE_MONK_ID_PHONE ,null as invoice_GA_CHANNEL ,null as invoice_GA_SOURCE ,null as invoice_GA_MEDIUM ,null as invoice_GA_CAMPAIGN ,null as invoice_VIEW_ID ,null as invoice_PRE_FINAL_CHANNEL ,null as invoice_AWB ,null as invoice_CARRIER_ID ,null as invoice_COURIER ,null as invoice_CUSTOMER_NAME ,null as invoice_EMAIL ,null as invoice_PHONE ,null as invoice_MARKETPLACE_ID ,null as invoice_ORDER_ID ,null as invoice_LINE_ITEM_ID ,null as invoice_INVOICE_ID ,null as invoice_REFERENCE_CODE ,null as invoice_MANIFEST_DATE ,null as invoice_SHIPPING_LAST_UPDATE_DATE ,null as invoice_SKU_TYPE ,null as invoice_PRODUCTNAME ,null as invoice_CURRENCY ,null as invoice_RETURN_FLAG ,null as invoice_SHIPPING_PRICE ,null as invoice_NUMBER_OF_PRODUCTS_IN_COMBO ,null as invoice_SUBORDER_QUANTITY ,null as invoice_SHIPPED_QUANTITY ,null as invoice_RETURNED_QUANTITY ,null as invoice_CANCELLED_QUANTITY ,null as invoice_RETURN_SALES ,null as invoice_CANCEL_SALES ,null as invoice_TAX ,null as invoice_SUBORDER_MRP ,null as invoice_PRODUCT_PACK ,null as invoice_PRODUCT_QUANTITY ,null as invoice_DISCOUNT ,null as invoice_SELLING_PRICE ,null as invoice_MRP_SALES ,null as invoice_DISCOUNT_MRP ,null as invoice_WAREHOUSE_NAME ,null as invoice_DAYS_IN_SHIPMENT ,null as invoice_CHANNEL ,null as invoice_SHOPIFY_UTM_SOURCE ,null as invoice_SHOPIFY_UTM_MEDIUM ,null as invoice_UTM_CAMPAIGN ,null as invoice_PAYMENT_MODE ,null as invoice_IMPORT_DATE ,null as invoice_LAST_UPDATE_DATE ,null as invoice_INVOICE_DATE ,null as invoice_COMPANY_NAME ,null as invoice_PIN_CODE ,null as invoice_SHOPIFY_UTM_CAMPAIGN ,null as invoice_EASYECOM_SYNC_FLAG ,null as invoice_CANCELLED_AT ,null as invoice_DELIVERED_TIME ,null as invoice_RETURN_DATE ,null as invoice_STATUS ,null as \"invoice Mapped Status\" ,null as invoice_NEW_CUSTOMER_FLAG_MONTH ,null as invoice_ACQUISITION_PRODUCT ,null as invoice_ACQUISITION_CHANNEL ,null as invoice_ACQUISITION_MARKETPLACE ,null as invoice_ACQUISITION_DATE ,null as invoice_SAME_DAY_ORDERNO ,null as invoice_CLICKPOST_STATUS ,null as invoice_OFFLINE_STATUS ,null as invoice_MONTHS_FROM_ACQUISITION ,null as invoice_RW_C ,null as invoice_BOOKED_CUSTOMER_FLAG ,null as invoice_CLICKPOST_DELIVERED_DATE ,reference_code as return_reference_code ,returned_quantity as return_quantity ,return_amount_without_tax ,return_shipping_charge ,return_tax ,total_return_amount ,tag_type ,booked_tag_type from (select * from RPSG_DB.MAPLEMONK.fact_items_easyecom_returns_detailed_drv where lower(marketplace) like any (\'%shopify%\',\'woocom\')) sc left join assign_tag at on replace(sc.reference_code,\'#\',\'\') = replace(at.rf,\'#\',\'\') left join booked_assign_tag bt on replace(sc.reference_code,\'#\',\'\') = replace(bt.rf,\'#\',\'\')",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from RPSG_DB.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            