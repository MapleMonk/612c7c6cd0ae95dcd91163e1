{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table eggozdb.maplemonk.batch_data as select pb.id as batch_id, bz.zone_name, ff.farm_name, ww.name as warehouse, cast(timestampadd(minute,660,pp.po_date) as date) bill_date, pb.type, pb.batch_status, pb.egg_type, case when pb.actual_egg_price=0 then pb.expected_egg_price else pb.actual_egg_price end as procured_price from eggozdb.maplemonk.my_sql_procurement_procurement pp left join eggozdb.maplemonk.my_sql_farmer_farm ff on pp.farm_id = ff.id left join eggozdb.maplemonk.my_sql_warehouse_warehouse ww on ww.id = pp.warehouse_id left join eggozdb.maplemonk.my_sql_procurement_batchmodel pb on pp.id = pb.procurement_id join eggozdb.maplemonk.my_sql_base_zone bz on bz.id = ww.zone_id group by pb.id, bz.zone_name, ff.farm_name, cast(timestampadd(minute,660,pp.po_date) as date), expected_egg_price, pb.type, pb.batch_status, pb.egg_type, pb.actual_egg_price, ww.name ; create or replace table eggozdb.maplemonk.processing_data as select bd.*, tt.* from eggozdb.maplemonk.batch_data bd left join ( select batch_id as processing_batch_id, cast(timestampadd(minute, 660, start_time) as date) processing_date, sum(egg_chatki) egg_chatki, sum(egg_loss) eggs_loss, sum(egg_count) egg_count, sum(black_spot_loss) black_spot_loss, sum(blood_spot_loss) blood_spot_loss, sum(damaged_loss) damaged_loss, sum(color_spot_loss) color_spot_loss, sum(egg_air_gap) egg_air_gap, sum(egg_dirty) egg_dirty, sum(egg_hairline) egg_hairline, sum(short_loss) short_loss, sum(egg_blood_spot) egg_blood_spot, sum(egg_good) egg_good, sum(egg_melted) egg_melted, sum(egg_small) egg_small, sum(egg_very_dirty) egg_very_dirty, sum(egg_shape_size) egg_shape_size, sum(no_of_eggs) no_of_eggs, sum(processing_loss) processing_loss, sum(egg_other) egg_other, sum(egg_other_ub) egg_other_ub, sum(egg_pid) egg_pid, sum(egg_rtv) egg_rtv from eggozdb.maplemonk.my_sql_procurement_eggcleaning group by batch_id, cast(timestampadd(minute, 660, start_time) as date) ) tt on tt.processing_batch_id = bd.batch_id where tt.processing_batch_id is not null ; create or replace table eggozdb.maplemonk.procurement_data as select bd.*, tt.* from eggozdb.maplemonk.batch_data bd left join ( select batch_id procurement_batch_id, CAST(TIMESTAMPADD(MINUTE, 660, date) AS DATE) AS grn_date, sum(egg_chatki) egg_chatki, sum(egg_tray) egg_tray, sum(egg_loss) egg_loss, sum(egg_missing) egg_missing, sum(egg_air_gap) egg_air_gap, sum(egg_blood_spot) egg_blood_spot, sum(egg_dirty) egg_dirty, sum(egg_good) egg_good, sum(egg_hairline) egg_hairline, sum(egg_melted) egg_melted, sum(egg_small) egg_small, sum(egg_very_dirty) egg_very_dirty, sum(egg_pid) egg_pid, sum(egg_handling_loss) egg_handling_loss from eggozdb.maplemonk.my_sql_procurement_eggsin group by batch_id, cast(timestampadd(minute, 660, date) as date) ) tt on tt.procurement_batch_id = bd.batch_id where tt.procurement_batch_id is not null ; create or replace table eggozdb.maplemonk.packaging_data as select bd.*, tt.* from eggozdb.maplemonk.batch_data bd left join ( select t1.batch_id package_batch_id, cast(timestampadd(minute, 660, t1.start_time) as date) packaging_date, sum(t1.egg_chatki) egg_chatki, sum(t1.egg_loss) egg_loss, sum(t1.package_count*pp.sku_count) packaged_eggs, sum(t1.egg_air_gap) egg_air_gap, sum(t1.egg_blood_spot) egg_blood_spot, sum(t1.egg_dirty) egg_dirty, sum(t1.egg_good) egg_good, sum(t1.egg_hairline) egg_hairline, sum(t1.egg_melted) egg_melted, sum(t1.egg_small) egg_small, sum(t1.egg_very_dirty) egg_very_dirty, sum(t1.egg_pid) egg_pid, sum(t1.egg_shape_size) egg_shape_size, sum(t1.eggs_used) eggs_used from eggozdb.maplemonk.my_sql_procurement_package t1 left join eggozdb.maplemonk.my_sql_product_product pp on pp.id = t1.product_id group by t1.batch_id, cast(timestampadd(minute, 660, t1.start_time) as date) ) tt on tt.package_batch_id = bd.batch_id where tt.package_batch_id is not null ; create or replace table eggozdb.maplemonk.batch_procurement_processing_packaging as select bd.*, tt1.procurement_batch_id, tt1.grn_date, ifnull(tt1.procurement_egg_chatki,0) procurement_egg_chatki, ifnull(tt1.procurement_egg_tray,0) procurement_egg_tray, ifnull(tt1.procurement_egg_loss,0) procurement_egg_loss, ifnull(tt1.procurement_egg_missing,0) procurement_egg_missing, ifnull(tt1.procurement_egg_air_gap,0) procurement_egg_air_gap, ifnull(tt1.procurement_egg_blood_spot,0) procurement_egg_blood_spot, ifnull(tt1.procurement_egg_dirty,0) procurement_egg_dirty, ifnull(tt1.procurement_egg_good,0) procurement_egg_good, ifnull(tt1.procurement_egg_hairline,0) procurement_egg_hairline, ifnull(tt1.procurement_egg_melted,0) procurement_egg_melted, ifnull(tt1.procurement_egg_small,0) procurement_egg_small, ifnull(tt1.procurement_egg_very_dirty,0) procurement_egg_very_dirty, ifnull(tt1.procurement_egg_pid,0) procurement_egg_pid, ifnull(tt1.procurement_egg_handling_loss,0) procurement_egg_handling_loss, ifnull(tt1.total_procurement_loss,0) total_procurement_loss, ifnull(tt1.total_procurement_ub,0) total_procurement_ub, tt2.processing_batch_id, tt2.processing_date, ifnull(tt2.processing_egg_chatki,0) processing_egg_chatki, ifnull(tt2.processing_egg_loss,0) processing_egg_loss, ifnull(tt2.processing_egg_count,0) processing_egg_count, ifnull(tt2.processing_black_spot_loss,0) processing_black_spot_loss, ifnull(tt2.processing_blood_spot_loss,0) processing_blood_spot_loss, ifnull(tt2.processing_damaged_loss,0) processing_damaged_loss, ifnull(tt2.processing_color_spot_loss,0) processing_color_spot_loss, ifnull(tt2.processing_egg_air_gap,0) processing_egg_air_gap, ifnull(tt2.processing_egg_dirty,0) processing_egg_dirty, ifnull(tt2.processing_egg_hairline,0) processing_egg_hairline, ifnull(tt2.processing_short_loss,0) processing_short_loss, ifnull(tt2.processing_egg_blood_spot,0) processing_egg_blood_spot, ifnull(tt2.processing_egg_good,0) processing_egg_good, ifnull(tt2.processing_egg_melted,0) processing_egg_melted, ifnull(tt2.processing_egg_small,0) processing_egg_small, ifnull(tt2.processing_egg_very_dirty,0) processing_egg_very_dirty, ifnull(tt2.processing_egg_shape_size,0) processing_egg_shape_size, ifnull(tt2.processing_no_of_eggs,0) processing_no_of_eggs, ifnull(tt2.processing_processing_loss,0) processing_processing_loss, ifnull(tt2.processing_egg_other,0) processing_egg_other, ifnull(tt2.processing_egg_other_ub,0) processing_egg_other_ub, ifnull(tt2.processing_egg_pid,0) processing_egg_pid, ifnull(tt2.processing_egg_rtv,0) processing_egg_rtv, ifnull(tt2.total_processing_ub,0) total_processing_ub, ifnull(tt2.total_processing_loss,0) total_processing_loss, tt3.package_batch_id, tt3.packaging_date, ifnull(tt3.packaging_egg_chatki,0) packaging_egg_chatki, ifnull(tt3.packaging_egg_loss,0) packaging_egg_loss, ifnull(tt3.packaging_egg_air_gap,0) packaging_egg_air_gap, ifnull(tt3.packaging_egg_blood_spot,0) packaging_egg_blood_spot, ifnull(tt3.packaging_egg_dirty,0) packaging_egg_dirty, ifnull(tt3.packaging_egg_good,0) packaging_egg_good, ifnull(tt3.packaging_egg_hairline,0) packaging_egg_hairline, ifnull(tt3.packaging_egg_melted,0) packaging_egg_melted, ifnull(tt3.packaging_egg_small,0) packaging_egg_small, ifnull(tt3.packaging_egg_very_dirty,0) packaging_egg_very_dirty, ifnull(tt3.packaging_egg_pid,0) packaging_egg_pid, ifnull(tt3.packaging_egg_shape_size,0) packaging_egg_shape_size, ifnull(tt3.packaging_eggs_used,0) packaging_eggs_used, ifnull(tt3.total_packaging_loss,0) total_packaging_loss, ifnull(tt3.total_packaging_ub,0) total_packaging_ub, tt4.eggqualitycheck_batch_id, ifnull(tt4.eggqualitycheck_egg_loss,0) eggqualitycheck_egg_loss, tt5.eggrmstore_batch_id, ifnull(tt5.eggrmstore_egg_good,0) eggrmstore_egg_good from eggozdb.maplemonk.batch_data bd left join ( select batch_id procurement_batch_id, CAST(TIMESTAMPADD(MINUTE, 660, date) AS DATE) AS grn_date, sum(egg_chatki) procurement_egg_chatki, sum(egg_tray) procurement_egg_tray, sum(egg_loss) procurement_egg_loss, sum(egg_missing) procurement_egg_missing, sum(egg_air_gap) procurement_egg_air_gap, sum(egg_blood_spot) procurement_egg_blood_spot, sum(egg_dirty) procurement_egg_dirty, sum(egg_good) procurement_egg_good, sum(egg_hairline) procurement_egg_hairline, sum(egg_melted) procurement_egg_melted, sum(egg_small) procurement_egg_small, sum(egg_very_dirty) procurement_egg_very_dirty, sum(egg_pid) procurement_egg_pid, sum(egg_handling_loss) procurement_egg_handling_loss, sum(egg_loss+egg_missing+egg_handling_loss) total_procurement_loss, sum(egg_dirty+egg_chatki+egg_air_gap+egg_blood_spot+egg_hairline+egg_melted+egg_small+egg_very_dirty+egg_pid) total_procurement_ub from eggozdb.maplemonk.my_sql_procurement_eggsin group by batch_id, cast(timestampadd(minute, 660, date) as date) ) tt1 on tt1.procurement_batch_id = bd.batch_id left join ( select batch_id as processing_batch_id, min(cast(timestampadd(minute, 660, start_time) as date)) processing_date, sum(egg_chatki) processing_egg_chatki, sum(egg_loss) processing_egg_loss, sum(egg_count) processing_egg_count, sum(black_spot_loss) processing_black_spot_loss, sum(blood_spot_loss) processing_blood_spot_loss, sum(damaged_loss) processing_damaged_loss, sum(color_spot_loss) processing_color_spot_loss, sum(egg_air_gap) processing_egg_air_gap, sum(egg_dirty) processing_egg_dirty, sum(egg_hairline) processing_egg_hairline, sum(short_loss) processing_short_loss, sum(egg_blood_spot) processing_egg_blood_spot, sum(egg_good) processing_egg_good, sum(egg_melted) processing_egg_melted, sum(egg_small) processing_egg_small, sum(egg_very_dirty) processing_egg_very_dirty, sum(egg_shape_size) processing_egg_shape_size, sum(no_of_eggs) processing_no_of_eggs, sum(processing_loss) processing_processing_loss, sum(egg_other) processing_egg_other, sum(egg_other_ub) processing_egg_other_ub, sum(egg_pid) processing_egg_pid, sum(egg_rtv) processing_egg_rtv, sum(egg_hairline+egg_chatki+egg_dirty+egg_small+egg_pid+egg_air_gap+egg_blood_spot+egg_melted+egg_very_dirty+egg_shape_size+egg_other+egg_other_ub) total_processing_ub, sum(blood_spot_loss+damaged_loss+processing_loss+short_loss+color_spot_loss+egg_loss+black_spot_loss) total_processing_loss from eggozdb.maplemonk.my_sql_procurement_eggcleaning group by batch_id ) tt2 on tt2.processing_batch_id = bd.batch_id left join ( select t1.batch_id package_batch_id, min(cast(timestampadd(minute, 660, t1.start_time) as date)) packaging_date, sum(t1.egg_chatki) packaging_egg_chatki, sum(t1.egg_loss) packaging_egg_loss, sum(t1.egg_air_gap) packaging_egg_air_gap, sum(t1.egg_blood_spot) packaging_egg_blood_spot, sum(t1.egg_dirty) packaging_egg_dirty, sum(t1.egg_good) packaging_egg_good, sum(t1.egg_hairline) packaging_egg_hairline, sum(t1.egg_melted) packaging_egg_melted, sum(t1.egg_small) packaging_egg_small, sum(t1.egg_very_dirty) packaging_egg_very_dirty, sum(t1.egg_pid) packaging_egg_pid, sum(t1.egg_shape_size) packaging_egg_shape_size, sum(t1.eggs_used) packaging_eggs_used, sum(t1.egg_loss) total_packaging_loss, sum(t1.egg_chatki+t1.egg_dirty+t1.egg_air_gap+t1.egg_blood_spot+t1.egg_hairline+t1.egg_melted+t1.egg_small+t1.egg_very_dirty+t1.egg_shape_size+t1.egg_pid) total_packaging_ub from eggozdb.maplemonk.my_sql_procurement_package t1 group by t1.batch_id ) tt3 on tt3.package_batch_id = bd.batch_id left join ( select batch_id as eggqualitycheck_batch_id, sum(egg_loss) eggqualitycheck_egg_loss from eggozdb.maplemonk.my_sql_procurement_eggqualitycheck group by batch_id ) tt4 on tt4.eggqualitycheck_batch_id = bd.batch_id left join ( select batch_id as eggrmstore_batch_id, sum(egg_pid)+sum(egg_good)+sum(egg_dirty)+sum(egg_small)+sum(egg_chatki) eggrmstore_egg_good from eggozdb.maplemonk.my_sql_procurement_eggrmstore group by batch_id ) tt5 on tt5.eggrmstore_batch_id = bd.batch_id ; create or replace table eggozdb.maplemonk.epm_packaged_eggs_sku as select cast(timestampadd(minute, 660, start_time) as date) packaging_date, ppg.batch_id, ppi.package_id, ppi.product_id, ppi.package_count, pp.SKU_Count, ppi.package_count*pp.SKU_Count as packaged_eggs, pp.name, pp.short_name, concat(pp.SKU_Count,pp.short_name) sku, bd.zone_name from eggozdb.maplemonk.my_sql_procurement_packageinline ppi left join eggozdb.maplemonk.my_sql_procurement_package ppg on ppg.id = ppi.package_id left join eggozdb.maplemonk.my_sql_product_product pp on pp.id = ppi.product_id left join eggozdb.maplemonk.batch_data bd on bd.batch_id = ppg.batch_id ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from EGGOZDB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        