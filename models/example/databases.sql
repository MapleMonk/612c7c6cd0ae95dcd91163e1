{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table lilgoodness_db.maplemonk.FLIPKART_FACT_ITEMS_LG as select \'Flipkart\' as Shop_name ,try_to_timestamp(a.\"Order Date\") Order_Date ,try_to_timestamp(a.\"Buyer Invoice Date\") Buyer_Invoice_Date ,a.\"Order ID\" Order_ID ,a.\"Order Item ID\" ORDER_ITEM_ID ,a.\"Buyer Invoice ID\" BUYER_INVOICE_ID ,a.\"Is Shopsy Order?\" SHOPSY_ORDER_FLAG ,replace(a.FSN,\'\"\',\'\') FSN ,replace(replace(a.SKU,\'\"\',\'\'),\'SKU:\',\'\') SKU ,a.\"HSN Code\" HSN_CODE ,replace(a.\"Product Title/Description\",\'\"\',\'\') PRODUCT_NAME_PER_PLATFORM ,a.\"Event Type\" Event_Type ,a.\"Event Sub Type\" EVENT_SUB_TYPE ,a.\"Order Type\" Order_Type ,a.\"Fulfilment Type\" FULFILMENT_TYPE ,ifnull(try_to_double(a.\"Usual Price\"),0) USUAL_PRICE ,ifnull(try_to_decimal(a.\"Item Quantity\"),0) ITEM_QUANTITY ,ifnull(try_to_double(a.\"Taxable Value (Final Invoice Amount -Taxes)\"),0) TAXABLE_VALUE ,ifnull(try_to_double(a.\"Final Invoice Amount (Price after discount+Shipping Charges)\"),0) FINAL_INVOICE_AMOUNT ,ifnull(try_to_double(a.\"Buyer Invoice Amount\"),0) BUYER_INVOICE_AMOUNT ,ifnull(try_to_double(a.\"Price before discount\"),0) PRICE_BEFORE_DISCOUNT ,ifnull(try_to_double(a.\"Price after discount (Price before discount-Total discount)\"),0) PRICE_AFTER_DISCOUNT ,-1*ifnull(try_to_double(a.\"Total Discount\"),0) DISCOUNT_PER_PLATFORM ,ifnull(try_to_double(a.\"Shipping Charges\"),0) SHIPPING_CHARGES ,ifnull(try_to_double(a.\"CST Amount\"),0) CST_AMOUNT ,ifnull(try_to_double(a.\"TDS Amount\"),0) TDS_AMOUNT ,ifnull(try_to_double(a.\"VAT Amount\"),0) VAT_AMOUNT ,ifnull(try_to_double(a.\"CGST Amount\"),0) CGST_AMOUNT ,ifnull(try_to_double(a.\"IGST Amount\"),0) IGST_AMOUNT ,ifnull(try_to_double(a.\"Seller Share\"),0) Seller_Share ,ifnull(try_to_double(a.\"TCS CGST Amount\"),0) TCS_CGST_AMOUNT ,ifnull(try_to_double(a.\"TCS SGST Amount\"),0) TCS_SGST_AMOUNT ,ifnull(try_to_double(a.\"TCS IGST Amount\"),0) TCS_IGST_AMOUNT ,ifnull(try_to_double(a.\"Total TCS Deducted\"),0) TOTAL_TCS_DEDUCTED ,a.\"Customer\'s Billing State\" BILLING_STATE ,a.\"Customer\'s Delivery State\" DELIVERY_STATE ,a.\"Customer\'s Billing Pincode\" BILLING_PINCODE ,a.\"Customer\'s Delivery Pincode\" DELIVERY_PINCODE ,coalesce(b.\"Event Sub Type\",a.\"Event Sub Type\") FINAL_ORDER_STATUS ,SKU_MAPPING.SKU MAPPING_SKU from lilgoodness_db.maplemonk.flipkart_sales a left join ( select * from (select * ,row_number() over (partition by \"Order Item ID\", replace(FSN,\'\"\',\'\'), replace(replace(SKU,\'\"\',\'\'),\'SKU:\',\'\') order by 1) rw from lilgoodness_db.maplemonk.flipkart_sales where lower(\"Event Type\") = \'return\' ) where rw=1 ) b on a.\"Order Item ID\"=b.\"Order Item ID\" left join (select * from (select SKU, MARKETPLACE_SKU,MARKETPLACE_NAME , row_number() over (partition by marketplace_sku order by sku) rw from LILGOODNESS_DB.maplemonk.lg_marketplace_sku_mapping ) where rw=1 ) SKU_MAPPING on lower(a.fsn) = lower(SKU_MAPPING.marketplace_sku) where lower(a.\"Event Type\") not in (\'return\') ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from LILGOODNESS_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        