{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE eggozdb.maplemonk.Inventory_Bifurcation_Table_Final as S SELECT p.DATE as Date, sum(p.Eggs_Sold) as Eggs_Sold, sum(p.EGGS_SOLD_BROWN) as Eggs_Sold_Brown,sum(p.EGGS_SOLD_WHITE) as Eggs_Sold_White, sum(p.Eggs_Sold_Nutra) as Eggs_Sold_Nutra, sum(p.Eggs_Sold_FR) as Eggs_Sold_FR, sum(p.Eggs_Replaced) as Eggs_Replaced, sum(p.EGGS_REPLACED_BROWN) as Eggs_Replaced_Brown, sum(p.EGGS_REPLACED_WHITE) as Eggs_Replaced_White, sum(p.Eggs_Replaced_Nutra) as Eggs_Replaced_Nutra, sum(p.Eggs_Replaced_FR) as Eggs_Replaced_FR, sum(p.Eggs_Return) as Eggs_Returned, sum(p.Eggs_Return_White) as Eggs_Returned_White, sum(p.Eggs_Return_Brown) as Eggs_Returned_Brown, sum(p.Eggs_Return_Nutra) as Eggs_Returned_Nutra, sum(p.Eggs_Return_FR) as Eggs_Return_FR, avg(p.packaging_ub) as Packaging_UB, avg(p.Packaging_UB_Brown) as Packaging_UB_Brown, avg(p.Packaging_UB_White)as Packaging_UB_White ,avg(p.Packaging_UB_Nutra)as Packaging_UB_Nutra ,avg(p.Total_PPP_Loss) as Total_PPP_Loss, avg(p.PPP_Loss_Brown) as PPP_Loss_Brown , avg(p.PPP_Loss_White) as PPP_Loss_White,avg(p.PPP_Loss_Nutra) as PPP_Loss_Nutra, avg(p.Processing_UB) as Processing_UB, avg(p.Processing_UB_Brown) as Processing_UB_Brown, avg(p.Processing_UB_White) as Processing_UB_White , avg(p.Processing_UB_Nutra) as Processing_UB_Nutra, avg(p.Unprocessed_Eggs) as Unprocessed_Eggs, avg(p.Procurred_Egg) as Procurred_Egg from (select a.*, b.packaging_ub ,d.Processing_UB, e.Procurred_Egg, c.Total_PPP_Loss, c.PPP_Loss_Nutra,c.PPP_Loss_White, c.PPP_Loss_Brown, b.Packaging_UB_Brown, b.Packaging_UB_White, b.Packaging_UB_Nutra, d.Processing_UB_White, d.Processing_UB_Brown, d.Processing_UB_Nutra , d.Unprocessed_Eggs from (select DATE , case when Area in (\'NCR-MT\', \'Delhi-GT\',\'Noida-GT\', \'Gurgaon-GT\', \'NCR-HORECA\', \'NCR-ON-MT\',\'NCR-OF-MT\') then \'1.NCR\' when Area in (\'NCR-UB\',\'Bangalore-UB\',\'UP-UB\',\'East-UB\',\'MP-UB\') then \'6.UB\' when Area in (\'Bangalore-MT\', \'Bangalore-GT\',\'Bangalore-Horeca\',\'Bangalore-HORECA\', \'Bangalore-ON-MT\', \'Bangalore-OF-MT\') then \'2.Bangalore\' when Area in (\'Allahabad-GT\', \'Lucknow-GT\', \'UP-MT\' , \'UP-ON-MT\', \'UP-OF-MT\') then \'4.UP\' when Area in (\'Indore-GT\', \'Bhopal-GT\',\'MP-MT\',\'MP-UB\', \'MP-ON-MT\', \'MP-OF-MT\') then \'3.MP\' when Area in (\'East-MT\',\'Kolkata-GT\', \'Patna-GT\', \'East-ON-MT\',\'East-OF-MT\') then \'5.East\' else \'9.Others\' end as Area_classification, sum(eggs_sold) as Eggs_Sold,sum(EGGS_SOLD_WHITE) as Eggs_Sold_White, sum(EGGS_SOLD_BROWN) as Eggs_Sold_Brown, sum(EGGS_SOLD_NUTRA) as Eggs_Sold_Nutra ,sum(EGGS_SOLD_FR) as Eggs_Sold_FR, sum(EGGS_REPLACED) as Eggs_Replaced, sum(EGGS_REPLACED_WHITE) as Eggs_Replaced_White, sum(EGGS_REPLACED_BROWN) as Eggs_Replaced_Brown, SUM(EGGS_REPLACED_NUTRA) as Eggs_Replaced_Nutra, sum(EGGS_REPLACED_FR) as Eggs_Replaced_FR, sum(EGGS_RETURN) as Eggs_Return, sum(EGGS_RETURN_WHITE) as Eggs_Return_White, sum(EGGS_RETURN_BROWN) as Eggs_Return_Brown, sum(EGGS_RETURN_NUTRA) as Eggs_Return_Nutra , sum(EGGS_RETURN_FR) as Eggs_Return_FR from eggozdb.maplemonk.summary_reporting_table_beat_retailer WHERE Area_Classification = \'1.NCR\' group by DATE , Area, Area_classification ) a left join ( Select g.PDATE, g.packaging_ub, h.Packaging_UB_Brown, i.Packaging_UB_White, j.Packaging_UB_Nutra FROM (select PDATE, sum(\"Packaging UB\") as packaging_ub from eggozdb.maplemonk.epm_pkg_loss group by 1 )g full outer join (Select p.PDATE, sum(p.packaging_ub) as Packaging_UB_Brown from (Select PDATE, CATEGORY, sum(\"Packaging UB\") as packaging_ub from eggozdb.maplemonk.epm_pkg_loss group by PDATE, CATEGORY) p where Category= \'B-Tray\' group by CATEGORY, p.PDATE )h on g.PDATE=h.PDATE full outer join ( Select p.PDATE, sum(p.packaging_ub) as Packaging_UB_White from (Select PDATE, Category, sum(\"Packaging UB\") as packaging_ub from eggozdb.maplemonk.epm_pkg_loss group by PDATE, CATEGORY) p where Category= \'W-Tray\' group by CATEGORY, p.PDATE ) i on h.PDATE=i.PDATE full outer join (Select p.PDATE, sum(p.packaging_ub) as Packaging_UB_Nutra from (Select PDATE, CATEGORY, sum(\"Packaging UB\") as packaging_ub from eggozdb.maplemonk.epm_pkg_loss group by PDATE, CATEGORY) p where Category= \'N-Tray\' group by CATEGORY, p.PDATE ) j on i.PDATE=j.PDATE ) b on a.date = b.PDATE left JOIN (select DDATE, sum(\"Total PPP Loss\" ) as Total_PPP_loss, sum(\"PPP Loss(Brown)\" )as PPP_Loss_Brown, sum(\"PPP Loss(Nutra)\" )as PPP_Loss_Nutra, sum(\"PPP Loss(White)\" )as PPP_Loss_White From eggozdb.maplemonk.loss_daily_loss_log group by 1)c on a.DATE = c.DDATE left JOIN (Select m.PDATE, m.Processing_UB, m.Unprocessed_Eggs, n.Processing_UB_White, o.Processing_UB_Brown, s.Processing_UB_Nutra FROM ( Select PDATE, sum(\"Unprocesed Eggs\" ) as Unprocessed_Eggs, sum(UB) as Processing_UB from eggozdb.maplemonk.epm_sheet1 group by 1 ) m full outer join (Select p.PDATE, sum(p.Processing_UB) as Processing_UB_White from (Select PDATE, Category, sum(UB) as Processing_UB from eggozdb.maplemonk.epm_sheet1 group by PDATE, Category)p where Category= \'W-Tray\' group by Category, p.PDATE) n on m.PDATE=n.PDATE full outer join ( Select p.PDATE, sum(p.Processing_UB) as Processing_UB_Brown from (Select PDATE, Category, sum(UB) as Processing_UB from eggozdb.maplemonk.epm_sheet1 group by PDATE, Category)p where Category= \'B-Tray\' group by Category, p.PDATE )o on n.PDATE=o.PDATE full outer join (Select Category, p.PDATE, sum(p.Processing_UB) as Processing_UB_Nutra from (Select PDATE, Category, sum(UB) as Processing_UB from eggozdb.maplemonk.epm_sheet1 group by PDATE, Category)p where Category= \'N-Tray\' group by Category, p.PDATE )s on o.PDATE = s.PDATE )d on a.DATE = d.PDATE left JOIN ( SELECT GRN_DATE, sum(EGGS) as Procurred_Egg from eggozdb.maplemonk.region_wise_procurement_masterdata where REGION= \'NCR\' group by 1 ) e on a.DATE = e.GRN_DATE) p group by 1 ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from EGGOZDB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        