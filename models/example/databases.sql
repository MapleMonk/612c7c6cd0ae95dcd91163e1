{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table prd_db.beardo.dwh_amazonads_consolidated as with Sessions as ( with ASPTraffic as (select dataendtime Date ,parentasin ASIN ,sum(ifnull(trafficbyasin:\"browserPageViews\",0)) Browser_Page_Views ,sum(ifnull(trafficbyasin:\"browserSessions\",0)) Browser_Sessions ,sum(ifnull(trafficbyasin:\"buyBoxPercentage\",0)) BuyBox_Percentage ,sum(ifnull(trafficbyasin:\"mobileAppPageViews\",0)) MobileApp_Page_Views ,sum(ifnull(trafficbyasin:\"mobileAppSessions\",0)) MobileApp_Sessions ,sum(ifnull(trafficbyasin:\"pageViews\",0)) Page_Views ,sum(ifnull(trafficbyasin:\"sessions\",0)) Sessions ,sum(ifnull(sales.value:\"unitsOrdered\"::float,0)) SC_UnitsOrdered ,sum(ifnull(sales.value:\"totalOrderItems\"::float,0)) SC_ItemsOrdered ,sum(ifnull(sales.value:\"orderedProductSales\":\"amount\"::float,0)) SC_Sales from datalake_db.beardo.trn_asp_beardo_india_get_sales_and_traffic_report_asin, lateral flatten (input => salesbyasin) Sales group by dataendtime, parentasin ) select ASPTRAFFIC.* ,null Product_Name_Final ,null Mapped_Product_Category ,null Mapped_Sub_Category ,null SKU from ASPTRAFFIC ), SPSDASIN as ( select DATE ,ASIN ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(impressions,0) end) SD_IMPRESSIONS ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(impressions,0) end) SP_IMPRESSIONS ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(clicks,0) end) SD_CLICKS ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(clicks,0) end) SP_CLICKS ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(conversions,0) end) SD_AD_conversions ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversions,0) END) AS SP_AD_conversions ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(spend,0) END) AS SD_AD_spend ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(spend,0) END) AS SP_AD_spend ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(adsales,0) END) AS SD_adsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(adsales,0) END) AS SP_adsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(conversionssamesku,0) END) AS SD_AD_conversionssamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversionssamesku,0) END) AS SP_AD_conversionssamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(conversionsothersku,0) END) AS SD_AD_conversionsothersku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(conversionsothersku,0) END) AS SP_AD_conversionsothersku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(salessamesku,0) END) AS SD_AD_salessamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(salessamesku,0) END) AS SP_AD_salessamesku ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(OTHERSKUSALES,0) END) AS SD_AD_OTHERSKUSALES ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(OTHERSKUSALES,0) END) AS SP_AD_OTHERSKUSALES ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%display%\' THEN IFNULL(newtobrandsales,0) END) AS SD_AD_newtobrandsales ,SUM(CASE WHEN LOWER(CAMPAIGN_TYPE) LIKE \'%product%\' THEN IFNULL(newtobrandsales,0) END) AS SP_AD_newtobrandsales ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(newtobrandunits,0) end) as SD_AD_newtobrandunits ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(newtobrandunits,0) end) as SP_AD_newtobrandunits ,sum(case when lower(CAMPAIGN_TYPE) like \'%display%\' then ifnull(newtobrandorders,0) end) as SD_AD_newtobrandorders ,sum(case when lower(CAMPAIGN_TYPE) like \'%product%\' then ifnull(newtobrandorders,0) end) as SP_AD_newtobrandorders from prd_db.beardo.dwh_amazonads_marketing where lower(campaign_type) like any (\'%products%\', \'%display%\') group by DATE ,ASIN ), SBSBVCampaigns as ( select A.Date ,null as ASIN ,A.IMPRESSIONS ,case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(impressions,0) end SBV_IMPRESSIONS ,case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(impressions,0) end SB_IMPRESSIONS , A.Clicks , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(clicks,0) end SBV_CLICKS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(clicks,0) end SB_CLICKS , A.Ad_CONVERSIONS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_conversions,0) end SBV_AD_CONVERSIONS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_conversions,0) end SB_AD_CONVERSIONS , A.SPEND , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(spend,0) end SBV_SPEND , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(spend,0) end SB_SPEND , A.AD_Sales , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_sales,0) end SBV_AD_SALES , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_sales,0) end SB_AD_SALES , A.Ad_CONVERSIONSSAMESKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_conversionssamesku,0) end SBV_AD_CONVERSIONS_SAME_SKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_conversionssamesku,0) end SB_AD_CONVERSIONS_SAME_SKU , A.AD_CONVERSIONOTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(AD_conversionothersku,0) end SBV_CONVERSIONOTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_conversionothersku,0) end SB_CONVERSIONOTHERSKU , A.AD_SalesSAMESKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(Ad_salessamesku,0) end SBV_SALES_SAMESKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_salessamesku,0) end SB_SALES_SAMESKU , A.AD_SalesOTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(AD_salesothersku,0) end SBV_SALES_OTHERSKU , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(AD_salesothersku,0) end SB_SALES_OTHERSKU , A.AD_NEWTOBRAND_ORDERS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_newtobrand_orders,0) end SBV_AD_NEWTOBRAND_ORDERS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_orders,0) end SB_AD_NEWTOBRAND_ORDERS , A.AD_NEWTOBRAND_SALES , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_newtobrand_sales,0) end SBV_AD_NEWTOBRAND_SALES , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_sales,0) end SB_AD_NEWTOBRAND_SALES , A.AD_NEWTOBRAND_UNITS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands video\' then ifnull(ad_newtobrand_units,0) end SBV_AD_NEWTOBRAND_UNITS , case when lower(CAMPAIGN_TYPE) = \'sponsored brands\' then ifnull(ad_newtobrand_units,0) end SB_AD_NEWTOBRAND_UNITS from (select A.DATE ,null as sub_category ,campaign_type ,sum(ifnull(impressions,0)) IMPRESSIONS ,sum(ifnull(clicks,0)) CLICKS ,sum(ifnull(conversions,0)) Ad_CONVERSIONS ,sum(ifnull(spend,0)) SPEND ,sum(ifnull(adsales,0)) AD_Sales ,sum(ifnull(conversionssamesku,0)) Ad_CONVERSIONSSAMESKU ,sum(ifnull(conversionsothersku,0)) AD_CONVERSIONOTHERSKU ,sum(ifnull(salessamesku,0)) AD_SalesSAMESKU ,sum(ifnull(OTHERSKUSALES,0)) AD_SalesOTHERSKU ,sum(ifnull(newtobrandorders,0)) AD_NEWTOBRAND_ORDERS ,sum(ifnull(newtobrandsales,0)) AD_NEWTOBRAND_SALES ,sum(ifnull(newtobrandunits,0)) AD_NEWTOBRAND_UNITS from prd_db.beardo.dwh_amazonads_marketing A where lower(A.campaign_type) like any (\'%brand%\') group by A.DATE, A.campaign_type ) A ) select coalesce(A.Date, B.Date) Date ,coalesce(A.ASIN, B.ASIN) ASIN ,null Product_Name_Final ,null Category ,null Sub_Category ,SD_IMPRESSIONS ,SP_IMPRESSIONS ,SD_CLICKS ,SP_CLICKS ,SD_AD_conversions ,SP_AD_conversions ,SD_AD_spend ,SP_AD_spend ,SD_adsales ,SP_adsales ,SD_AD_conversionssamesku ,SP_AD_conversionssamesku ,SD_AD_conversionsothersku ,SP_AD_conversionsothersku ,SD_AD_salessamesku ,SP_AD_salessamesku ,SD_AD_OTHERSKUSALES ,SP_AD_OTHERSKUSALES ,SD_AD_newtobrandsales ,SP_AD_newtobrandsales ,SD_AD_newtobrandunits ,SP_AD_newtobrandunits ,SD_AD_newtobrandorders ,SP_AD_newtobrandorders ,SBV_Impressions ,SB_Impressions ,SBV_Clicks ,SB_Clicks ,SBV_Ad_Conversions ,SB_Ad_Conversions ,SBV_Spend ,SB_Spend ,SBV_Ad_Sales ,SB_Ad_Sales ,SBV_Ad_Conversions_Same_SKU ,SB_Ad_Conversions_Same_SKU ,SBV_ConversionOtherSKU ,SB_ConversionOtherSKU ,SBV_Sales_SameSKU ,SB_Sales_SameSKU ,SBV_Sales_OtherSKU ,SB_Sales_OtherSKU ,SBV_AD_NEWTOBRAND_ORDERS ,SB_AD_NEWTOBRAND_ORDERS ,SBV_AD_NEWTOBRAND_SALES ,SB_AD_NEWTOBRAND_SALES ,SBV_AD_NEWTOBRAND_UNITS ,SB_AD_NEWTOBRAND_UNITS from SPSDASIN A full outer join SBSBVCampaigns B on A.Date=B.Date and A.ASIN =B.ASIN ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from PRD_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        