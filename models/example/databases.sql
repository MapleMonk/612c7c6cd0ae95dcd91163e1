{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE prd_db.beardo.dwh_FACEBOOK_CONSOLIDATED AS select Adset_Name ,Adset_ID ,FB.ad_id ,FB.ad_name ,Account_Name ,Account_ID ,Campaign_Name ,Campaign_ID ,Fb.date_start::date Date ,SUM(CLICKS) Clicks ,SUM(SPEND) Spend ,SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value ,sum(nvl(fd.add_to_carts,0)) Add_to_carts ,sum(nvl(fdv.add_to_cart_value,0)) Add_to_cart_value ,sum(nvl(fe.landing_page_views,0)) Landing_page_views ,sum(nvl(ff.initiate_checkouts,0)) Initiate_checkouts ,sum(nvl(ffv.initiate_checkouts_value,0)) Initiate_checkouts_value ,\'Facebook\' Channel ,\'Facebook India\' Account from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS FB left join ( select ad_id ,ad_name ,date_start ,SUM(C.value:value) Conversions from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id ,ad_name ,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id ,ad_name ,date_start ,SUM(CV.value:\"1d_click\") Conversion_Value from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id ,ad_name ,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start left join ( select ad_id ,date_start ,SUM(C.value:value) add_to_carts from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_add_to_cart\' group by ad_id,date_start having SUM(C.value:value) is not null )Fd ON Fb.ad_id = Fd.ad_id and Fb.date_start=Fd.date_start left join ( select ad_id ,date_start ,SUM(CV.value:value) Add_to_cart_Value from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_add_to_cart\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fdv ON Fb.ad_id = Fdv.ad_id and Fb.date_start=Fdv.date_start left join ( select ad_id ,date_start ,SUM(C.value:value) Landing_page_views from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'landing_page_view\' group by ad_id,date_start having SUM(C.value:value) is not null )Fe ON Fb.ad_id = Fe.ad_id and Fb.date_start=Fe.date_start left join ( select ad_id ,date_start ,SUM(C.value:value) Initiate_checkouts from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_initiate_checkout\' group by ad_id,date_start having SUM(C.value:value) is not null )Ff ON Fb.ad_id = Ff.ad_id and Fb.date_start=Ff.date_start left join ( select ad_id ,date_start ,SUM(CV.value:value) Initiate_checkouts_Value from datalake_db.beardo.trn_Facebook_beardo_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_initiate_checkout\' group by ad_id,date_start having SUM(CV.value:value) is not null )Ffv ON Fb.ad_id = Ffv.ad_id and Fb.date_start=Ffv.date_start group by Adset_Name, Adset_ID,fb.ad_id,fb.AD_NAME, Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start ; CREATE OR REPLACE TABLE prd_db.beardo.dwh_GOOGLEADS_CONSOLIDATED AS select NULL ADSET_NAME ,NULL ADSET_ID ,NULL AD_ID ,NULL AD_NAME ,NULL ACCOUNT_NAME ,NULL ACCOUNT_ID ,\"campaign.name\" CAMPAIGN_NAME ,\"campaign.id\" CAMPAIGN_ID ,\"segments.date\" DATE ,NULL AD_TYPE ,NULL AD_STRENGTH ,NULL AD_NETWORK_TYPE ,NULL AD_FINAL_URL ,dayofweek(\"segments.date\") DAY_OF_WEEK ,YEAR(\"segments.date\") YEAR1 ,MONTH(\"segments.date\") MONTH1 ,\'Google\' Channel ,\'Google_ads_INR_Beardo\' ACCOUNT ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value from datalake_db.Beardo.trn_Google_ads_INR_Beardo_campaign_data group by \"campaign.name\", \"campaign.id\", \"segments.date\" ; create table if not exists prd_db.Beardo.dwh_AMAZONADS_marketing ( ACCOUNT_NAME varchar ,PROFILEID varchar ,CAMPAIGNNAME varchar ,CAMPAIGNID varchar ,adGroupName varchar ,adGroupId varchar ,ADID varchar ,AD_NAME varchar ,DATE varchar ,CAMPAIGN_TYPE varchar ,AD_STRENGTH varchar ,AD_NETWORK_TYPE varchar ,AD_URL varchar ,DAY_OF_WEEK varchar ,YEAR1 varchar ,MONTH1 varchar ,CHANNEL varchar ,ACCOUNT varchar ,CLICKS varchar ,SPEND varchar ,IMPRESSIONS varchar ,CONVERSIONS varchar ,AdSales varchar ,ADD_TO_CARTS varchar ,ADD_TO_CART_VALUE varchar ,LANDING_PAGE_VIEWS varchar ,Initiate_checkouts varchar ,Initiate_checkouts_value varchar); create table if not exists prd_db.Beardo.dwh_GOOGLEADS_CONSOLIDATED (ACCOUNT_NAME varchar ,ACCOUNT_ID varchar ,CAMPAIGN_NAME varchar ,CAMPAIGN_ID varchar ,ADSET_NAME varchar ,ADSET_ID varchar ,AD_ID varchar ,AD_NAME varchar ,Date varchar ,AD_TYPE varchar ,AD_STRENGTH varchar ,AD_NETWORK_TYPE varchar ,AD_FINAL_URL varchar ,Day_of_Week varchar ,YEAR1 varchar ,MONTH1 varchar ,Channel varchar ,ACCOUNT varchar ,clicks varchar ,spend varchar ,impressions varchar ,conversions varchar ,conversion_value varchar ,Add_to_carts varchar ,Add_to_cart_value varchar ,Landing_page_views varchar ,Initiate_checkouts varchar ,Initiate_checkouts_value varchar); CREATE OR REPLACE TABLE prd_db.Beardo.dwh_MARKETING_CONSOLIDATED AS select * from ( select ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,ADSET_NAME ,ADSET_ID ,AD_ID ,AD_NAME ,DATE ,NULL AD_TYPE ,NULL AD_STRENGTH ,NULL AD_NETWORK_TYPE ,NULL AD_URL ,dayofweek(DATE) Day_of_Week ,YEAR(DATE) AS YEAR1 ,MONTH(DATE) AS MONTH1 ,CHANNEL ,ACCOUNT ,Clicks ,Spend ,Impressions ,Conversions ,Conversion_Value ,Add_to_carts ,Add_to_cart_value ,Landing_page_views ,Initiate_checkouts ,Initiate_checkouts_value ,case when lower(campaign_name) like \'%branding%\' then \'Branding\' when lower(campaign_name) like \'%performance%\' then \'Performance\' end as branding_campaign from prd_db.Beardo.DWH_FACEBOOK_CONSOLIDATED union select ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,ADSET_NAME ,ADSET_ID ,AD_ID ,AD_NAME ,Date ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_FINAL_URL ,Day_of_Week ,YEAR1 ,MONTH1 ,Channel ,ACCOUNT ,clicks ,spend ,impressions ,conversions ,conversions_value ,null as Add_to_carts ,null as Add_to_cart_value ,null as Landing_page_views ,null as Initiate_checkouts ,null as Initiate_checkouts_value ,case when lower(campaign_name) like \'%branding%\' then \'Branding\' when lower(campaign_name) like \'%performance%\' then \'Performance\' end as branding_campaign from prd_db.beardo.dwh_GOOGLEADS_CONSOLIDATED Union Select \'Amazon\' AS ACCOUNT_NAME ,PROFILEID ,CAMPAIGNNAME ,CAMPAIGNID ,adGroupName ,adGroupId ,ADID ,NULL AS AD_NAME ,DATE ,CAMPAIGN_TYPE ,NULL AS AD_STRENGTH ,NULL AS AD_NETWORK_TYPE ,NULL AS AD_URL ,dayofweek(DATE) DAY_OF_WEEK ,YEAR(DATE) YEAR1 ,MONTH(DATE) MONTH1 ,\'AMAZON\' AS CHANNEL ,NULL AS ACCOUNT ,sum(CLICKS) ,sum(SPEND) ,sum(IMPRESSIONS) ,sum(CONVERSIONS) ,sum(AdSales) ,NULL AS ADD_TO_CARTS ,NULL AS ADD_TO_CART_VALUE ,NULL AS LANDING_PAGE_VIEWS ,null as Initiate_checkouts ,null as Initiate_checkouts_value ,case when lower(campaignname) like \'%branding%\' then \'Branding\' when lower(campaignname) like \'%performance%\' then \'Performance\' end as branding_campaign FROM prd_db.Beardo.dwh_AMAZONADS_MARKETING group by ACCOUNT_NAME ,PROFILEID ,CAMPAIGNNAME ,CAMPAIGNID ,adGroupName ,adGroupId ,ADID ,AD_NAME ,DATE ,CAMPAIGN_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAYNAME(DATE) ,YEAR(DATE) ,MONTH(DATE) ,CHANNEL ,ACCOUNT ) where channel not in (\'AMAZON\') ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from PRD_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        