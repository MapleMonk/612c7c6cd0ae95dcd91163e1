{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE GLADFUL_DB.MAPLEMONK.GA_ORDER_BY_SOURCE_CONSOLIDATED_GLADFUL AS select \'SHOPIFY_GLADFUL\' as Shop_Name ,upper(case when GCM.final_channel is null then case when lower(GASC.GA_SOURCEMEDIUM) like \'%google%\' then \'Google\' when lower(GASC.GA_SOURCEMEDIUM) like \'%facebook%\' then \'Facebook\' when lower(GASC.GA_SOURCEMEDIUM) like \'%instagram%\' then \'Instagram\' when lower(GASC.GA_SOURCEMEDIUM) like \'%direct%\' then \'Direct\' when lower(GASC.GA_SOURCEMEDIUM) like \'%webengage%\' then \'Push Notification\' when lower(GASC.GA_SOURCEMEDIUM) like \'%chatbot%\' then \'Whatsapp\' when lower(GASC.GA_SOURCEMEDIUM) like \'%email%\' then \'Email\' when lower(GASC.GA_SOURCEMEDIUM) like \'%cashfree%\' then \'Payment Providers\' when lower(GASC.GA_SOURCEMEDIUM) like \'%affiliate%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%youtube%\' then \'Google\' when lower(GASC.GA_SOURCEMEDIUM) like \'%duckduckgo%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%linkedin%\' then \'LinkedIn\' when lower(GASC.GA_SOURCEMEDIUM) like \'%bing%\' then \'Organic\' when lower(GASC.GA_SOURCEMEDIUM) like \'%whatsapp%\' then \'Whatsapp\' when lower(GASC.GA_SOURCEMEDIUM) like \'%paytm%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%grabon%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%sms%\' then \'SMS\' when lower(GASC.GA_SOURCEMEDIUM) like \'%yahoo%\' then \'Organic\' when lower(GASC.GA_SOURCEMEDIUM) like \'%referral%\' then \'Referral\' else GASC.GA_SOURCEMEDIUM end else GCM.final_channel end) Channel ,upper(case when GCM.final_source is null then case when lower(GASC.GA_SOURCEMEDIUM) like \'%google%\' then \'Google\' when lower(GASC.GA_SOURCEMEDIUM) like \'%facebook%\' then \'Facebook\' when lower(GASC.GA_SOURCEMEDIUM) like \'%instagram%\' then \'Instagram\' when lower(GASC.GA_SOURCEMEDIUM) like \'%direct%\' then \'Direct\' when lower(GASC.GA_SOURCEMEDIUM) like \'%webengage%\' then \'Push Notification\' when lower(GASC.GA_SOURCEMEDIUM) like \'%chatbot%\' then \'Whatsapp\' when lower(GASC.GA_SOURCEMEDIUM) like \'%email%\' then \'Email\' when lower(GASC.GA_SOURCEMEDIUM) like \'%cashfree%\' then \'Payment Providers\' when lower(GASC.GA_SOURCEMEDIUM) like \'%affiliate%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%youtube%\' then \'Google\' when lower(GASC.GA_SOURCEMEDIUM) like \'%duckduckgo%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%linkedin%\' then \'LinkedIn\' when lower(GASC.GA_SOURCEMEDIUM) like \'%bing%\' then \'Organic\' when lower(GASC.GA_SOURCEMEDIUM) like \'%whatsapp%\' then \'Whatsapp\' when lower(GASC.GA_SOURCEMEDIUM) like \'%paytm%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%grabon%\' then \'Affiliate\' when lower(GASC.GA_SOURCEMEDIUM) like \'%sms%\' then \'SMS\' when lower(GASC.GA_SOURCEMEDIUM) like \'%yahoo%\' then \'Organic\' when lower(GASC.GA_SOURCEMEDIUM) like \'%referral%\' then \'Referral\' else GASC.GA_SOURCEMEDIUM end else GCM.final_source end) Source ,GASC.* from (select GA_DATE ,VIEW_ID ,GA_MEDIUM ,GA_SOURCE ,GA_CAMPAIGN ,GA_SOURCEMEDIUM ,GA_TRANSACTIONID ,GA_REVENUEPERTRANSACTION from GLADFUL_DB.MAPLEMONK.gladful_ga__source__by__order where ga_date < \'2023-08-01\' union all select try_to_date(date,\'yyyymmdd\') date ,PROPERTY_ID ,MEDIUM ,SOURCE ,CAMPAIGNNAME ,SOURCEMEDIUM ,TRANSACTIONID ,GROSSPURCHASEREVENUE from GLADFUL_DB.MAPLEMONK.ga4_gladful_orders_by_source where try_to_date(date,\'yyyymmdd\') >= \'2023-08-01\' )GASC left join (select * from (select GA_SOURCEMEDIUM, final_channel, final_source, row_number() over (partition by lower(GA_SOURCEMEDIUM) order by lower(GA_SOURCEMEDIUM)) rw from GLADFUL_DB.MAPLEMONK.GA_CHANNEL_MAPPING) where rw=1) GCM on lower(GASC.GA_SOURCEMEDIUM) = lower(GCM.GA_SOURCEMEDIUM); CREATE OR REPLACE TABLE GLADFUL_DB.MAPLEMONK.GA_Sessions_Consolidated_GLADFUL AS select \'SHOPIFY_GLADFUL\' as Shop_Name ,upper(case when GCM.final_channel is null then case when lower(GASC.GA_SOURCE) like \'%google%\' then \'Google\' when lower(GASC.GA_SOURCE) like \'%facebook%\' then \'Facebook\' when lower(GASC.GA_SOURCE) like \'%instagram%\' then \'Instagram\' when lower(GASC.GA_SOURCE) like \'%direct%\' then \'Direct\' when lower(GASC.GA_SOURCE) like \'%webengage%\' then \'Push Notification\' when lower(GASC.GA_SOURCE) like \'%chatbot%\' then \'Whatsapp\' when lower(GASC.GA_SOURCE) like \'%email%\' then \'Email\' when lower(GASC.GA_SOURCE) like \'%cashfree%\' then \'Payment Providers\' when lower(GASC.GA_SOURCE) like \'%affiliate%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%youtube%\' then \'Google\' when lower(GASC.GA_SOURCE) like \'%duckduckgo%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%linkedin%\' then \'LinkedIn\' when lower(GASC.GA_SOURCE) like \'%bing%\' then \'Organic\' when lower(GASC.GA_SOURCE) like \'%whatsapp%\' then \'Whatsapp\' when lower(GASC.GA_SOURCE) like \'%paytm%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%grabon%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%sms%\' then \'SMS\' when lower(GASC.GA_SOURCE) like \'%yahoo%\' then \'Organic\' when lower(GASC.GA_SOURCE) like \'%referral%\' then \'Referral\' else \'Others\' end else GCM.final_channel end) Channel ,upper(case when GCM.final_channel is null then case when lower(GASC.GA_SOURCE) like \'%google%\' then \'Google\' when lower(GASC.GA_SOURCE) like \'%facebook%\' then \'Facebook\' when lower(GASC.GA_SOURCE) like \'%instagram%\' then \'Instagram\' when lower(GASC.GA_SOURCE) like \'%direct%\' then \'Direct\' when lower(GASC.GA_SOURCE) like \'%webengage%\' then \'Push Notification\' when lower(GASC.GA_SOURCE) like \'%chatbot%\' then \'Whatsapp\' when lower(GASC.GA_SOURCE) like \'%email%\' then \'Email\' when lower(GASC.GA_SOURCE) like \'%cashfree%\' then \'Payment Providers\' when lower(GASC.GA_SOURCE) like \'%affiliate%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%youtube%\' then \'Google\' when lower(GASC.GA_SOURCE) like \'%duckduckgo%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%linkedin%\' then \'LinkedIn\' when lower(GASC.GA_SOURCE) like \'%bing%\' then \'Organic\' when lower(GASC.GA_SOURCE) like \'%whatsapp%\' then \'Whatsapp\' when lower(GASC.GA_SOURCE) like \'%paytm%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%grabon%\' then \'Affiliate\' when lower(GASC.GA_SOURCE) like \'%sms%\' then \'SMS\' when lower(GASC.GA_SOURCE) like \'%yahoo%\' then \'Organic\' when lower(GASC.GA_SOURCE) like \'%referral%\' then \'Referral\' else GASC.GA_SOURCE end else GCM.final_source end) Source ,GASC.* from (select GA_DATE ,VIEW_ID ,GA_EXITS ,GA_USERS ,GA_MEDIUM ,GA_SOURCE ,GA_CAMPAIGN ,GA_NEWUSERS ,GA_SESSIONS ,GA_PAGEVIEWS ,GA_SOURCEMEDIUM ,GA_UNIQUEPAGEVIEWS ,GA_AVGSESSIONDURATION from GLADFUL_DB.MAPLEMONK.gladful_ga__session_by__date where ga_Date < \'2023-08-01\' union all Select try_to_date(date,\'yyyymmdd\') DATE ,PROPERTY_ID ,0 as EXITS ,TOTALUSERS ,SESSIONMEDIUM ,SESSIONSOURCE ,SESSIONCAMPAIGNNAME ,NEWUSERS ,SESSIONS ,SCREENPAGEVIEWS ,SESSIONSOURCEMEDIUM ,SCREENPAGEVIEWS ,AVERAGESESSIONDURATION from GLADFUL_DB.MAPLEMONK.ga4_gladful_sessions_by_date_campaign where try_to_date(date,\'yyyymmdd\') >= \'2023-08-01\' ) GASC left join (select * from (select GA_SOURCE, final_channel, final_source, row_number() over (partition by lower(GA_SOURCE) order by lower(GA_SOURCE)) rw from GLADFUL_DB.MAPLEMONK.GA_CHANNEL_MAPPING) where rw=1) GCM on lower(GASC.GA_SOURCE) = lower(GCM.GA_SOURCE);",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from GLADFUL_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        