{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table eggozdb.maplemonk.beat_material_demand_supply as select m.id, max(beat_date) as beat_date, max(beat_number) beat_number, max(beat_name) beat_name, max(FSE) FSE, max(demand_classification) demand_classification, max(description) as description, max(name) as loading_point, sum(\"6W_demand\") \"6W_demand\", sum(\"10W_demand\") \"10W_demand\", sum(\"12W_demand\") \"12W_demand\", sum(\"25W_demand\") \"25W_demand\", sum(\"30W_demand\") \"30W_demand\", sum(\"30WR_demand\") \"30WR_demand\", sum(\"6B_demand\") \"6B_demand\", sum(\"10B_demand\") \"10B_demand\", sum(\"25B_demand\") \"25B_demand\", sum(\"30B_demand\") \"30B_demand\", sum(\"10N_demand\") \"10N_demand\", sum(\"6W_supply\") \"6W_supply\", sum(\"10W_supply\") \"10W_supply\", sum(\"12W_supply\") \"12W_supply\", sum(\"25W_supply\") \"25W_supply\", sum(\"30W_supply\") \"30W_supply\", sum(\"30WR_supply\") \"30WR_supply\", sum(\"6B_supply\") \"6B_supply\", sum(\"10B_supply\") \"10B_supply\", sum(\"25B_supply\") \"25B_supply\", sum(\"30B_supply\") \"30B_supply\", sum(\"10N_supply\") \"10N_supply\", sum(\"6W_out\") \"6W_out\", sum(\"10W_out\") \"10W_out\", sum(\"12W_out\") \"12W_out\", sum(\"25W_out\") \"25W_out\", sum(\"30W_out\") \"30W_out\", sum(\"30WR_out\") \"30WR_out\", sum(\"6B_out\") \"6B_out\", sum(\"10B_out\") \"10B_out\", sum(\"25B_out\") \"25B_out\", sum(\"30B_out\") \"30B_out\", sum(\"10N_out\") \"10N_out\", sum(\"6W_transfer\") \"6W_transfer\", sum(\"10W_transfer\") \"10W_transfer\", sum(\"12W_transfer\") \"12W_transfer\", sum(\"25W_transfer\") \"25W_transfer\", sum(\"30W_transfer\") \"30W_transfer\", sum(\"30WR_transfer\") \"30WR_transfer\", sum(\"6B_transfer\") \"6B_transfer\", sum(\"10B_transfer\") \"10B_transfer\", sum(\"25B_transfer\") \"25B_transfer\", sum(\"30B_transfer\") \"30B_transfer\", sum(\"10N_transfer\") \"10N_transfer\", sum(\"6W_sold\") \"6W_sold\", sum(\"10W_sold\") \"10W_sold\", sum(\"12W_sold\") \"12W_sold\", sum(\"25W_sold\") \"25W_sold\", sum(\"30W_sold\") \"30W_sold\", sum(\"30WR_sold\") \"30WR_sold\", sum(\"6B_sold\") \"6B_sold\", sum(\"10B_sold\") \"10B_sold\", sum(\"25B_sold\") \"25B_sold\", sum(\"30B_sold\") \"30B_sold\", sum(\"10N_sold\") \"10N_sold\", sum(\"6W_return\") \"6W_return\", sum(\"10W_return\") \"10W_return\", sum(\"12W_return\") \"12W_return\", sum(\"25W_return\") \"25W_return\", sum(\"30W_return\") \"30W_return\", sum(\"30WR_return\") \"30WR_return\", sum(\"6B_return\") \"6B_return\", sum(\"10B_return\") \"10B_return\", sum(\"25B_return\") \"25B_return\", sum(\"30B_return\") \"30B_return\", sum(\"10N_return\") \"10N_return\", sum(\"6W_replacement\") \"6W_replacement\", sum(\"10W_replacement\") \"10W_replacement\", sum(\"12W_replacement\") \"12W_replacement\", sum(\"25W_replacement\") \"25W_replacement\", sum(\"30W_replacement\") \"30W_replacement\", sum(\"30WR_replacement\") \"30WR_replacement\", sum(\"6B_replacement\") \"6B_replacement\", sum(\"10B_replacement\") \"10B_replacement\", sum(\"25B_replacement\") \"25B_replacement\", sum(\"30B_replacement\") \"30B_replacement\", sum(\"10N_replacement\") \"10N_replacement\", sum(\"6W_promo\") \"6W_promo\", sum(\"10W_promo\") \"10W_promo\", sum(\"12W_promo\") \"12W_promo\", sum(\"25W_promo\") \"25W_promo\", sum(\"30W_promo\") \"30W_promo\", sum(\"30WR_promo\") \"30WR_promo\", sum(\"6B_promo\") \"6B_promo\", sum(\"10B_promo\") \"10B_promo\", sum(\"25B_promo\") \"25B_promo\", sum(\"30B_promo\") \"30B_promo\", sum(\"10N_promo\") \"10N_promo\", sum(\"6W_fresh_in\") \"6W_fresh_in\", sum(\"10W_fresh_in\") \"10W_fresh_in\", sum(\"12W_fresh_in\") \"12W_fresh_in\", sum(\"25W_fresh_in\") \"25W_fresh_in\", sum(\"30W_fresh_in\") \"30W_fresh_in\", sum(\"30WR_fresh_in\") \"30WR_fresh_in\", sum(\"6B_fresh_in\") \"6B_fresh_in\", sum(\"10B_fresh_in\") \"10B_fresh_in\", sum(\"25B_fresh_in\") \"25B_fresh_in\", sum(\"30B_fresh_in\") \"30B_fresh_in\", sum(\"10N_fresh_in\") \"10N_fresh_in\", sum(\"6W_damage\") \"6W_damage\", sum(\"10W_damage\") \"10W_damage\", sum(\"12W_damage\") \"12W_damage\", sum(\"25W_damage\") \"25W_damage\", sum(\"30W_damage\") \"30W_damage\", sum(\"30WR_damage\") \"30WR_damage\", sum(\"6B_damage\") \"6B_damage\", sum(\"10B_damage\") \"10B_damage\", sum(\"25B_damage\") \"25B_damage\", sum(\"30B_damage\") \"30B_damage\", sum(\"10N_damage\") \"10N_damage\", sum(\"6W_old_in\") \"6W_old_in\", sum(\"10W_old_in\") \"10W_old_in\", sum(\"12W_old_in\") \"12W_old_in\", sum(\"25W_old_in\") \"25W_old_in\", sum(\"30W_old_in\") \"30W_old_in\", sum(\"30WR_old_in\") \"30WR_old_in\", sum(\"6B_old_in\") \"6B_old_in\", sum(\"10B_old_in\") \"10B_old_in\", sum(\"25B_old_in\") \"25B_old_in\", sum(\"30B_old_in\") \"30B_old_in\", sum(\"10N_old_in\") \"10N_old_in\" from (select lll.id, lll.beat_date, lll.beat_number, lll.beat_name, lll.demand_classification, lll.description, lll.name, lll.FSE, (case when lll.sku = \'6White\' then lll.product_quantity else 0 end) \"6W_demand\", (case when lll.sku = \'10White\' then lll.product_quantity else 0 end) as \"10W_demand\", (case when lll.sku = \'12White\' then lll.product_quantity else 0 end) \"12W_demand\", (case when lll.sku = \'25White\' then lll.product_quantity else 0 end) as \"25W_demand\", (case when lll.sku = \'30White\' then lll.product_quantity else 0 end) as \"30W_demand\", (case when lll.sku = \'30White Regular\' then lll.product_quantity else 0 end) as \"30WR_demand\", (case when lll.sku = \'6Brown\' then lll.product_quantity else 0 end) \"6B_demand\", (case when lll.sku = \'10Brown\' then lll.product_quantity else 0 end) as \"10B_demand\", (case when lll.sku = \'25Brown\' then lll.product_quantity else 0 end) as \"25B_demand\", (case when lll.sku = \'30Brown\' then lll.product_quantity else 0 end) as \"30B_demand\", (case when lll.sku = \'10Nutra\' then lll.product_quantity else 0 end) as \"10N_demand\", (case when lll.sku = \'6White\' then lll.product_supply_quantity else 0 end) \"6W_supply\", (case when lll.sku = \'10White\' then lll.product_supply_quantity else 0 end) as \"10W_supply\", (case when lll.sku = \'12White\' then lll.product_supply_quantity else 0 end) \"12W_supply\", (case when lll.sku = \'25White\' then lll.product_supply_quantity else 0 end) as \"25W_supply\", (case when lll.sku = \'30White\' then lll.product_supply_quantity else 0 end) as \"30W_supply\", (case when lll.sku = \'30White Regular\' then lll.product_supply_quantity else 0 end) as \"30WR_supply\", (case when lll.sku = \'6Brown\' then lll.product_supply_quantity else 0 end) \"6B_supply\", (case when lll.sku = \'10Brown\' then lll.product_supply_quantity else 0 end) as \"10B_supply\", (case when lll.sku = \'25Brown\' then lll.product_supply_quantity else 0 end) as \"25B_supply\", (case when lll.sku = \'30Brown\' then lll.product_supply_quantity else 0 end) as \"30B_supply\", (case when lll.sku = \'10Nutra\' then lll.product_supply_quantity else 0 end) as \"10N_supply\", (case when lll.sku = \'6White\' then lll.product_out_quantity else 0 end) \"6W_out\", (case when lll.sku = \'10White\' then lll.product_out_quantity else 0 end) as \"10W_out\", (case when lll.sku = \'12White\' then lll.product_out_quantity else 0 end) \"12W_out\", (case when lll.sku = \'25White\' then lll.product_out_quantity else 0 end) as \"25W_out\", (case when lll.sku = \'30White\' then lll.product_out_quantity else 0 end) as \"30W_out\", (case when lll.sku = \'30White Regular\' then lll.product_out_quantity else 0 end) as \"30WR_out\", (case when lll.sku = \'6Brown\' then lll.product_out_quantity else 0 end) \"6B_out\", (case when lll.sku = \'10Brown\' then lll.product_out_quantity else 0 end) as \"10B_out\", (case when lll.sku = \'25Brown\' then lll.product_out_quantity else 0 end) as \"25B_out\", (case when lll.sku = \'30Brown\' then lll.product_out_quantity else 0 end) as \"30B_out\", (case when lll.sku = \'10Nutra\' then lll.product_out_quantity else 0 end) as \"10N_out\", (case when lll.sku = \'6White\' then lll.product_transfer_quantity else 0 end) \"6W_transfer\", (case when lll.sku = \'10White\' then lll.product_transfer_quantity else 0 end) as \"10W_transfer\", (case when lll.sku = \'12White\' then lll.product_transfer_quantity else 0 end) \"12W_transfer\", (case when lll.sku = \'25White\' then lll.product_transfer_quantity else 0 end) as \"25W_transfer\", (case when lll.sku = \'30White\' then lll.product_transfer_quantity else 0 end) as \"30W_transfer\", (case when lll.sku = \'30White Regular\' then lll.product_transfer_quantity else 0 end) as \"30WR_transfer\", (case when lll.sku = \'6Brown\' then lll.product_transfer_quantity else 0 end) \"6B_transfer\", (case when lll.sku = \'10Brown\' then lll.product_transfer_quantity else 0 end) as \"10B_transfer\", (case when lll.sku = \'25Brown\' then lll.product_transfer_quantity else 0 end) as \"25B_transfer\", (case when lll.sku = \'30Brown\' then lll.product_transfer_quantity else 0 end) as \"30B_transfer\", (case when lll.sku = \'10Nutra\' then lll.product_transfer_quantity else 0 end) as \"10N_transfer\", (case when lll.sku = \'6White\' then lll.product_sold_quantity else 0 end) \"6W_sold\", (case when lll.sku = \'10White\' then lll.product_sold_quantity else 0 end) as \"10W_sold\", (case when lll.sku = \'12White\' then lll.product_sold_quantity else 0 end) \"12W_sold\", (case when lll.sku = \'25White\' then lll.product_sold_quantity else 0 end) as \"25W_sold\", (case when lll.sku = \'30White\' then lll.product_sold_quantity else 0 end) as \"30W_sold\", (case when lll.sku = \'30White Regular\' then lll.product_sold_quantity else 0 end) as \"30WR_sold\", (case when lll.sku = \'6Brown\' then lll.product_sold_quantity else 0 end) \"6B_sold\", (case when lll.sku = \'10Brown\' then lll.product_sold_quantity else 0 end) as \"10B_sold\", (case when lll.sku = \'25Brown\' then lll.product_sold_quantity else 0 end) as \"25B_sold\", (case when lll.sku = \'30Brown\' then lll.product_sold_quantity else 0 end) as \"30B_sold\", (case when lll.sku = \'10Nutra\' then lll.product_sold_quantity else 0 end) as \"10N_sold\", (case when lll.sku = \'6White\' then lll.product_return_quantity else 0 end) \"6W_return\", (case when lll.sku = \'10White\' then lll.product_return_quantity else 0 end) as \"10W_return\", (case when lll.sku = \'12White\' then lll.product_return_quantity else 0 end) \"12W_return\", (case when lll.sku = \'25White\' then lll.product_return_quantity else 0 end) as \"25W_return\", (case when lll.sku = \'30White\' then lll.product_return_quantity else 0 end) as \"30W_return\", (case when lll.sku = \'30White Regular\' then lll.product_return_quantity else 0 end) as \"30WR_return\", (case when lll.sku = \'6Brown\' then lll.product_return_quantity else 0 end) \"6B_return\", (case when lll.sku = \'10Brown\' then lll.product_return_quantity else 0 end) as \"10B_return\", (case when lll.sku = \'25Brown\' then lll.product_return_quantity else 0 end) as \"25B_return\", (case when lll.sku = \'30Brown\' then lll.product_return_quantity else 0 end) as \"30B_return\", (case when lll.sku = \'10Nutra\' then lll.product_return_quantity else 0 end) as \"10N_return\", (case when lll.sku = \'6White\' then lll.product_replacement_quantity else 0 end) \"6W_replacement\", (case when lll.sku = \'10White\' then lll.product_replacement_quantity else 0 end) as \"10W_replacement\", (case when lll.sku = \'12White\' then lll.product_replacement_quantity else 0 end) \"12W_replacement\", (case when lll.sku = \'25White\' then lll.product_replacement_quantity else 0 end) as \"25W_replacement\", (case when lll.sku = \'30White\' then lll.product_replacement_quantity else 0 end) as \"30W_replacement\", (case when lll.sku = \'30White Regular\' then lll.product_replacement_quantity else 0 end) as \"30WR_replacement\", (case when lll.sku = \'6Brown\' then lll.product_replacement_quantity else 0 end) \"6B_replacement\", (case when lll.sku = \'10Brown\' then lll.product_replacement_quantity else 0 end) as \"10B_replacement\", (case when lll.sku = \'25Brown\' then lll.product_replacement_quantity else 0 end) as \"25B_replacement\", (case when lll.sku = \'30Brown\' then lll.product_replacement_quantity else 0 end) as \"30B_replacement\", (case when lll.sku = \'10Nutra\' then lll.product_replacement_quantity else 0 end) as \"10N_replacement\", (case when lll.sku = \'6White\' then lll.product_promo_quantity else 0 end) \"6W_promo\", (case when lll.sku = \'10White\' then lll.product_promo_quantity else 0 end) as \"10W_promo\", (case when lll.sku = \'12White\' then lll.product_promo_quantity else 0 end) \"12W_promo\", (case when lll.sku = \'25White\' then lll.product_promo_quantity else 0 end) as \"25W_promo\", (case when lll.sku = \'30White\' then lll.product_promo_quantity else 0 end) as \"30W_promo\", (case when lll.sku = \'30White Regular\' then lll.product_promo_quantity else 0 end) as \"30WR_promo\", (case when lll.sku = \'6Brown\' then lll.product_promo_quantity else 0 end) \"6B_promo\", (case when lll.sku = \'10Brown\' then lll.product_promo_quantity else 0 end) as \"10B_promo\", (case when lll.sku = \'25Brown\' then lll.product_promo_quantity else 0 end) as \"25B_promo\", (case when lll.sku = \'30Brown\' then lll.product_promo_quantity else 0 end) as \"30B_promo\", (case when lll.sku = \'10Nutra\' then lll.product_promo_quantity else 0 end) as \"10N_promo\", (case when lll.sku = \'6White\' then lll.product_fresh_in_quantity else 0 end) \"6W_fresh_in\", (case when lll.sku = \'10White\' then lll.product_fresh_in_quantity else 0 end) as \"10W_fresh_in\", (case when lll.sku = \'12White\' then lll.product_fresh_in_quantity else 0 end) \"12W_fresh_in\", (case when lll.sku = \'25White\' then lll.product_fresh_in_quantity else 0 end) as \"25W_fresh_in\", (case when lll.sku = \'30White\' then lll.product_fresh_in_quantity else 0 end) as \"30W_fresh_in\", (case when lll.sku = \'30White Regular\' then lll.product_fresh_in_quantity else 0 end) as \"30WR_fresh_in\", (case when lll.sku = \'6Brown\' then lll.product_fresh_in_quantity else 0 end) \"6B_fresh_in\", (case when lll.sku = \'10Brown\' then lll.product_fresh_in_quantity else 0 end) as \"10B_fresh_in\", (case when lll.sku = \'25Brown\' then lll.product_fresh_in_quantity else 0 end) as \"25B_fresh_in\", (case when lll.sku = \'30Brown\' then lll.product_fresh_in_quantity else 0 end) as \"30B_fresh_in\", (case when lll.sku = \'10Nutra\' then lll.product_fresh_in_quantity else 0 end) as \"10N_fresh_in\", (case when lll.sku = \'6White\' then lll.product_damage_quantity else 0 end) \"6W_damage\", (case when lll.sku = \'10White\' then lll.product_damage_quantity else 0 end) as \"10W_damage\", (case when lll.sku = \'12White\' then lll.product_damage_quantity else 0 end) \"12W_damage\", (case when lll.sku = \'25White\' then lll.product_damage_quantity else 0 end) as \"25W_damage\", (case when lll.sku = \'30White\' then lll.product_damage_quantity else 0 end) as \"30W_damage\", (case when lll.sku = \'30White Regular\' then lll.product_damage_quantity else 0 end) as \"30WR_damage\", (case when lll.sku = \'6Brown\' then lll.product_damage_quantity else 0 end) \"6B_damage\", (case when lll.sku = \'10Brown\' then lll.product_damage_quantity else 0 end) as \"10B_damage\", (case when lll.sku = \'25Brown\' then lll.product_damage_quantity else 0 end) as \"25B_damage\", (case when lll.sku = \'30Brown\' then lll.product_damage_quantity else 0 end) as \"30B_damage\", (case when lll.sku = \'10Nutra\' then lll.product_damage_quantity else 0 end) as \"10N_damage\", (case when lll.sku = \'6White\' then lll.product_return_replace_in_quantity else 0 end) \"6W_old_in\", (case when lll.sku = \'10White\' then lll.product_return_replace_in_quantity else 0 end) as \"10W_old_in\", (case when lll.sku = \'12White\' then lll.product_return_replace_in_quantity else 0 end) \"12W_old_in\", (case when lll.sku = \'25White\' then lll.product_return_replace_in_quantity else 0 end) as \"25W_old_in\", (case when lll.sku = \'30White\' then lll.product_return_replace_in_quantity else 0 end) as \"30W_old_in\", (case when lll.sku = \'30White Regular\' then lll.product_return_replace_in_quantity else 0 end) as \"30WR_old_in\", (case when lll.sku = \'6Brown\' then lll.product_return_replace_in_quantity else 0 end) \"6B_old_in\", (case when lll.sku = \'10Brown\' then lll.product_return_replace_in_quantity else 0 end) as \"10B_old_in\", (case when lll.sku = \'25Brown\' then lll.product_return_replace_in_quantity else 0 end) as \"25B_old_in\", (case when lll.sku = \'30Brown\' then lll.product_return_replace_in_quantity else 0 end) as \"30B_old_in\", (case when lll.sku = \'10Nutra\' then lll.product_return_replace_in_quantity else 0 end) as \"10N_old_in\" from (select db.id, cast(timestampadd(minute,330,dateadd(hour, 5.5, db.beat_date)) as date) AS beat_date, db.beat_number, db.beat_name, sp.name as FSE, db.demand_classification, ww.name, pp.description, concat(pp.sku_count,pp.name) sku, pp.current_price, ss.product_quantity, ss.product_supply_quantity, ss.product_fresh_in_quantity, ss.product_out_quantity, ss.product_replacement_quantity, ss.product_return_quantity, ss.product_sold_quantity, ss.product_transfer_quantity, ss.product_return_replace_in_quantity, ss.product_damage_quantity, ss.product_promo_quantity from eggozdb.maplemonk.my_sql_distributionchain_beatassignment db join eggozdb.maplemonk.my_sql_saleschain_salesdemandsku ss on db.id = ss.beatassignment_id join eggozdb.maplemonk.my_sql_product_product pp on pp.id = ss.product_id left join eggozdb.maplemonk.my_sql_warehouse_warehouse ww on db.warehouse_id = ww.id left join (SELECT ddp.id, cau.name FROM eggozdb.maplemonk.my_sql_distributionchain_distributionpersonprofile ddp LEFT JOIN eggozdb.maplemonk.my_sql_custom_auth_user cau ON cau.id = ddp.user_id) sp ON sp.id = db.jse_id where db.supply_approval_status<>\'cancelled\') lll) m group by m.id;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from EGGOZDB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        