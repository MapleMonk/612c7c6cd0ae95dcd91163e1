{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SB_CONSOLIDATED_HOURLY_DATA as with SB_TRAFFIC_HOURLY as (select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,KEYWORD_TEXT ,KEYWORD_TYPE ,PLACEMENT_TYPE ,CURRENCY ,sum(COST) SPEND ,sum(IMPRESSIONS) IMPRESSIONS ,sum(CLICKS) CLICKS ,sum(VIEWABLE_IMPRESSIONS) VIEWABLE_IMPRESSIONS from hox_db.maplemonk.hox_blanko_aa_sb_traffic_hourly group by 1,2,3,4,5,6,7,8,9,10,11,12), SB_CONVERSIONS_HOURLY as ( select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,KEYWORD_TEXT ,KEYWORD_TYPE ,PLACEMENT_TYPE ,CURRENCY ,sum(ATTRIBUTED_SALES_14D) ATTRIBUTED_SALES_14D ,sum(ATTRIBUTED_UNITS_ORDERED_14D) ATTRIBUTED_UNITS_ORDERED_14D ,sum(ATTRIBUTED_CONVERSIONS_14D) ATTRIBUTED_CONVERSIONS_14D ,sum(VIEW_ATTRIBUTED_SALES_14D) VIEW_ATTRIBUTED_SALES_14D ,sum(VIEW_ATTRIBUTED_UNITS_ORDERED_14D) VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,sum(VIEW_ATTRIBUTED_CONVERSIONS_14D) VIEW_ATTRIBUTED_CONVERSIONS_14D ,sum(ATTRIBUTED_SALES_14D_SAME_SKU) ATTRIBUTED_SALES_14D_SAME_SKU ,sum(ATTRIBUTED_CONVERSIONS_14D_SAME_SKU) ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,sum(ATTRIBUTED_SALES_NEW_TO_BRAND_14D) ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,sum(ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D) ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,sum(ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D) ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D from hox_db.maplemonk.hox_blanko_aa_sb_conversions_hourly group by 1,2,3,4,5,6,7,8,9,10,11,12 ) select coalesce(a.ADVERTISER_ID, b.ADVERTISER_ID) ADVERTISER_ID ,coalesce(a.MARKETPLACE_ID, b.MARKETPLACE_ID) MARKETPLACE_ID ,coalesce(a.Date, b.Date) Date ,coalesce(a.Hour, b.Hour) Hour ,coalesce(a.AD_ID, b.AD_ID) AD_ID ,coalesce(a.KEYWORD_ID, b.KEYWORD_ID) KEYWORD_ID ,coalesce(a.AD_GROUP_ID, b.AD_GROUP_ID) AD_GROUP_ID ,coalesce(a.CAMPAIGN_ID, b.CAMPAIGN_ID) CAMPAIGN_ID ,coalesce(a.KEYWORD_TEXT, b.KEYWORD_TEXT) KEYWORD_TEXT ,coalesce(a.KEYWORD_TYPE, b.KEYWORD_TYPE) KEYWORD_TYPE ,coalesce(a.PLACEMENT_TYPE, b.PLACEMENT_TYPE) PLACEMENT_TYPE ,coalesce(a.CURRENCY, b.CURRENCY) CURRENCY ,b.ATTRIBUTED_SALES_14D ,b.ATTRIBUTED_UNITS_ORDERED_14D ,b.ATTRIBUTED_CONVERSIONS_14D ,b.VIEW_ATTRIBUTED_SALES_14D ,b.VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,b.VIEW_ATTRIBUTED_CONVERSIONS_14D ,b.ATTRIBUTED_SALES_14D_SAME_SKU ,b.ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,b.ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,b.ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,b.ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,a.SPEND ,a.IMPRESSIONS ,a.CLICKS ,a.VIEWABLE_IMPRESSIONS from SB_TRAFFIC_HOURLY a full outer join SB_CONVERSIONS_HOURLY b on a.MARKETPLACE_ID = b.MARKETPLACE_ID and a.Date = b.Date and a.AD_ID = b.AD_ID and a.KEYWORD_ID = b.KEYWORD_ID and a.AD_GROUP_ID = b.AD_GROUP_ID and a.CAMPAIGN_ID = b.CAMPAIGN_ID; create or replace table HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SD_CONSOLIDATED_HOURLY_DATA as with SD_TRAFFIC_HOURLY as (select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,TARGET_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,TARGETING_TEXT ,CURRENCY ,sum(COST) SPEND ,sum(IMPRESSIONS) IMPRESSIONS ,sum(CLICKS) CLICKS ,sum(VIEW_IMPRESSIONS) VIEWABLE_IMPRESSIONS from hox_db.maplemonk.hox_blanko_aa_sd_traffic_hourly group by 1,2,3,4,5,6,7,8,9,10), SD_CONVERSIONS_HOURLY as ( select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,TARGET_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,CURRENCY ,sum(ATTRIBUTED_SALES_14D) ATTRIBUTED_SALES_14D ,sum(ATTRIBUTED_UNITS_ORDERED_14D) ATTRIBUTED_UNITS_ORDERED_14D ,sum(ATTRIBUTED_CONVERSIONS_14D) ATTRIBUTED_CONVERSIONS_14D ,sum(VIEW_ATTRIBUTED_SALES_14D) VIEW_ATTRIBUTED_SALES_14D ,sum(VIEW_ATTRIBUTED_UNITS_ORDERED_14D) VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,sum(VIEW_ATTRIBUTED_CONVERSIONS_14D) VIEW_ATTRIBUTED_CONVERSIONS_14D ,sum(ATTRIBUTED_SALES_14D_SAME_SKU) ATTRIBUTED_SALES_14D_SAME_SKU ,sum(ATTRIBUTED_CONVERSIONS_14D_SAME_SKU) ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,sum(ATTRIBUTED_SALES_NEW_TO_BRAND_14D) ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,sum(ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D) ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,sum(ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D) ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,sum(VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D) VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D from hox_db.maplemonk.hox_blanko_aa_sd_conversions_hourly group by 1,2,3,4,5,6,7,8,9 ) select coalesce(a.ADVERTISER_ID, b.ADVERTISER_ID) ADVERTISER_ID ,coalesce(a.MARKETPLACE_ID, b.MARKETPLACE_ID) MARKETPLACE_ID ,coalesce(a.Date, b.Date) Date ,coalesce(a.Hour, b.Hour) Hour ,coalesce(a.AD_ID, b.AD_ID) AD_ID ,coalesce(a.TARGET_ID, b.TARGET_ID) TARGET_ID ,coalesce(a.AD_GROUP_ID, b.AD_GROUP_ID) AD_GROUP_ID ,coalesce(a.CAMPAIGN_ID, b.CAMPAIGN_ID) CAMPAIGN_ID ,a.TARGETING_TEXT ,coalesce(a.CURRENCY, b.CURRENCY) CURRENCY ,b.ATTRIBUTED_SALES_14D ,b.ATTRIBUTED_UNITS_ORDERED_14D ,b.ATTRIBUTED_CONVERSIONS_14D ,b.VIEW_ATTRIBUTED_SALES_14D ,b.VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,b.VIEW_ATTRIBUTED_CONVERSIONS_14D ,b.ATTRIBUTED_SALES_14D_SAME_SKU ,b.ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,b.ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,b.ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,b.ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,b.VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,a.SPEND ,a.IMPRESSIONS ,a.CLICKS ,a.VIEWABLE_IMPRESSIONS from SD_TRAFFIC_HOURLY a full outer join SD_CONVERSIONS_HOURLY b on a.MARKETPLACE_ID = b.MARKETPLACE_ID and a.Date = b.Date and a.AD_ID = b.AD_ID and a.TARGET_ID = b.TARGET_ID and a.AD_GROUP_ID = b.AD_GROUP_ID and a.CAMPAIGN_ID = b.CAMPAIGN_ID ; create or replace table HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SP_CONSOLIDATED_HOURLY_DATA as with SP_TRAFFIC_HOURLY as (select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,KEYWORD_TEXT ,MATCH_TYPE ,PLACEMENT ,CURRENCY ,sum(COST) SPEND ,sum(IMPRESSIONS) IMPRESSIONS ,sum(CLICKS) CLICKS from hox_db.maplemonk.hox_blanko_aa_sp_traffic_hourly group by 1,2,3,4,5,6,7,8,9,10,11,12), SP_CONVERSIONS_HOURLY as ( select ADVERTISER_ID ,MARKETPLACE_ID ,TIME_WINDOW_START::datetime Date ,hour(TIME_WINDOW_START::datetime) Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,PLACEMENT ,CURRENCY ,sum(ATTRIBUTED_SALES_14D) ATTRIBUTED_SALES_14D ,sum(ATTRIBUTED_UNITS_ORDERED_14D) ATTRIBUTED_UNITS_ORDERED_14D ,sum(ATTRIBUTED_CONVERSIONS_14D) ATTRIBUTED_CONVERSIONS_14D ,sum(ATTRIBUTED_SALES_14D_SAME_SKU) ATTRIBUTED_SALES_14D_SAME_SKU ,sum(ATTRIBUTED_CONVERSIONS_14D_SAME_SKU) ATTRIBUTED_CONVERSIONS_14D_SAME_SKU from hox_db.maplemonk.hox_blanko_aa_sp_conversions_hourly group by 1,2,3,4,5,6,7,8,9,10 ) select coalesce(a.ADVERTISER_ID, b.ADVERTISER_ID) ADVERTISER_ID ,coalesce(a.MARKETPLACE_ID, b.MARKETPLACE_ID) MARKETPLACE_ID ,coalesce(a.Date, b.Date) Date ,coalesce(a.Hour, b.Hour) Hour ,coalesce(a.AD_ID, b.AD_ID) AD_ID ,coalesce(a.KEYWORD_ID, b.KEYWORD_ID) KEYWORD_ID ,coalesce(a.AD_GROUP_ID, b.AD_GROUP_ID) AD_GROUP_ID ,coalesce(a.CAMPAIGN_ID, b.CAMPAIGN_ID) CAMPAIGN_ID ,a.KEYWORD_TEXT ,a.MATCH_TYPE ,a.PLACEMENT ,coalesce(a.CURRENCY, b.CURRENCY) CURRENCY ,b.ATTRIBUTED_SALES_14D ,b.ATTRIBUTED_UNITS_ORDERED_14D ,b.ATTRIBUTED_CONVERSIONS_14D ,b.ATTRIBUTED_SALES_14D_SAME_SKU ,b.ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,a.SPEND ,a.IMPRESSIONS ,a.CLICKS from SP_TRAFFIC_HOURLY a full outer join SP_CONVERSIONS_HOURLY b on a.MARKETPLACE_ID = b.MARKETPLACE_ID and a.Date = b.Date and a.AD_ID = b.AD_ID and a.KEYWORD_ID = b.KEYWORD_ID and a.AD_GROUP_ID = b.AD_GROUP_ID and a.CAMPAIGN_ID = b.CAMPAIGN_ID ; CREATE OR REPLACE TABLE HOX_DB.MAPLEMONK.HOX_BLANKO_AMAZON_ADS_HOURLY_DATA_CONSOLIDATED AS select ADVERTISER_ID ,MARKETPLACE_ID ,Date ,Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,KEYWORD_TEXT ,KEYWORD_TYPE ,PLACEMENT_TYPE ,CURRENCY ,ATTRIBUTED_SALES_14D ,ATTRIBUTED_UNITS_ORDERED_14D ,ATTRIBUTED_CONVERSIONS_14D ,VIEW_ATTRIBUTED_SALES_14D ,VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,VIEW_ATTRIBUTED_CONVERSIONS_14D ,ATTRIBUTED_SALES_14D_SAME_SKU ,ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,SPEND ,IMPRESSIONS ,CLICKS ,VIEWABLE_IMPRESSIONS from HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SB_CONSOLIDATED_HOURLY_DATA union all select ADVERTISER_ID ,MARKETPLACE_ID ,Date ,Hour ,AD_ID ,TARGET_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,TARGETING_TEXT ,null as KEYWORD_TYPE ,null as PLACEMENT_TYPE ,CURRENCY ,ATTRIBUTED_SALES_14D ,ATTRIBUTED_UNITS_ORDERED_14D ,ATTRIBUTED_CONVERSIONS_14D ,VIEW_ATTRIBUTED_SALES_14D ,VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,VIEW_ATTRIBUTED_CONVERSIONS_14D ,ATTRIBUTED_SALES_14D_SAME_SKU ,ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,SPEND ,IMPRESSIONS ,CLICKS ,VIEWABLE_IMPRESSIONS from HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SD_CONSOLIDATED_HOURLY_DATA union all select ADVERTISER_ID ,MARKETPLACE_ID ,Date ,Hour ,AD_ID ,KEYWORD_ID ,AD_GROUP_ID ,CAMPAIGN_ID ,KEYWORD_TEXT ,MATCH_TYPE ,PLACEMENT ,CURRENCY ,ATTRIBUTED_SALES_14D ,ATTRIBUTED_UNITS_ORDERED_14D ,ATTRIBUTED_CONVERSIONS_14D ,null as VIEW_ATTRIBUTED_SALES_14D ,null as VIEW_ATTRIBUTED_UNITS_ORDERED_14D ,null as VIEW_ATTRIBUTED_CONVERSIONS_14D ,ATTRIBUTED_SALES_14D_SAME_SKU ,ATTRIBUTED_CONVERSIONS_14D_SAME_SKU ,null as ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,null as ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,null as ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,null as VIEW_ATTRIBUTED_SALES_NEW_TO_BRAND_14D ,null as VIEW_ATTRIBUTED_UNITS_ORDERED_NEW_TO_BRAND_14D ,null as VIEW_ATTRIBUTED_ORDERS_NEW_TO_BRAND_14D ,SPEND ,IMPRESSIONS ,CLICKS ,null as VIEWABLE_IMPRESSIONS from HOX_DB.MAPLEMONK.HOX_BLANKO_AA_SP_CONSOLIDATED_HOURLY_DATA;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from HOX_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        