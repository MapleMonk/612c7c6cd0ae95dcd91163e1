{{ config(
            materialized='table',
                post_hook={
                    "sql": "CREATE OR REPLACE TABLE snitch_db.maplemonk.warehouse_logistics_performance AS WITH warehouse_data AS ( SELECT awb, marketplace_mapped, shippingpackagecode, order_id, saleorderitemcode, order_timestamp, shipping_courier, warehouse_name, uc_status, delivered_date, uc_created, tat, created_timestamp, picking_timestamp, picked_timestamp, packed_timestamp, rts_timestamp, dispatched_timestamp, shipped_timestamp, latest_status, try_to_date(\"Pickup Date\") AS pickup_date, try_to_date(\"CP_DELIVERY\") AS delivered_at, cp_delivery, item_status, sla_status, CASE WHEN packed_timestamp IS NOT NULL THEN CASE WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) = 0 THEN \'D0\' WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) = 1 THEN \'D1\' WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) = 2 THEN \'D2\' WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) = 3 THEN \'D3\' WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) BETWEEN 4 AND 5 THEN \'D>3\' WHEN DATEDIFF(DAY, order_timestamp, packed_timestamp) BETWEEN 6 AND 9 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS O2P, CASE WHEN dispatched_timestamp IS NOT NULL THEN CASE WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) = 0 THEN \'D0\' WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) = 1 THEN \'D1\' WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) = 2 THEN \'D2\' WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) = 3 THEN \'D3\' WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) BETWEEN 4 AND 5 THEN \'D>3\' WHEN DATEDIFF(DAY, order_timestamp, dispatched_timestamp) BETWEEN 6 AND 9 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS O2M, CASE WHEN packed_timestamp IS NOT NULL THEN CASE WHEN DATEDIFF(DAY, order_timestamp, pickup_date) = 0 THEN \'D0\' WHEN DATEDIFF(DAY, order_timestamp, pickup_date) = 1 THEN \'D1\' WHEN DATEDIFF(DAY, order_timestamp, pickup_date) = 2 THEN \'D2\' WHEN DATEDIFF(DAY, order_timestamp, pickup_date) = 3 THEN \'D3\' WHEN DATEDIFF(DAY, order_timestamp, pickup_date) BETWEEN 4 AND 5 THEN \'D>3\' WHEN DATEDIFF(DAY, order_timestamp, pickup_date) BETWEEN 6 AND 9 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS O2H, CASE WHEN pickup_date IS NOT NULL THEN CASE WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) = 0 THEN \'D0\' WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) = 1 THEN \'D1\' WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) = 2 THEN \'D2\' WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) = 3 THEN \'D3\' WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) BETWEEN 4 AND 5 THEN \'D>3\' WHEN DATEDIFF(DAY, dispatched_timestamp, pickup_date) BETWEEN 6 AND 9 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS M2H, CASE WHEN delivered_at IS NOT NULL THEN CASE WHEN DATEDIFF(HOUR, order_timestamp, delivered_at) <= 24 THEN \'D1\' WHEN DATEDIFF(HOUR, order_timestamp, delivered_at) <= 28 THEN \'D2\' WHEN DATEDIFF(HOUR, order_timestamp, delivered_at) <= 48 THEN \'D3\' WHEN DATEDIFF(HOUR, order_timestamp, delivered_at) BETWEEN 49 AND 72 THEN \'D>3\' WHEN DATEDIFF(HOUR, order_timestamp, delivered_at) BETWEEN 73 AND 96 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS O2D, CASE WHEN delivered_at IS NOT NULL THEN CASE WHEN DATEDIFF(HOUR, packed_timestamp, delivered_at) <= 24 THEN \'D1\' WHEN DATEDIFF(HOUR, packed_timestamp, delivered_at) <= 28 THEN \'D2\' WHEN DATEDIFF(HOUR, packed_timestamp, delivered_at) <= 48 THEN \'D3\' WHEN DATEDIFF(HOUR, packed_timestamp, delivered_at) BETWEEN 49 AND 72 THEN \'D>3\' WHEN DATEDIFF(HOUR, packed_timestamp, delivered_at) BETWEEN 73 AND 96 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS O2P_h, CASE WHEN delivered_at IS NOT NULL THEN CASE WHEN DATEDIFF(HOUR, pickup_date, delivered_at) <= 24 THEN \'D1\' WHEN DATEDIFF(HOUR, pickup_date, delivered_at) <= 28 THEN \'D2\' WHEN DATEDIFF(HOUR, pickup_date, delivered_at) <= 48 THEN \'D3\' WHEN DATEDIFF(HOUR, pickup_date, delivered_at) BETWEEN 49 AND 72 THEN \'D>3\' WHEN DATEDIFF(HOUR, pickup_date, delivered_at) BETWEEN 73 AND 96 THEN \'D>5\' ELSE \'D>9\' END ELSE \'P\' END AS P2D FROM snitch_db.maplemonk.warehouse_sla_performance WHERE marketplace_mapped = \'SHOPIFY\' ) SELECT w.*, c.mapped_state, c.mapped_city, c.pin_code, c.final_zone FROM warehouse_data w LEFT JOIN snitch_db.maplemonk.cp_1 c ON w.awb = c.awb_number;",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from snitch_db.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            