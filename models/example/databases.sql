{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE Gynoveda_DB.MAPLEMONK.FB_Gynoveda_CONSOLIDATED AS select Adset_Name,Adset_ID,Account_Name, Account_ID, FB.CAMPAIGN_NAME, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks,SUM(SPEND) Spend,SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value ,sum(reach) Reach ,sum(Link_Clicks) Link_Clicks ,sum(Landing_Page_Views) Landing_Page_Views ,sum(Video_95_Views) Video_95_Views ,sum(Video_100_Views) Video_100_Views ,sum(Thruplay) Thruplay ,\'Facebook\' Channel ,\'Gynoveda_FB\' Facebook_Account , NULL campaign_type ,FBMAP.Type Product ,FBMAP.Main_Type Product_Type ,FBMAP.Category Product_Category from Gynoveda_DB.MAPLEMONK.FB_gynoveda_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start left join ( select ad_id,date_start ,SUM(C.value:value) LINK_CLICKS from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(Input => ACTIONS) C where C.value:action_type=\'link_click\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBLC on Fb.ad_id = FBLC.ad_id and Fb.date_start=FBLC.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Landing_Page_Views from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(Input => ACTIONS) C where C.value:action_type=\'landing_page_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBLPV on Fb.ad_id = FBLPV.ad_id and Fb.date_start=FBLPV.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Video_95_Views from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(Input => VIDEO_P95_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FB95V on Fb.ad_id = FB95V.ad_id and Fb.date_start=FB95V.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Video_100_Views from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(Input => VIDEO_P100_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FB100V on Fb.ad_id = FB100V.ad_id and Fb.date_start=FB100V.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Thruplay from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_ADS_INSIGHTS,lateral flatten(Input => VIDEO_15_SEC_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBTV on Fb.ad_id = FBTV.ad_id and Fb.date_start=FBTV.date_start left join (select * from (select \"Campaign name\" Campaign_name, Type, CATEGORY, \"Main Type\" Main_type, row_number() over (partition by \"Campaign name\" order by \"Campaign name\") rw from gynoveda_db.maplemonk.facebook_campaign_product_mapping) where rw=1) FBMAP on upper(FB.campaign_name) = upper(FBMAP.Campaign_name) group by Adset_Name, Adset_ID, Account_Name, Account_ID, FB.Campaign_Name, Campaign_ID,Fb.date_start,FBMAP.Type, FBMAP.Main_Type,FBMAP.Category union select Adset_Name,Adset_ID,Account_Name, Account_ID, FB.Campaign_Name, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks,SUM(SPEND) Spend,SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value ,sum(reach) Reach ,sum(Link_Clicks) Link_Clicks ,sum(Landing_Page_Views) Landing_Page_Views ,sum(Video_95_Views) Video_95_Views ,sum(Video_100_Views) Video_100_Views ,sum(Thruplay) Thruplay ,\'Facebook\' Channel ,\'Gynoveda_FB_2.0\' Facebook_Account , NULL ,FBMAP.Type Product ,FBMAP.Main_Type Product_Type ,FBMAP.Category Product_Category from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start left join ( select ad_id,date_start ,SUM(C.value:value) LINK_CLICKS from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(Input => ACTIONS) C where C.value:action_type=\'link_click\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBLC on Fb.ad_id = FBLC.ad_id and Fb.date_start=FBLC.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Landing_Page_Views from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(Input => ACTIONS) C where C.value:action_type=\'landing_page_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBLPV on Fb.ad_id = FBLPV.ad_id and Fb.date_start=FBLPV.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Video_95_Views from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(Input => VIDEO_P95_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FB95V on Fb.ad_id = FB95V.ad_id and Fb.date_start=FB95V.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Video_100_Views from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(Input => VIDEO_P100_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FB100V on Fb.ad_id = FB100V.ad_id and Fb.date_start=FB100V.date_start left join ( select ad_id,date_start ,SUM(C.value:value) Thruplay from Gynoveda_DB.MAPLEMONK.FB_GYNOVEDA2_ADS_INSIGHTS,lateral flatten(Input => VIDEO_15_SEC_WATCHED_ACTIONS) C where C.value:action_type=\'video_view\' group by ad_id,date_start having SUM(C.value:value) is not null ) FBTV on Fb.ad_id = FBTV.ad_id and Fb.date_start=FBTV.date_start left join (select * from (select \"Campaign name\" Campaign_name, Type, CATEGORY, \"Main Type\" Main_type, row_number() over (partition by \"Campaign name\" order by \"Campaign name\") rw from gynoveda_db.maplemonk.facebook_campaign_product_mapping) where rw=1) FBMAP on upper(FB.campaign_name) = upper(FBMAP.Campaign_name) group by Adset_Name, Adset_ID, Account_Name, Account_ID, FB.Campaign_Name, Campaign_ID,Fb.date_start,FBMAP.Type,FBMAP.Main_Type,FBMAP.Category; CREATE OR REPLACE TABLE Gynoveda_DB.MAPLEMONK.MARKETING_CONSOLIDATED_GYNOVEDA AS select ADSET_NAME,ADSET_ID,ACCOUNT_NAME, ACCOUNT_ID ,CAMPAIGN_NAME, CAMPAIGN_ID, DATE ,NULL AD_TYPE,NULL AD_STRENGTH ,NULL AD_NETWORK_TYPE,NULL AD_URL ,dayname(DATE) Day_of_Week ,YEAR(DATE) AS YEAR ,MONTH(DATE) AS MONTH ,CHANNEL ,FACEBOOK_ACCOUNT AS ACCOUNT ,Campaign_type ,Product ,Product_Type ,Product_Category ,SUM(CLICKS) Clicks ,SUM(SPEND) Spend ,SUM(IMPRESSIONS) Impressions ,SUM(CONVERSIONS) Conversions ,SUM(CONVERSION_VALUE) Conversion_Value ,sum(reach) reach ,sum(link_clicks) Link_clicks ,sum(Landing_Page_Views) Landing_Page_Views ,sum(Video_95_Views) Video_95_Views ,sum(Video_100_Views) Video_100_Views ,sum(Thruplay) Thruplay from Gynoveda_DB.MAPLEMONK.FB_Gynoveda_CONSOLIDATED group by ADSET_NAME,ADSET_ID,ACCOUNT_NAME, ACCOUNT_ID ,CAMPAIGN_NAME, CAMPAIGN_ID, DATE, CHANNEL, FACEBOOK_ACCOUNT,Product,Product_Type,Product_Category, campaign_type union select adgroupname, adgroupid, \'Gynoveda Amazon Ads\' Account_Name, profileid ,campaignname, campaignid, date ,campaign_type ad_type, Null Ad_strength ,NULL AD_NETWORK_TYPE, NULL AD_URL ,dayname(date) day_of_week ,year(date) Year ,month(date) Month ,\'Amazon\' Channel ,\'Amazon Ads\' Account ,campaign_type ,product ,product_type ,category ,sum(clicks) CLICKS ,sum(spend) SPEND ,sum(impressions) IMPRESSIONS ,sum(conversions) CONVERSIONS ,sum(sales) Sales ,Null reach ,Null Link_clicks ,Null Landing_Page_Views ,Null Video_95_Views ,Null Video_100_Views ,Null Thruplay from Gynoveda_DB.MAPLEMONK.amazonads_in_marketing_gynoveda group by 1, 2,3,4,5,6,7,8,9,10,11,12,13, 14, 15, 16,17, 18,19,20 union select NULL, NULL, NULL, NULL ,\"campaign.name\", \"campaign.id\", \"segments.date\" ,NULL, NULL,NULL, NULL, dayname(\"segments.date\") ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,\'Google\' Channel ,\'Google_gynoveda\' ACCOUNT ,\"campaign.advertising_channel_type\" ,MAP.Type Product ,MAP.Product_Type ,MAP.Category ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value ,Null reach ,Null Link_clicks ,Null Landing_Page_Views ,Null Video_95_Views ,Null Video_100_Views ,Null Thruplay from gynoveda_db.maplemonk.GADS_GYNOVEDA_CAMPAIGNS_DATA GADSC left join (select * from (select \"Campaign name\" Campaign_name, Type, CATEGORY, \"Main Type\" Product_type, row_number() over (partition by \"Campaign name\" order by \"Campaign name\") rw from gynoveda_db.maplemonk.google_spends_product_mapping) where rw=1) MAP on upper(GADSC.\"campaign.name\") = upper(MAP.Campaign_name) where lower(\"campaign.advertising_channel_type\") like \'%performance_max%\' group by 1, 2,3,4,5,6,7,8,9,10,11,12,13, 14, 15, 16,17, 18,19,20 union select GAG.\"ad_group.name\", GAG.\"ad_group_ad.ad.id\", GAG.\"customer.descriptive_name\", GAG.\"customer.id\" ,GAG.\"campaign.name\", GAG.\"campaign.id\", GAG.\"segments.date\" ,GAG.\"ad_group_ad.ad.type\", GAG.\"ad_group_ad.ad_strength\" ,GAG.\"segments.ad_network_type\",GAG.\"ad_group_ad.ad.display_url\", dayname(GAG.\"segments.date\") ,YEAR(GAG.\"segments.date\") YEAR ,MONTH(GAG.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google_gynoveda\' ACCOUNT ,CD.campaign_type Campaign_Type ,MAP.Type Product ,MAP.Product_Type ,MAP.Category ,sum(GAG.\"metrics.clicks\") clicks ,sum(GAG.\"metrics.cost_micros\")/1000000 spend ,sum(GAG.\"metrics.impressions\") impressions ,sum(GAG.\"metrics.conversions\") conversions ,sum(GAG.\"metrics.conversions_value\") conversions_value ,Null reach ,Null Link_clicks ,Null Landing_Page_Views ,Null Video_95_Views ,Null Video_100_Views ,Null Thruplay from gynoveda_db.maplemonk.GADS_GYNOVEDA_AD_GROUP_AD_REPORT GAG left join (select * from (Select \"segments.date\",\"campaign.id\", \"campaign.advertising_channel_type\" campaign_type, row_number() over (partition by \"segments.date\",\"campaign.id\" order by \"segments.date\") rw from gynoveda_db.maplemonk.GADS_GYNOVEDA_CAMPAIGNS_DATA) where rw=1) CD on GAG.\"campaign.id\"=CD.\"campaign.id\" and GAG.\"segments.date\"=CD.\"segments.date\" left join (select * from (select \"Campaign name\" Campaign_name, Type, CATEGORY, \"Main Type\" Product_type, row_number() over (partition by \"Campaign name\" order by \"Campaign name\") rw from gynoveda_db.maplemonk.google_spends_product_mapping) where rw=1) MAP on upper(GAG.\"campaign.name\") = upper(MAP.Campaign_name) group by 1, 2,3,4,5,6,7,8,9,10,11,12,13, 14, 15, 16,17, 18,19,20;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from GYNOVEDA_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        