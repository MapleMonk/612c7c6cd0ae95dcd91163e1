{{ config(
            materialized='table',
                post_hook={
                    "sql": "CREATE OR REPLACE TABLE VAHDAM_DB.MAPLEMONK.VAHDAM_DB_MARKETING_CONSOLIDATED as select \'USA\' as REGION ,\'USD\' as Currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.Marketing_Consolidated_US UNION ALL select \'IN\' as REGION ,\'INR\' as Currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_INDIA UNION ALL select \'VT\' as REGION ,\'VND\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_VT UNION ALL select \'DE\' as REGION ,\'EUR\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_GERMANY UNION ALL select \'Global\' as REGION ,\'USD\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_GLOBAL UNION ALL select \'IT\' as REGION ,\'EUR\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_ITALY UNION ALL select \'FR\' as REGION ,\'EUR\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_FR UNION ALL select \'ESP\' as REGION ,\'EUR\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_ESP UNION ALL select \'UAE\' as REGION ,\'AED\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_UAE UNION ALL select \'AUS\' as REGION ,\'AUD\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_AUS UNION ALL select \'UK\' as REGION ,\'EUR\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_UK UNION ALL select \'MX\' as REGION ,\'MXN\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_MX UNION ALL select \'CA\' as REGION ,\'CAD\' as currency ,ADSET_NAME ,ADSET_ID ,ACCOUNT_NAME ,ACCOUNT_ID ,CAMPAIGN_NAME ,CAMPAIGN_ID ,DATE ,AD_TYPE ,AD_STRENGTH ,AD_NETWORK_TYPE ,AD_URL ,DAY_OF_WEEK ,YEAR ,MONTH ,CHANNEL ,ACCOUNT ,CLICKS ,OUTBOUND_CLICKS ,SPEND ,IMPRESSIONS ,CONVERSIONS ,CONVERSION_VALUE from VAHDAM_DB.MAPLEMONK.MARKETING_CONSOLIDATED_CA ; create or replace table VAHDAM_DB.MAPLEMONK.VAHDAM_DB_MARKETING_CONSOLIDATED as select FI.* ,CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.SPEND * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.SPEND WHEN FI.CURRENCY = \'USD\' THEN FI.SPEND * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.SPEND * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.SPEND * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.SPEND * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.SPEND * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.SPEND * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.SPEND * EX.AED_INR WHEN FI.CURRENCY = \'MXN\' THEN FI.SPEND * EX.MXN_INR END AS SPEND_INR ,CASE WHEN FI.CURRENCY = \'EUR\' THEN FI.CONVERSION_VALUE * EX.EUR_INR WHEN FI.CURRENCY = \'INR\' THEN FI.CONVERSION_VALUE WHEN FI.CURRENCY = \'USD\' THEN FI.CONVERSION_VALUE * EX.USD_INR WHEN FI.CURRENCY = \'GBP\' THEN FI.CONVERSION_VALUE * EX.GBP_INR WHEN FI.CURRENCY = \'AUD\' THEN FI.CONVERSION_VALUE * EX.AUD_INR WHEN FI.CURRENCY = \'JPY\' THEN FI.CONVERSION_VALUE * EX.JPY_INR WHEN FI.CURRENCY = \'SGD\' THEN FI.CONVERSION_VALUE * EX.SGD_INR WHEN FI.CURRENCY = \'CAD\' THEN FI.CONVERSION_VALUE * EX.CAD_INR WHEN FI.CURRENCY = \'AED\' THEN FI.CONVERSION_VALUE * EX.AED_INR WHEN FI.CURRENCY = \'MXN\' THEN FI.CONVERSION_VALUE * EX.MXN_INR END AS CONVERSION_VALUE_INR from VAHDAM_DB.MAPLEMONK.VAHDAM_DB_MARKETING_CONSOLIDATED FI LEFT JOIN( SELECT date, RATES:INR AS EUR_INR, (RATES:EUR/RATES:USD)*RATES:INR AS USD_INR, (RATES:EUR/RATES:GBP)*RATES:INR AS GBP_INR, (RATES:EUR/RATES:AUD)*RATES:INR AS AUD_INR, (RATES:EUR/RATES:JPY)*RATES:INR AS JPY_INR, (RATES:EUR/RATES:SGD)*RATES:INR AS SGD_INR, (RATES:EUR/RATES:CAD)*RATES:INR AS CAD_INR, (RATES:EUR/RATES:AED)*RATES:INR AS AED_INR, (RATES:EUR/RATES:MXN)*RATES:INR AS MXN_INR FROM( SELECT *, ROW_NUMBER()OVER(PARTITION BY BASE, DATE ORDER BY _AIRBYTE_EMITTED_AT DESC) RW FROM VAHDAM_DB.MAPLEMONK.EXCHANGE_RATES ) A WHERE RW = 1 ) EX ON FI.DATE::DATE = EX.date;",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from VAHDAM_DB.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            