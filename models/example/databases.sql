{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table skinq_db.maplemonk.skinq_db_amazon_settlement_report_fact_items as select b.order_date ,a.* from (select \"order-id\" order_id ,sum(case when lower(\"item-related-fee-type\") like \'%commission cgst%\' then try_to_double(\"item-related-fee-amount\") end) Commission_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%commission igst%\' then try_to_double(\"item-related-fee-amount\") end) Commission_IGST ,sum(case when lower(\"item-related-fee-type\") like \'%commission sgst%\' then try_to_double(\"item-related-fee-amount\") end) Commission_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%commission tax%\' then try_to_double(\"item-related-fee-amount\") end) Commission_Tax ,sum(case when lower(\"item-related-fee-type\") like \'%commission%\' then try_to_double(\"item-related-fee-amount\") end) Commission ,sum(case when lower(\"item-related-fee-type\") like \'%easy ship weight handling fees cgst%\' then try_to_double(\"item-related-fee-amount\") end) Easy_Ship_weight_handling_fees_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%easy ship weight handling fees sgst%\' then try_to_double(\"item-related-fee-amount\") end) Easy_Ship_weight_handling_fees_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%easy ship weight handling fees tax%\' then try_to_double(\"item-related-fee-amount\") end) Easy_Ship_weight_handling_fees_tax ,sum(case when lower(\"item-related-fee-type\") like \'%easy ship weight handling fees%\' then try_to_double(\"item-related-fee-amount\") end) Easy_Ship_weight_handling_fees ,sum(case when lower(\"item-related-fee-type\") like \'%fba per unit fulfillment fee tax%\' then try_to_double(\"item-related-fee-amount\") end) FBA_per_unit_fulfillment_fee_Tax ,sum(case when lower(\"item-related-fee-type\") like \'%fba pick & pack fee cgst%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Pick_Pack_Fee_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%fba pick & pack fee sgst%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Pick_Pack_Fee_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%fba pick & pack fee%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Pick_Pack_Fee ,sum(case when lower(\"item-related-fee-type\") like \'%fba weight based fee tax%\' then try_to_double(\"item-related-fee-amount\") end) FBA_weight_based_fee_Tax ,sum(case when lower(\"item-related-fee-type\") like \'%fba weight handling fee cgst%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Weight_Handling_Fee_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%fba weight handling fee sgst%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Weight_Handling_Fee_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%fba weight handling fee%\' then try_to_double(\"item-related-fee-amount\") end) FBA_Weight_Handling_Fee ,sum(case when lower(\"item-related-fee-type\") like \'%fixed closing fee cgst%\' then try_to_double(\"item-related-fee-amount\") end) Fixed_closing_fee_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%fixed closing fee igst%\' then try_to_double(\"item-related-fee-amount\") end) Fixed_closing_fee_IGST ,sum(case when lower(\"item-related-fee-type\") like \'%fixed closing fee sgst%\' then try_to_double(\"item-related-fee-amount\") end) Fixed_closing_fee_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%fixed closing fee tax%\' then try_to_double(\"item-related-fee-amount\") end) Fixed_closing_fee_Tax ,sum(case when lower(\"item-related-fee-type\") like \'%fixed closing fee%\' then try_to_double(\"item-related-fee-amount\") end) Fixed_closing_fee ,sum(case when lower(\"item-related-fee-type\") like \'%gift wrap chargeback cgst%\' then try_to_double(\"item-related-fee-amount\") end) Gift_Wrap_Chargeback_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%gift wrap chargeback sgst%\' then try_to_double(\"item-related-fee-amount\") end) Gift_Wrap_Chargeback_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%gift wrap chargeback%\' then try_to_double(\"item-related-fee-amount\") end) Gift_Wrap_Chargeback ,sum(case when lower(\"item-related-fee-type\") like \'%refund commission cgst%\' then try_to_double(\"item-related-fee-amount\") end) Refund_commission_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%refund commission sgst%\' then try_to_double(\"item-related-fee-amount\") end) Refund_commission_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%refund commission tax%\' then try_to_double(\"item-related-fee-amount\") end) Refund_commission_Tax ,sum(case when lower(\"item-related-fee-type\") like \'%refund commission%\' then try_to_double(\"item-related-fee-amount\") end) Refund_commission ,sum(case when lower(\"item-related-fee-type\") like \'%shipping chargeback cgst%\' then try_to_double(\"item-related-fee-amount\") end) Shipping_Chargeback_CGST ,sum(case when lower(\"item-related-fee-type\") like \'%shipping chargeback sgst%\' then try_to_double(\"item-related-fee-amount\") end) Shipping_Chargeback_SGST ,sum(case when lower(\"item-related-fee-type\") like \'%shipping chargeback%\' then try_to_double(\"item-related-fee-amount\") end) Shipping_Chargeback from (select * from (select * ,rank() over (partition by \"SKU\" ,\"CURRENCY\" ,\"order-id\" ,\"price-type\" ,\"shipment-id\" ,\"promotion-id\" ,\"adjustment-id\" ,\"settlement-id\" ,\"fulfillment-id\" ,\"order-fee-type\" ,\"promotion-type\" ,\"order-item-code\" ,\"marketplace-name\" ,\"transaction-type\" ,\"merchant-order-id\" ,\"shipment-fee-type\" ,\"direct-payment-type\" ,\"item-related-fee-type\" ,\"merchant-order-item-id\" ,\"item-related-fee-amount\" ,\"merchant-adjustment-item-id\" ,\"other-fee-reason-description\" ,_AIRBYTE_EMITTED_AT order by _AIRBYTE_EMITTED_AT desc) rw from skinq_db.maplemonk.asp_skinq_get_v2_settlement_report_data_flat_file ) where rw = 1 ) group by 1 )a left join (select distinct order_id, order_timestamp::date order_Date from skinq_db.maplemonk.skinq_db_amazon_fact_items) b on a.order_id =b.order_id;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from skinq_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        