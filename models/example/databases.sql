{{ config(
            materialized='table',
                post_hook={
                    "sql": "create or replace table SNITCH_DB.maplemonk.top_cities as SELECT STATE, DISTRICT, STATE_CODE, PINCODE, max(recommended_size) as Preferred_Size, SUM(NET_SALES) AS NET_SALES, SUM(NET_ORDERS) AS NET_ORDERS, SUM(NET_UNITS) AS NET_UNITS, SUM(NET_LAST3_MONTHS_SALES) AS NET_SALES_3_Months, SUM(NET_LAST6_MONTHS_SALES) AS NET_SALES_6_Months, SUM(NET_LAST12_MONTHS_SALES) AS NET_SALES_12_Months, SUM(NET_LAST3_MONTHS_ORDERS) AS NET_ORDERS_3_Months, SUM(NET_LAST6_MONTHS_ORDERS) AS NET_ORDERS_6_Months, SUM(NET_LAST12_MONTHS_ORDERS) AS NET_ORDERS_12_Months, SUM(NET_LAST3_MONTHS_UNITS) AS NET_UNITS_3_months, SUM(NET_LAST6_MONTHS_UNITS) AS NET_UNITS_6_months, SUM(NET_LAST12_MONTHS_UNITS) AS NET_UNITS_12_months, DIV0(SUM(NET_SALES), SUM(NET_ORDERS)) AS AOV, DIV0(SUM(NET_LAST3_MONTHS_SALES), SUM(NET_LAST3_MONTHS_ORDERS)) AS AOV_3_Months, DIV0(SUM(NET_LAST6_MONTHS_SALES), SUM(NET_LAST6_MONTHS_ORDERS)) AS AOV_6_Months, DIV0(SUM(NET_LAST12_MONTHS_SALES), SUM(NET_LAST12_MONTHS_ORDERS)) AS AOV_12_Months, COUNT(DISTINCT CASE WHEN NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS TOTAL_UNIQUE_CUSTOMERS, COUNT(DISTINCT CASE WHEN CUSTOMER_TYPE =\'REPEAT\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS REPEAT_BASE, COUNT(DISTINCT CASE WHEN CUSTOMER_TYPE =\'NEW\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS NEW_BASE, DIV0(SUM(NET_SALES), COUNT(DISTINCT CASE WHEN NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END)) AS SALES_PER_CUSTOMER, MAX(FREQUENTLY_PURCHASED_PRODUCTCATEGORY) AS MAX_FREQUENT_PURCHASED_PRODUCTCATEGORY, DIV0(COUNT(DISTINCT CASE WHEN CUSTOMER_TYPE =\'REPEAT\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END), COUNT(DISTINCT CUSTOMER_ID_FINAL)) AS REPEAT_CUSTOMER_RATE, COUNT(DISTINCT CASE WHEN LAST_ORDER_DATE >= DATEADD(MONTH, -3, CURRENT_DATE()) AND CUSTOMER_TYPE = \'REPEAT\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS REPEAT_BASE_LAST_3_MONTHS, COUNT(DISTINCT CASE WHEN LAST_ORDER_DATE >= DATEADD(MONTH, -6, CURRENT_DATE()) AND CUSTOMER_TYPE = \'REPEAT\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS REPEAT_BASE_LAST_6_MONTHS, COUNT(DISTINCT CASE WHEN LAST_ORDER_DATE >= DATEADD(MONTH, -12, CURRENT_DATE()) AND CUSTOMER_TYPE = \'REPEAT\' AND NET_ORDERS != 0 THEN CUSTOMER_ID_FINAL END) AS REPEAT_BASE_LAST_12_MONTHS FROM snitch_db.snitch.shopify_customer_segmentation GROUP BY 1, 2, 3, 4;",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from snitch_db.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            