{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE snitch_db.maplemonk.forward_timestamps AS SELECT \"Sale Order Code\", \"Display Order Code\", \"Shipping Package Code\", MAX(CASE WHEN \"Old Value\" = \'NEW\' AND \"New Value\" = \'CREATED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS created_timestamp, MAX(CASE WHEN \"Old Value\" = \'CREATED\' AND \"New Value\" = \'PICKING\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS picking_timestamp, MAX(CASE WHEN (\"Old Value\" = \'CREATED\' OR \"Old Value\" = \'PICKING\') AND \"New Value\" = \'PICKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS picked_timestamp, MAX(CASE WHEN (\"Old Value\" = \'PICKED\' OR \"Old Value\" = \'PICKING\') AND \"New Value\" = \'PACKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS packed_timestamp, MAX(CASE WHEN \"Old Value\" = \'PACKED\' AND \"New Value\" = \'READY_TO_SHIP\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS rts_timestamp, MAX(CASE WHEN \"Old Value\" = \'READY_TO_SHIP\' AND \"New Value\" = \'MANIFESTED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS manifested_timestamp, MAX(CASE WHEN (\"Old Value\" = \'MANIFESTED\' OR \"Old Value\" = \'READY_TO_SHIP\') AND \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS dispatched_timestamp, MAX(CASE WHEN \"Old Value\" = \'DISPATCHED\' AND \"New Value\" = \'SHIPPED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS shipped_timestamp, MAX(CASE WHEN (\"Old Value\" = \'SHIPPED\' OR \"Old Value\" = \'DISPATCHED\') AND \"New Value\" = \'DELIVERED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS delivered_timestamp, MAX(CASE WHEN \"New Value\" = \'CANCELLED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) AS cancelled_timestamp, \"No. of Items\", CASE WHEN DATE(MAX(CASE WHEN \"Old Value\" = \'NEW\' AND \"New Value\" = \'CREATED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) = DATE(MAX(CASE WHEN (\"Old Value\" = \'MANIFESTED\' OR \"Old Value\" = \'READY_TO_SHIP\') AND \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) THEN 1 ELSE 0 END AS \"created&dispatch\", CASE WHEN DATE(MAX(CASE WHEN (\"Old Value\" = \'CREATED\' OR \"Old Value\" = \'PICKING\') AND \"New Value\" = \'PICKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) = DATE(MAX(CASE WHEN (\"Old Value\" = \'MANIFESTED\' OR \"Old Value\" = \'READY_TO_SHIP\') AND \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) THEN 1 ELSE 0 END AS \"pick&dispatch\" , CASE WHEN DATE(MAX(CASE WHEN (\"Old Value\" = \'PICKED\' OR \"Old Value\" = \'PICKING\') AND \"New Value\" = \'PACKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) = DATE(MAX(CASE WHEN (\"Old Value\" = \'MANIFESTED\' OR \"Old Value\" = \'READY_TO_SHIP\') AND \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) OR DATE(MAX(CASE WHEN \"Old Value\" = \'PACKED\' AND \"New Value\" = \'READY_TO_SHIP\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) = DATE(MAX(CASE WHEN (\"Old Value\" = \'MANIFESTED\' OR \"Old Value\" = \'READY_TO_SHIP\') AND \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END)) THEN 1 ELSE 0 END AS \"pack&dispatch\", CASE WHEN MAX(CASE WHEN \"New Value\" = \'CANCELLED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'CANCELLED\' WHEN MAX(CASE WHEN \"New Value\" = \'DELIVERED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'DELIVERED\' WHEN MAX(CASE WHEN \"New Value\" = \'SHIPPED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'SHIPPED\' WHEN MAX(CASE WHEN \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'DISPATCHED\' WHEN MAX(CASE WHEN \"New Value\" = \'MANIFESTED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'MANIFESTED\' WHEN MAX(CASE WHEN \"New Value\" = \'READY_TO_SHIP\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'READY_TO_SHIP\' WHEN MAX(CASE WHEN \"New Value\" = \'PACKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'PACKED\' WHEN MAX(CASE WHEN \"New Value\" = \'PICKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'PICKED\' WHEN MAX(CASE WHEN \"New Value\" = \'PICKING\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'PICKING\' WHEN MAX(CASE WHEN \"New Value\" = \'CREATED\' THEN TO_TIMESTAMP(\"Time Stamp\") END) IS NOT NULL THEN \'CREATED\' ELSE \'NEW\' END AS LATEST_STATUS, GREATEST( COALESCE(MAX(CASE WHEN \"New Value\" = \'CANCELLED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'DELIVERED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'SHIPPED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'DISPATCHED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'MANIFESTED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'READY_TO_SHIP\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'PACKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'PICKED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'PICKING\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp), COALESCE(MAX(CASE WHEN \"New Value\" = \'CREATED\' THEN TO_TIMESTAMP(\"Time Stamp\") END), \'1970-01-01 00:00:00\'::timestamp) ) AS LAST_UPDATED FROM snitch_db.maplemonk.snitch_get_shipping_package_timeline GROUP BY \"Sale Order Code\", \"Display Order Code\", \"Shipping Package Code\", \"No. of Items\";",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from snitch_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        