{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA_Order_By_Source_Consolidated_Intermediate AS select \'Shopify_DRV\' as Shop_Name, * from RPSG_DB.MAPLEMONK.ga_drv_orders_by_source union all select \'Shopify_Herbobuild\' as Shop_Name, * from RPSG_DB.MAPLEMONK.ga_herbobuild_orders_by_source union all select \'Shopify_AyurvedicSource\' as Shop_Name, * from RPSG_DB.MAPLEMONK.ga_ayurvedic_orders_by_source; CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA_ORDER_BY_SOURCE_CONSOLIDATED_DRV AS select coalesce(GCM.\"New Channel\", GASC.GA_SOURCEMEDIUM) Channel,GASC.* from RPSG_DB.MAPLEMONK.GA_Order_By_Source_Consolidated_Intermediate GASC left join (select * from (select *, row_number() over (partition by lower(ifnull(source,\'\')),lower(ifnull(medium,\'\')) order by 1) rw from RPSG_DB.MAPLEMONK.utm_ga_consolidated_channel_mapping) where rw=1 )GCM on lower(ifnull(GASC.ga_source,\'\')) = lower(ifnull(GCM.source,\'\')) and lower(ifnull(GASC.ga_medium,\'\')) = lower(ifnull(GCM.medium,\'\')) ; CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA_Sessions_Consolidated_Intermediate AS select \'Shopify_DRV\' as Shop_Name, _AIRBYTE_UNIQUE_KEY, GA_DATE, VIEW_ID, GA_EXITS, GA_USERS, GA_MEDIUM, GA_SOURCE, GA_CAMPAIGN, GA_NEWUSERS, GA_SESSIONS, GA_PAGEVIEWS, GA_SOURCEMEDIUM, GA_UNIQUEPAGEVIEWS, GA_AVGSESSIONDURATION, _AIRBYTE_AB_ID, _AIRBYTE_EMITTED_AT, _AIRBYTE_NORMALIZED_AT, _AIRBYTE_GA_DRV_SESSIONS_BY_DATE_HASHID from RPSG_DB.MAPLEMONK.ga_drv_sessions_by_date where ga_campaign is not null union all select \'Shopify_Herbobuild\' as Shop_Name, _AIRBYTE_UNIQUE_KEY, GA_DATE, VIEW_ID, GA_EXITS, GA_USERS, GA_MEDIUM, GA_SOURCE, GA_CAMPAIGN, GA_NEWUSERS, GA_SESSIONS, GA_PAGEVIEWS, GA_SOURCEMEDIUM, GA_UNIQUEPAGEVIEWS, GA_AVGSESSIONDURATION, _AIRBYTE_AB_ID, _AIRBYTE_EMITTED_AT, _AIRBYTE_NORMALIZED_AT, _AIRBYTE_GA_HERBOBUILD_SESSIONS_BY_DATE_HASHID from RPSG_DB.MAPLEMONK.ga_herbobuild_sessions_by_date where ga_campaign is not null union all select \'Shopify_AyurvedicSource\' as Shop_Name, _AIRBYTE_UNIQUE_KEY, GA_DATE, VIEW_ID, GA_EXITS, GA_USERS, GA_MEDIUM, GA_SOURCE, GA_CAMPAIGN, GA_NEWUSERS, GA_SESSIONS, GA_PAGEVIEWS, GA_SOURCEMEDIUM, GA_UNIQUEPAGEVIEWS, GA_AVGSESSIONDURATION, _AIRBYTE_AB_ID, _AIRBYTE_EMITTED_AT, _AIRBYTE_NORMALIZED_AT, _AIRBYTE_GA_AYURVEDIC_SESSIONS_BY_DATE_HASHID from RPSG_DB.MAPLEMONK.ga_ayurvedic_sessions_by_date where ga_campaign is not null; CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA_Sessions_Consolidated_DRV AS select coalesce(GCM.\"New Channel\",\'Not Mapped\') Channel,GASC.* from RPSG_DB.MAPLEMONK.GA_Sessions_Consolidated_Intermediate GASC left join RPSG_DB.MAPLEMONK.utm_ga_consolidated_channel_mapping GCM on lower(GASC.ga_source) = lower(GCM.source) and lower(GASC.ga_medium) = lower(GCM.medium) ; create or replace table RPSG_DB.MAPLEMONK.GA_USERS_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,tu.ga_date ,tu.view_id ,tu.ga_users total_users ,tu.ga_newusers total_new_users ,tu.ga_exits total_exits ,tu.ga_sessions total_Sessions ,tu.ga_pageviews total_pageviews ,tu.ga_uniquepageviews total_uniquepageviews ,tu.ga_bounces total_bounces ,tu.ga_avgsessionduration total_Avg_Session_Duration ,tu.ga_avgpageloadtime TOTAL_AVG_LOAD_TIME ,tu.ga_pageviewspersession total_Pageview_Per_Session ,ifnull(bayu.ga_users,0) Brand_Adyogi_Users ,ifnull(dvu.ga_users,0) dv360_users ,ifnull(tbu.ga_users,0) taboola_users ,(ifnull(tu.ga_users,0)-ifnull(bayu.ga_users,0)-ifnull(dvu.ga_users,0)-ifnull(tbu.ga_users,0)) Non_branding_users from rpsg_db.maplemonk.ga_drv_total_users_by_date tu left join rpsg_db.maplemonk.ga_drv_branding_adyogi_users_by_date bayu on tu.ga_date=bayu.ga_date and tu.view_id=bayu.view_id left join rpsg_db.maplemonk.ga_drv_dv360_users_by_date dvu on tu.ga_date=dvu.ga_date and tu.view_id=dvu.view_id left join rpsg_db.maplemonk.ga_drv_taboola_users_by_date tbu on tu.ga_date=tbu.ga_date and tu.view_id=tbu.view_id union all select \'Shopify_AyurvedicSource\' as Shop_Name ,tu.ga_date ,tu.view_id ,tu.ga_users total_users ,tu.ga_newusers total_new_users ,tu.ga_exits total_exits ,tu.ga_sessions total_Sessions ,tu.ga_pageviews total_pageviews ,tu.ga_uniquepageviews total_uniquepageviews ,tu.ga_bounces total_bounces ,tu.ga_avgsessionduration total_Avg_Session_Duration ,tu.ga_avgpageloadtime TOTAL_AVG_LOAD_TIME ,tu.ga_pageviewspersession total_Pageview_Per_Session ,ifnull(bayu.ga_users,0) Brand_Adyogi_Users ,ifnull(dvu.ga_users,0) dv360_users ,ifnull(tbu.ga_users,0) taboola_users ,(ifnull(tu.ga_users,0)-ifnull(bayu.ga_users,0)-ifnull(dvu.ga_users,0)-ifnull(tbu.ga_users,0)) Non_branding_users from rpsg_db.maplemonk.as_ga_total_users_by_date tu left join rpsg_db.maplemonk.as_ga_branding_adyogi_users_by_date bayu on tu.ga_date=bayu.ga_date and tu.view_id=bayu.view_id left join rpsg_db.maplemonk.as_ga_dv360_users_by_date dvu on tu.ga_date=dvu.ga_date and tu.view_id=dvu.view_id left join rpsg_db.maplemonk.as_ga_taboola_users_by_date tbu on tu.ga_date=tbu.ga_date and tu.view_id=tbu.view_id union all select \'Shopify_Herbobuild\' as Shop_Name ,tu.ga_date ,tu.view_id ,tu.ga_users total_users ,tu.ga_newusers total_new_users ,tu.ga_exits total_exits ,tu.ga_sessions total_Sessions ,tu.ga_pageviews total_pageviews ,tu.ga_uniquepageviews total_uniquepageviews ,tu.ga_bounces total_bounces ,tu.ga_avgsessionduration total_Avg_Session_Duration ,tu.ga_avgpageloadtime TOTAL_AVG_LOAD_TIME ,tu.ga_pageviewspersession total_Pageview_Per_Session ,ifnull(bayu.ga_users,0) Brand_Adyogi_Users ,ifnull(dvu.ga_users,0) dv360_users ,ifnull(tbu.ga_users,0) taboola_users ,(ifnull(tu.ga_users,0)-ifnull(bayu.ga_users,0)-ifnull(dvu.ga_users,0)-ifnull(tbu.ga_users,0)) Non_branding_users from rpsg_db.maplemonk.hb_ga_total_users_by_date tu left join rpsg_db.maplemonk.hb_ga_branding_adyogi_users_by_date bayu on tu.ga_date=bayu.ga_date and tu.view_id=bayu.view_id left join rpsg_db.maplemonk.hb_ga_dv360_users_by_date dvu on tu.ga_date=dvu.ga_date and tu.view_id=dvu.view_id left join rpsg_db.maplemonk.hb_ga_taboola_users_by_date tbu on tu.ga_date=tbu.ga_date and tu.view_id=tbu.view_id; create or replace table RPSG_DB.MAPLEMONK.GA_USERS_CAMPAIGN_SOURCE_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,ga_date ,view_id ,ga_campaign ,ga_sourcemedium ,ga_users Users_Campaign_Source ,ga_bounces Bounces_Campaign_Source ,ga_sessions Sessions_Campaign_Source ,ga_newusers New_Users_Campaign_Source ,ga_pageviews Pageviews_Campaign_Source ,ga_avgsessionduration Avg_Session_Duration_Campaign_Source ,ga_pageviewspersession Pageview_Per_Session_Campaign_Source ,ga_exits Exits_Campaign_Source ,ga_avgpageloadtime AVG_LOAD_TIME_Campaign_Source from rpsg_db.maplemonk.ga_drv_users_by_date_campaign_source union all select \'Shopify_AyurvedicSource\' as Shop_Name ,ga_date ,view_id ,ga_campaign ,ga_sourcemedium ,ga_users Users_Campaign_Source ,ga_bounces Bounces_Campaign_Source ,ga_sessions Sessions_Campaign_Source ,ga_newusers New_Users_Campaign_Source ,ga_pageviews Pageviews_Campaign_Source ,ga_avgsessionduration Avg_Session_Duration_Campaign_Source ,ga_pageviewspersession Pageview_Per_Session_Campaign_Source ,ga_exits Exits_Campaign_Source ,ga_avgpageloadtime AVG_LOAD_TIME_Campaign_Source from rpsg_db.maplemonk.as_ga_users_by_date_campaign_source union all select \'Shopify_Herbobuild\' as Shop_Name ,ga_date ,view_id ,ga_campaign ,ga_sourcemedium ,ga_users Users_Campaign_Source ,ga_bounces Bounces_Campaign_Source ,ga_sessions Sessions_Campaign_Source ,ga_newusers New_Users_Campaign_Source ,ga_pageviews Pageviews_Campaign_Source ,ga_avgsessionduration Avg_Session_Duration_Campaign_Source ,ga_pageviewspersession Pageview_Per_Session_Campaign_Source ,ga_exits Exits_Campaign_Source ,ga_avgpageloadtime AVG_LOAD_TIME_Campaign_Source from rpsg_db.maplemonk.hb_ga_users_by_date_campaign_source ; create or replace table RPSG_DB.MAPLEMONK.GA_USERS_SOURCE_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,ga_date ,view_id ,ga_sourcemedium ,ga_users Users_Source ,ga_bounces Bounces_Source ,ga_sessions Sessions_Source ,ga_newusers New_Users_Source ,ga_pageviews Pageviews_Source ,ga_avgsessionduration Avg_Session_Duration_Source ,ga_pageviewspersession Pageview_Per_Session_Source ,ga_exits Exits_Source ,ga_avgpageloadtime AVG_LOAD_TIME_SOURCE from rpsg_db.maplemonk.ga_drv_users_by_date_source union all select \'Shopify_AyurvedicSource\' as Shop_Name ,ga_date ,view_id ,ga_sourcemedium ,ga_users Users_Source ,ga_bounces Bounces_Source ,ga_sessions Sessions_Source ,ga_newusers New_Users_Source ,ga_pageviews Pageviews_Source ,ga_avgsessionduration Avg_Session_Duration_Source ,ga_pageviewspersession Pageview_Per_Session_Source ,ga_exits Exits_Source ,ga_avgpageloadtime AVG_LOAD_TIME_SOURCE from rpsg_db.maplemonk.as_ga_users_by_date_source union all select \'Shopify_Herbobuild\' as Shop_Name ,ga_date ,view_id ,ga_sourcemedium ,ga_users Users_Source ,ga_bounces Bounces_Source ,ga_sessions Sessions_Source ,ga_newusers New_Users_Source ,ga_pageviews Pageviews_Source ,ga_avgsessionduration Avg_Session_Duration_Source ,ga_pageviewspersession Pageview_Per_Session_Source ,ga_exits Exits_Source ,ga_avgpageloadtime AVG_LOAD_TIME_SOURCE from rpsg_db.maplemonk.hb_ga_users_by_date_source;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from RPSG_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        