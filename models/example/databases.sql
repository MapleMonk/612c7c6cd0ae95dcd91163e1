{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE FABALLEY_DB.MAPLEMONK.FACEBOOK_CONSOLIDATED_FABALLEY AS select Adset_Name,Adset_ID,Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks,SUM(SPEND) Spend_base, SUM(SPEND) Spend_INR,SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_BASE ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_INR ,\'Facebook\' Channel ,\'Facebook House of Indya\' Facebook_Account from FABALLEY_DB.MAPLEMONK.FACEBOOK_HOUSE_OF_INDYA_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from FABALLEY_DB.MAPLEMONK.FACEBOOK_HOUSE_OF_INDYA_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from FABALLEY_DB.MAPLEMONK.FACEBOOK_HOUSE_OF_INDYA_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start group by Adset_Name, Adset_ID, Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start UNION select Adset_Name,Adset_ID,Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks,SUM(SPEND) Spend_base, SUM(SPEND) Spend_INR, SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_Base ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_INR ,\'Facebook\' Channel ,\'Facebook Faballey Postpaid\' Facebook_Account from FABALLEY_DB.MAPLEMONK.FACEBOOK_FABALLEY_POSTPAID_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from FABALLEY_DB.MAPLEMONK.FACEBOOK_FABALLEY_POSTPAID_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from FABALLEY_DB.MAPLEMONK.FACEBOOK_FABALLEY_POSTPAID_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start group by Adset_Name, Adset_ID, Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start UNION select Adset_Name,Adset_ID,Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks, SUM(SPEND) Spend_Base, SUM(SPEND) Spend_INR, SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_Base ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_INR ,\'Facebook\' Channel ,\'Facebook Indya International\' Facebook_Account from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start group by Adset_Name, Adset_ID, Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start UNION select Adset_Name,Adset_ID,Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start Date ,SUM(CLICKS) Clicks,SUM(SPEND) Spend_Base, SUM(SPEND) Spend_INR, SUM(IMPRESSIONS) Impressions ,SUM(NVL(Fc.Conversions,0)) Conversions ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_Base ,SUM(NVL(Fcv.Conversion_Value,0)) Conversion_Value_INR ,\'Facebook\' Channel ,\'Facebook Indya International US\' Facebook_Account from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_US_ADS_INSIGHTS Fb left join ( select ad_id,date_start ,SUM(C.value:value) Conversions from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_US_ADS_INSIGHTS,lateral flatten(input => ACTIONS) C where C.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(C.value:value) is not null )Fc ON Fb.ad_id = Fc.ad_id and Fb.date_start=Fc.date_start left join ( select ad_id,date_start ,SUM(CV.value:value) Conversion_Value from FABALLEY_DB.MAPLEMONK.FACEBOOK_INDYA_INTERNATIONAL_US_ADS_INSIGHTS,lateral flatten(input => ACTION_VALUES) CV where CV.value:action_type=\'offsite_conversion.fb_pixel_purchase\' group by ad_id,date_start having SUM(CV.value:value) is not null )Fcv ON Fb.ad_id = Fcv.ad_id and Fb.date_start=Fcv.date_start group by Adset_Name, Adset_ID, Account_Name, Account_ID, Campaign_Name, Campaign_ID,Fb.date_start; CREATE OR REPLACE TABLE FABALLEY_DB.MAPLEMONK.GOOGLEADS_CONSOLIDATED_FABALLEY AS select \"campaign.name\", \"campaign.id\", \"segments.date\" ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,\'Google\' Channel ,\'Google House of Indya\' ACCOUNT ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend_base ,sum(\"metrics.cost_micros\")/1000000 spend_inr ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value_base ,sum(\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOUSE_OF_INDYA_CAMPAIGN_DATA group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI USD\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_USD_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:USD AS USD_EUR ,RATES:EUR/RATES:USD AS EUR_USD ,RATES:INR AS INR_EUR ,RATES:EUR/RATES:USD * RATES:INR AS INR_USD FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select \"campaign.name\", \"campaign.id\", \"segments.date\" ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,\'Google\' Channel ,\'Google Faballey.com\' ACCOUNT ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend_base ,sum(\"metrics.cost_micros\")/1000000 spend_inr ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value_base ,sum(\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_FABALLEYCOM_CAMPAIGN_DATA group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select \"campaign.name\", \"campaign.id\", \"segments.date\" ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI UAC Retargeting\' ACCOUNT ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend_base ,sum(\"metrics.cost_micros\")/1000000 spend_inr ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value_base ,sum(\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_UAC_RETARGETING_CAMPAIGN_DATA group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI GBP\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_GBP_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:GBP AS GBP_EUR ,RATES:EUR/RATES:GBP AS EUR_GBP ,RATES:INR AS INR_EUR ,RATES:EUR/RATES:GBP * RATES:INR AS INR_GBP FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI CAD\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_CAD_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:CAD AS CAD_EUR ,RATES:EUR/RATES:CAD AS EUR_CAD ,RATES:INR AS INR_EUR ,RATES:EUR/RATES:CAD * RATES:INR AS INR_CAD FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select \"campaign.name\", \"campaign.id\", \"segments.date\" ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,\'Google\' Channel ,\'Google FABALLEY UAC Retargeting\' ACCOUNT ,sum(\"metrics.clicks\") clicks ,sum(\"metrics.cost_micros\")/1000000 spend_base ,sum(\"metrics.cost_micros\")/1000000 spend_inr ,sum(\"metrics.impressions\") impressions ,sum(\"metrics.conversions\") conversions ,sum(\"metrics.conversions_value\") conversions_value_base ,sum(\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_FABALLEY_UAC_RETARGETING_CAMPAIGN_DATA group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI AUD\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_AUD_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:AUD AS AUD_EUR ,RATES:EUR/RATES:AUD AS EUR_AUD ,RATES:INR AS INR_EUR ,RATES:EUR/RATES:AUD * RATES:INR AS INR_AUD FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI SGD\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_SGD_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:SGD AS SGD_EUR ,RATES:EUR/RATES:SGD AS EUR_SGD ,RATES:INR AS INR_EUR ,RATES:EUR/RATES:SGD * RATES:INR AS INR_SGD FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\" UNION select GA.\"campaign.name\", GA.\"campaign.id\", GA.\"segments.date\" ,YEAR(GA.\"segments.date\") YEAR ,MONTH(GA.\"segments.date\") MONTH ,\'Google\' Channel ,\'Google HOI EUR\' ACCOUNT ,sum(GA.\"metrics.clicks\") clicks ,sum(GA.\"metrics.cost_micros\")/1000000 spend_base ,sum(GA.\"metrics.cost_micros\")/1000000 spend_inr ,sum(GA.\"metrics.impressions\") impressions ,sum(GA.\"metrics.conversions\") conversions ,sum(GA.\"metrics.conversions_value\") conversions_value_base ,sum(GA.\"metrics.conversions_value\") conversions_value_inr from FABALLEY_DB.maplemonk.GADS_HOI_EUR_CAMPAIGN_DATA GA LEFT JOIN (SELECT DATE ,RATES:EUR AS EUR_EUR ,RATES:INR AS INR_EUR FROM EXCHANGE_RATES) EX ON GA.\"segments.date\" = ex.date group by \"campaign.name\", \"campaign.id\", \"segments.date\"; CREATE OR REPLACE TABLE FABALLEY_DB.MAPLEMONK.MARKETING_CONSOLIDATED_FABALLEY AS select ACCOUNT_NAME, ACCOUNT_ID ,CAMPAIGN_NAME, CAMPAIGN_ID, DATE ,YEAR(DATE) AS YEAR ,MONTH(DATE) AS MONTH ,CHANNEL ,FACEBOOK_ACCOUNT AS ACCOUNT ,SUM(CLICKS) Clicks ,SUM(SPEND_BASE) SPEND_BASE ,SUM(SPEND_INR) SPEND_INR ,SUM(IMPRESSIONS) Impressions ,SUM(CONVERSIONS) Conversions ,SUM(CONVERSION_VALUE_BASE) CONVERSION_VALUE_BASE ,SUM(CONVERSION_VALUE_INR) CONVERSION_VALUE_INR from FABALLEY_DB.MAPLEMONK.FACEBOOK_CONSOLIDATED_FABALLEY group by ACCOUNT_NAME, ACCOUNT_ID ,CAMPAIGN_NAME, CAMPAIGN_ID, DATE, CHANNEL, FACEBOOK_ACCOUNT UNION select NULL, NULL ,\"campaign.name\", \"campaign.id\", \"segments.date\" ,YEAR(\"segments.date\") YEAR ,MONTH(\"segments.date\") MONTH ,Channel, ACCOUNT ,sum(CLICKS) clicks ,sum(SPEND_BASE) spend_base ,SUM(SPEND_INR) SPEND_INR ,sum(IMPRESSIONS) impressions ,sum(CONVERSIONS) conversions ,sum(conversions_value_base) conversions_value_base ,SUM(CONVERSIONS_VALUE_INR) CONVERSIONS_VALUE_INR from FABALLEY_DB.maplemonk.GOOGLEADS_CONSOLIDATED_FABALLEY group by \"campaign.name\", \"campaign.id\", \"segments.date\", channel, account;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from FABALLEY_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        