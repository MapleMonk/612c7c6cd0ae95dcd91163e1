{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA4_Order_By_Source_Consolidated_Intermediate AS select \'Shopify_DRV\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,MEDIUM GA4_MEDIUM ,SOURCE GA4_SOURCE ,PROPERTY_ID ,SOURCEMEDIUM GA4_SOURCEMEDIUM ,TRANSACTIONID ,GROSSPURCHASEREVENUE from RPSG_DB.MAPLEMONK.ga4_drv__orders_by_source union all select \'Shopify_Herbobuild\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,MEDIUM GA4_MEDIUM ,SOURCE GA4_SOURCE ,PROPERTY_ID ,SOURCEMEDIUM GA4_SOURCEMEDIUM ,TRANSACTIONID ,GROSSPURCHASEREVENUE from RPSG_DB.MAPLEMONK.ga4_hb_orders_by_source union all select \'Shopify_AyurvedicSource\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,MEDIUM GA4_MEDIUM ,SOURCE GA4_SOURCE ,PROPERTY_ID ,SOURCEMEDIUM GA4_SOURCEMEDIUM ,TRANSACTIONID ,GROSSPURCHASEREVENUE from RPSG_DB.MAPLEMONK.ga4_as_orders_by_source; CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA4_ORDER_BY_SOURCE_CONSOLIDATED_DRV AS select coalesce(GCM.final_channel, GASC.GA4_SOURCEMEDIUM) Channel ,GASC.* from RPSG_DB.MAPLEMONK.GA4_Order_By_Source_Consolidated_Intermediate GASC left join (select * from (select *, row_number() over (partition by lower(ga_sourcemedium) order by 1) rw from RPSG_DB.MAPLEMONK.GA_CHANNEL_MAPPING) where rw=1) GCM on lower(GASC.GA4_SOURCEMEDIUM) = lower(GCM.GA_SOURCEMEDIUM); CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA4_Sessions_Consolidated_Intermediate AS select \'Shopify_DRV\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,SESSIONMEDIUM GA4_SESSIONMEDIUM ,SESSIONSOURCE GA4_SESSIONSOURCE ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGN ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from RPSG_DB.MAPLEMONK.ga4_drv__sessions_by_date_campaign where SESSIONCAMPAIGNNAME is not null union all select \'Shopify_Herbobuild\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,SESSIONMEDIUM GA4_SESSIONMEDIUM ,SESSIONSOURCE GA4_SESSIONSOURCE ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGN ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from RPSG_DB.MAPLEMONK.ga4_hb_sessions_by_date_campaign where SESSIONCAMPAIGNNAME is not null union all select \'Shopify_AyurvedicSource\' as Shop_Name ,to_date(date,\'yyyymmdd\') DATE ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,SESSIONMEDIUM GA4_SESSIONMEDIUM ,SESSIONSOURCE GA4_SESSIONSOURCE ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGN ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from RPSG_DB.MAPLEMONK.ga4_as_sessions_by_date_campaign where SESSIONCAMPAIGNNAME is not null; CREATE OR REPLACE TABLE RPSG_DB.MAPLEMONK.GA4_Sessions_Consolidated_DRV AS select coalesce(GCM.final_channel,\'Not Mapped\') Channel ,GASC.* from RPSG_DB.MAPLEMONK.GA4_Sessions_Consolidated_Intermediate GASC left join (select * from (select *, row_number() over (partition by lower(ga_sourcemedium) order by 1) rw from RPSG_DB.MAPLEMONK.GA_CHANNEL_MAPPING) where rw=1) GCM on lower(GASC.GA4_SESSIONSOURCEMEDIUM) = lower(GCM.GA_SOURCEMEDIUM); create or replace table RPSG_DB.MAPLEMONK.GA4_USERS_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_drv__total_users_by_date union all select \'Shopify_AyurvedicSource\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_as_total_users_by_date union all select \'Shopify_Herbobuild\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_hb_total_users_by_date; create or replace table RPSG_DB.MAPLEMONK.GA4_USERS_CAMPAIGN_SOURCE_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGNNAME ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_drv__users_by_date_campaign_source union all select \'Shopify_AyurvedicSource\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGNNAME ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.GA4_AS_USERS_BY_DATE_CAMPAIGN_SOURCE union all select \'Shopify_Herbobuild\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONCAMPAIGNNAME GA4_SESSIONCAMPAIGNNAME ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_hb_users_by_date_campaign_source; create or replace table RPSG_DB.MAPLEMONK.GA4_USERS_SOURCE_CONSOLIDATED_DRV AS select \'Shopify_DRV\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_drv__users_by_date_source union all select \'Shopify_AyurvedicSource\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_as_users_by_date_source union all select \'Shopify_Herbobuild\' as Shop_Name ,to_date(date,\'yyyymmdd\') Date ,NEWUSERS ,SESSIONS ,TOTALUSERS ,PROPERTY_ID ,ENGAGEDSESSIONS ,SCREENPAGEVIEWS ,SESSIONSOURCEMEDIUM GA4_SESSIONSOURCEMEDIUM ,AVERAGESESSIONDURATION ,SCREENPAGEVIEWSPERSESSION from rpsg_db.maplemonk.ga4_hb_users_by_date_source;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from RPSG_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        