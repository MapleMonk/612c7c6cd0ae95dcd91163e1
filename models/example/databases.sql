{{ config(
            materialized='table',
                post_hook={
                    "sql": "Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_campaign_details as select distinct CAMPAIGNID ,name as campaignname ,targetingtype ,null as costtype ,state as CAMPAIGNSTATUS ,case when lower(name) like \'%b0%\' then left(right(name, length(name)-position(\'B0\',name)+1),10) end ASIN from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_product_campaigns_v3_mm union all select distinct campaignid ,name ,null as targetingtype ,null as costtype ,state as CAMPAIGNSTATUS ,case when lower(name) like \'%b0%\' then left(right(name, length(name)-position(\'B0\',name)+1),10) end ASIN from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_brands_campaigns union all select distinct campaignid ,name ,null as targetingtype ,COSTTYPE ,state as CAMPAIGNSTATUS ,case when lower(name) like \'%b0%\' then left(right(name, length(name)-position(\'B0\',name)+1),10) end ASIN from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_display_campaigns ; Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_adgroup_details as select distinct adgroupid ,upper(name) as adgroupname ,campaignid ,null as creativetype ,null as bidoptimization from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_brands_ad_groups union all select distinct adgroupid ,upper(name) as adgroupname ,campaignid ,null as creativetype ,null as bidoptimization from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_product_ad_groups union all select distinct adgroupid ,upper(name) as adgroupname ,campaignid ,creativetype ,upper(bidoptimization) as bidoptimization from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_display_ad_groups ; Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_ad_details as select distinct adid ,upper(name) as adname ,adgroupid ,campaignid , landingpage:\"pageType\"::string as landingpage ,state as ADSTATUS from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_brands_ads_v4_mm union all select distinct adid ,upper(asin) as asin ,adgroupid ,campaignid ,\'PRODUCT\' landingpage ,state as ADSTATUS from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_product_ads union all select distinct adid ,upper(asin) as asin ,adgroupid ,campaignid ,\'PRODUCT\' landingpage ,state as ADSTATUS from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_display_product_ads ; Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_targeting_details as select targetid ,adgroupid ,campaignid ,LISTAGG(targeting_type, \', \') WITHIN GROUP (ORDER BY targeting_type) targeting_type ,LISTAGG(targeting_value, \', \') WITHIN GROUP (ORDER BY targeting_type) targeting_value from ( select targetid ,adgroupid ,campaignid ,t.value:type::string as targeting_type ,t.value:value::string as targeting_value from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_display_targetings , lateral flatten(expression,outer => true) t ) group by 1,2,3 union all select targetid ,adgroupid ,campaignid ,LISTAGG(targeting_type, \', \') WITHIN GROUP (ORDER BY targeting_type) targeting_type ,LISTAGG(targeting_value, \', \') WITHIN GROUP (ORDER BY targeting_type) targeting_value from ( select targetid ,adgroupid ,campaignid ,t.value:type::string as targeting_type ,t.value:value::string as targeting_value from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_product_targetings_v3_mm , lateral flatten(expression,outer => true) t ) group by 1,2,3 ; Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_keyword_details as select distinct keywordid ,upper(keywordtext) as keywordtext ,adgroupid ,campaignid ,upper(matchtype) matchtype from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_brands_keywords union all select distinct keywordid ,upper(keywordtext) as keywordtext ,adgroupid ,campaignid ,null matchtype from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_sponsored_product_keywords ; Create or replace table EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AAMS_PROFILES as select PROFILEID ,TIMEZONE ,COUNTRYCODE ,CURRENCYCODE ,ACCOUNTINFO:id::string ACCOUNT_ID ,upper(ACCOUNTINFO:marketplaceStringId::string) MARKETPLACE_ID ,upper(ACCOUNTINFO:name::string) ACCOUNT_NAME ,upper(ACCOUNTINFO:type::string) ACCOUNT_TYPE from EMMASLEEP_DB.MAPLEMONK.EMMASLEEP_AA_PROFILES;",
                    "transaction": true
                }
            ) }}
            with sample_data as (

                select * from EMMASLEEP_DB.information_schema.databases
            ),
            
            final as (
                select * from sample_data
            )
            select * from final
            