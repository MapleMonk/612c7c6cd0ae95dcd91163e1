{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table ras_db.maplemonk.blinkit_fact_items as select null as CUSTOMER_ID_FINAL ,null as ACQUISITION_DATE ,null as FIRST_COMPLETE_ORDER_DATE ,null as MAPLE_MONK_ID_PHONE ,null as CUSTOMER_ID ,\'Blinkit\' as SHOP_NAME ,\'Blinkit\' as MARKETPLACE ,\'Blinkit\' as CHANNEL ,\'Blinkit\' as SOURCE ,item_id::varchar as ORDER_ID ,item_id::varchar as REFERENCE_CODE ,null as PHONE ,null as NAME ,null as EMAIL ,null as SHIPPING_LAST_UPDATE_DATE ,b.sku as SKU ,item_id::varchar as PRODUCT_ID ,item_name as PRODUCT_NAME ,null as CURRENCY ,City_name as CITY ,null as STATE ,null as ORDER_STATUS , (CASE WHEN POSITION(\'-\' IN date) = 5 THEN TO_DATE(date, \'YYYY-MM-DD\') WHEN POSITION(\'-\' IN date) = 3 THEN TO_DATE(date, \'DD-MM-YYYY\') when len(date) = 8 then to_date(date,\'DD-MM-YY\') ELSE NULL end)::date as ORDER_DATE ,qty_sold:float as QUANTITY ,null as GROSS_SALES_BEFORE_TAX ,null as DISCOUNT ,null as TAX ,null as SHIPPING_PRICE ,mrp::float as SELLING_PRICE ,null as OMS_ORDER_STATUS ,null as SHIPPING_STATUS ,null as FINAL_SHIPPING_STATUS ,null as SALEORDERITEMCODE ,null as SALES_ORDER_ITEM_ID ,null as AWB ,null as PAYMENT_GATEWAY ,null as PAYMENT_MODE ,null as COURIER ,null as DISPATCH_DATE , CASE WHEN POSITION(\'-\' IN date) = 5 THEN TO_DATE(date, \'YYYY-MM-DD\') WHEN POSITION(\'-\' IN date) = 3 THEN TO_DATE(date, \'DD-MM-YYYY\') when len(date) = 8 then to_Date(date,\'dd-mm-yy\') ELSE NULL end DELIVERED_DATE ,null as DELIVERED_STATUS ,null as RETURN_FLAG ,null as RETURNED_QUANTITY ,null as RETURNED_SALES ,null as CANCELLED_QUANTITY ,null as DAYS_IN_SHIPMENT ,null as ACQUSITION_DATE ,item_id::varchar as SKU_CODE ,b.product_name as PRODUCT_NAME_FINAL ,b.category as PRODUCT_CATEGORY ,b.sub_category as PRODUCT_SUB_CATEGORY ,null as WAREHOUSE ,null as NEW_CUSTOMER_FLAG ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,case when b.brand is null or b.brand = \'RAS\' then \'RAS\' when b.brand = \'Moody\' then \'Moody\' end brand from ras_db.MAPLEMONK.s3_blinkit_sales_ras a left join ( select * from (select \"Blinkit Item ID\" product_code,\"ERP SKU CODE\" sku, \"Product Variant Name\" product_name, \"Product Parent Name\" parent_name, Category, \"Sub-Category\" sub_category, \'RAS\' brand,row_number() over (partition by \"Blinkit Item ID\" order by 1) rw from ras_db.maplemonk.sku_master_ras_copy) where rw = 1 union all select * from (select \"Blinkit Item ID\" product_code,\"ERP SKU CODE\" sku, \"Product Name\" product_name, null as parent_name, Category, \"Sub-Category\" sub_category, \'Moody\' brand, row_number() over (partition by \"Blinkit Item ID\" order by 1) rw from ras_db.maplemonk.sku_master_moody_copy) where rw = 1 ) b on a.item_id::varchar = b.product_code ; create or replace table ras_db.maplemonk.Nykaa_fact_items as select null as CUSTOMER_ID_FINAL ,null as ACQUISITION_DATE ,null as FIRST_COMPLETE_ORDER_DATE ,null as MAPLE_MONK_ID_PHONE ,null as CUSTOMER_ID ,\'Nykaa\' as SHOP_NAME ,\'Nykaa\' as MARKETPLACE ,\'Nykaa\' as CHANNEL ,\'Nykaa\' as SOURCE ,\"SKU Code\"::varchar as ORDER_ID ,\"SKU Code\"::varchar as REFERENCE_CODE ,null as PHONE ,null as NAME ,null as EMAIL ,null as SHIPPING_LAST_UPDATE_DATE ,b.sku as SKU ,\"SKU Code\"::varchar as PRODUCT_ID ,\"SKU Name\" as PRODUCT_NAME ,null as CURRENCY ,null as CITY ,null as STATE ,null as ORDER_STATUS ,case when date like \'%/%\' then to_date(date,\'DD/MM/YYYY\') when len(date) = 8 then to_date(date,\'DD-MM-YY\') when right(date, 4) not like \'%-%\' then to_date(date,\'DD-MM-YYYY\') else to_date(date) end as ORDER_DATE ,\"Total Qty\":float as QUANTITY ,null as GROSS_SALES_BEFORE_TAX ,\"MRP\"::float - \"Selling Price\"::float as DISCOUNT ,null as TAX ,null as SHIPPING_PRICE ,\"Selling Price\"::float as SELLING_PRICE ,null as OMS_ORDER_STATUS ,null as SHIPPING_STATUS ,null as FINAL_SHIPPING_STATUS ,null as SALEORDERITEMCODE ,null as SALES_ORDER_ITEM_ID ,null as AWB ,null as PAYMENT_GATEWAY ,null as PAYMENT_MODE ,null as COURIER ,null as DISPATCH_DATE ,case when date like \'%/%\' then to_date(date,\'DD/MM/YYYY\') when len(date) = 8 then to_date(date,\'DD-MM-YY\') when right(date, 4) not like \'%-%\' then to_date(date,\'DD-MM-YYYY\') else to_date(date) end as DELIVERED_DATE ,null as DELIVERED_STATUS ,null as RETURN_FLAG ,null as RETURNED_QUANTITY ,null as RETURNED_SALES ,null as CANCELLED_QUANTITY ,null as DAYS_IN_SHIPMENT ,null as ACQUSITION_DATE ,\"SKU Code\" as SKU_CODE ,b.product_name as PRODUCT_NAME_FINAL ,b.category as PRODUCT_CATEGORY ,b.sub_category as PRODUCT_SUB_CATEGORY ,null as WAREHOUSE ,null as NEW_CUSTOMER_FLAG ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,case when b.brand is null or b.brand = \'RAS\' then \'RAS\' when b.brand = \'Moody\' then \'Moody\' end brand from ras_db.MAPLEMONK.s3_nykaa_sales_ras a left join ( select * from (select \"Nykaa SKU\" product_code,\"ERP SKU CODE\" sku, \"Product Variant Name\" product_name, \"Product Parent Name\" parent_name, Category, \"Sub-Category\" sub_category, \'RAS\' brand,row_number() over (partition by \"Nykaa SKU\" order by 1) rw from ras_db.maplemonk.sku_master_ras_copy where \"Nykaa SKU\" not in (\'Not Listed\', \'0\')) where rw = 1 ) b on a.\"SKU Code\"::varchar = b.product_code union all select null as CUSTOMER_ID_FINAL ,null as ACQUISITION_DATE ,null as FIRST_COMPLETE_ORDER_DATE ,null as MAPLE_MONK_ID_PHONE ,null as CUSTOMER_ID ,\'Nykaa\' as SHOP_NAME ,\'Nykaa\' as MARKETPLACE ,\'Nykaa\' as CHANNEL ,\'Nykaa\' as SOURCE ,\"SKU Code\"::varchar as ORDER_ID ,\"SKU Code\"::varchar as REFERENCE_CODE ,null as PHONE ,null as NAME ,null as EMAIL ,null as SHIPPING_LAST_UPDATE_DATE ,b.sku as SKU ,\"SKU Code\"::varchar as PRODUCT_ID ,\"SKU Name\" as PRODUCT_NAME ,null as CURRENCY ,null as CITY ,null as STATE ,null as ORDER_STATUS ,case when date like \'%/%\' then to_date(date,\'DD/MM/YYYY\') else date::date end as ORDER_DATE ,\"Total Qty\":float as QUANTITY ,null as GROSS_SALES_BEFORE_TAX ,\"MRP\"::float - \"Selling Price\"::float as DISCOUNT ,null as TAX ,null as SHIPPING_PRICE ,\"Selling Price\"::float as SELLING_PRICE ,null as OMS_ORDER_STATUS ,null as SHIPPING_STATUS ,null as FINAL_SHIPPING_STATUS ,null as SALEORDERITEMCODE ,null as SALES_ORDER_ITEM_ID ,null as AWB ,null as PAYMENT_GATEWAY ,null as PAYMENT_MODE ,null as COURIER ,null as DISPATCH_DATE ,case when date like \'%/%\' then to_date(date,\'DD/MM/YYYY\') else date::date end DELIVERED_DATE ,null as DELIVERED_STATUS ,null as RETURN_FLAG ,null as RETURNED_QUANTITY ,null as RETURNED_SALES ,null as CANCELLED_QUANTITY ,null as DAYS_IN_SHIPMENT ,null as ACQUSITION_DATE ,\"SKU Code\" as SKU_CODE ,b.product_name as PRODUCT_NAME_FINAL ,b.category as PRODUCT_CATEGORY ,b.sub_category as PRODUCT_SUB_CATEGORY ,null as WAREHOUSE ,null as NEW_CUSTOMER_FLAG ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,b.brand from ras_db.MAPLEMONK.s3_nykaa_sales_moody a left join ( select * from (select \"Nykaa SKU\" product_code,\"ERP SKU CODE\" sku, \"Product Name\" product_name, null parent_name, Category, \"Sub-Category\" sub_category, \'Moody\' brand,row_number() over (partition by \"Nykaa SKU\" order by 1) rw from ras_db.maplemonk.sku_master_moody_copy where \"Nykaa SKU\" not in (\'Not Listed\', \'0\')) where rw = 1 ) b on a.\"SKU Code\"::varchar = b.product_code ; create or replace table ras_db.maplemonk.flipkart_fact_items as select null as CUSTOMER_ID_FINAL ,null as ACQUISITION_DATE ,null as FIRST_COMPLETE_ORDER_DATE ,null as MAPLE_MONK_ID_PHONE ,null as CUSTOMER_ID ,\'Flipkart\' as SHOP_NAME ,\'Flipkart\' as MARKETPLACE ,\'Flipkart\' as CHANNEL ,\'Flipkart\' as SOURCE ,\"SKU Id\"::varchar as ORDER_ID ,\"SKU Id\"::varchar as REFERENCE_CODE ,null as PHONE ,null as NAME ,null as EMAIL ,null as SHIPPING_LAST_UPDATE_DATE ,b.sku as SKU ,\"SKU Id\"::varchar as PRODUCT_ID ,\"Product Title\" as PRODUCT_NAME ,null as CURRENCY ,null as CITY ,null as STATE ,null as ORDER_STATUS ,case when right(\"Impression Date\", 4) not like \'%-%\' then to_date(\"Impression Date\",\'DD-MM-YYYY\') else to_date(\"Impression Date\") end as ORDER_DATE ,Sales:float as QUANTITY ,null as GROSS_SALES_BEFORE_TAX ,null as DISCOUNT ,null as TAX ,null as SHIPPING_PRICE ,Revenue::float as SELLING_PRICE ,null as OMS_ORDER_STATUS ,null as SHIPPING_STATUS ,null as FINAL_SHIPPING_STATUS ,null as SALEORDERITEMCODE ,null as SALES_ORDER_ITEM_ID ,null as AWB ,null as PAYMENT_GATEWAY ,null as PAYMENT_MODE ,null as COURIER ,null as DISPATCH_DATE ,case when right(\"Impression Date\", 4) not like \'%-%\' then to_date(\"Impression Date\",\'DD-MM-YYYY\') else to_date(\"Impression Date\") end as DELIVERED_DATE ,null as DELIVERED_STATUS ,null as RETURN_FLAG ,null as RETURNED_QUANTITY ,null as RETURNED_SALES ,null as CANCELLED_QUANTITY ,null as DAYS_IN_SHIPMENT ,null as ACQUSITION_DATE ,\"SKU Id\" as SKU_CODE ,b.product_name as PRODUCT_NAME_FINAL ,b.category as PRODUCT_CATEGORY ,b.sub_category as PRODUCT_SUB_CATEGORY ,null as WAREHOUSE ,null as NEW_CUSTOMER_FLAG ,null as NEW_CUSTOMER_FLAG_MONTH ,null as ACQUISITION_PRODUCT ,null as ACQUISITION_CHANNEL ,null as ACQUISITION_MARKETPLACE ,b.brand from ras_db.MAPLEMONK.s3_flipkart_sales_moody a left join ( select * from (select \"Flipkart FSIN\" product_code,\"ERP SKU CODE\" sku, \"Product Variant Name\" product_name, \"Product Parent Name\" parent_name, Category, \"Sub-Category\" sub_category, \'RAS\' brand,row_number() over (partition by \"Flipkart FSIN\" order by 1) rw from ras_db.maplemonk.sku_master_ras_copy ) where rw = 1 union all select * from (select \"Flipkart FSIN\" product_code,\"ERP SKU CODE\" sku, \"Product Name\" product_name, null as parent_name, Category, \"Sub-Category\" sub_category, \'Moody\' brand, row_number() over (partition by \"Flipkart FSIN\" order by 1) rw from ras_db.maplemonk.sku_master_moody_copy) where rw = 1 ) b on a.\"SKU Id\"::varchar = b.product_code ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from ras_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        