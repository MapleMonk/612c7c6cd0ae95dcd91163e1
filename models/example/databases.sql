{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table snitch_db.maplemonk.source_medium_campaign_ga_funnel_data as ( with sessions_data as ( select to_date(w.date, \'YYYYMMDD\') as ga_date, \'web\' as type, w.sessionsource, w.sessionmedium, w.sessioncampaignname, COALESCE( CASE WHEN lower(w.sessionmedium) = \'affiliate\' THEN \'Affiliate\' WHEN (lower(w.sessionsource) = \'google\' and lower(w.sessionmedium) = \'cpc\') then \'Google_Ads\' when (lower(w.sessionsource) = \'organic\' or lower(w.sessionmedium) = \'organic\' or lower(w.sessionsource) = \'(not set)\' or lower(w.sessionmedium) = \'referral\') then \'Direct\' when (lower(w.sessionsource) = \'facebook\' or lower(w.sessionsource)=\'facebookads\') and lower(w.sessionmedium) = \'paid\' then \'Facebook_Ads\' ELSE m.channel end, m.channel ) AS channel, w.sessions, w.engagedsessions, w.addtocarts, w.checkouts, w.\"conversions:purchase\", w.totalrevenue, from snitch_db.maplemonk.WEB_SESSION_A2C_CHECKOUT_CONVERSION_SMC w left join snitch_db.maplemonk.GA_CHANNEL_MAPPING m on lower(w.sessionsource) = lower(m.source) and lower(w.sessionmedium) = lower(m.medium) and lower(w.sessioncampaignname) = lower(m.sessioncampaignname) union select to_date(a.date, \'YYYYMMDD\') as ga_date, \'app\' as type, a.sessionsource, a.sessionmedium, a.sessioncampaignname, COALESCE( CASE WHEN lower(a.sessionmedium) = \'(not set)\' and lower(a.sessionsource) = \'(not set)\' and lower(a.sessioncampaignname) = \'(not set)\' THEN \'Direct\' WHEN lower(a.sessionmedium) = \'push\' then \'Push\' when (lower(a.sessionsource) = \'adcanapous\' or lower(a.sessionmedium) = \'affiliate\') then \'Affiliate\' when lower(a.sessionsource)=\'facebookads\' then \'Facebook_Ads\' when lower(a.sessionmedium) = \'email\' then \'Email\' when lower(a.sessionmedium) = \'push\' then \'Push\' ELSE m.channel end, m.channel ) AS channel, a.sessions, a.engagedsessions, a.addtocarts, a.checkouts, a.\"conversions:purchase\", a.totalrevenue from snitch_db.maplemonk.APP_SESSIONS_A2C_CHECKOUTS_CONVERSIONS_SMC a left join snitch_db.maplemonk.GA_CHANNEL_MAPPING_APP m on lower(a.sessionsource) = lower(m.source) and lower(a.sessionmedium) = lower(m.medium) ), views_data as ( select to_date(date, \'YYYYMMDD\') as ga_date, \'web\' as type, sessionsource, sessionmedium, sessioncampaignname, itemsviewedinlist as views, itemsviewed as clicks, from snitch_db.maplemonk.WEB_VIEWS_CLICKS_SMC union select to_date(date, \'YYYYMMDD\') as ga_date, \'app\' as type, sessionsource, sessionmedium, sessioncampaignname, itemsviewedinlist as views, itemsviewed as clicks, from snitch_db.maplemonk.APP_VIEWS_CLICKS_SMC ) select s.ga_date, s.sessionsource, s.type, s.sessionmedium, s.sessioncampaignname, COALESCE(s.channel, \'Direct\') AS channel, s.sessions, s.engagedsessions, v.views, v.clicks, s.addtocarts, s.checkouts, s.\"conversions:purchase\", s.totalrevenue from sessions_data s left join views_data v on s.ga_date = v.ga_date and s.type = v.type and s.sessionsource = v.sessionsource and s.sessionmedium = v.sessionmedium and s.sessioncampaignname = v.sessioncampaignname );",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from snitch_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        