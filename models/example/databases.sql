{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "Create or replace table Gynoveda_DB.MAPLEMONK.Sales_Cost_CustomerType as with cost as ( select date, sum(spend) as cost from Gynoveda_DB.MAPLEMONK.MARKETING_CONSOLIDATED group by 1 order by 1 desc ) select order_timestamp::date as order_date ,b.cost ,count(distinct case when new_customer_flag = \'New\' then order_id end) as orders_all_new ,count(distinct case when new_customer_flag = \'Repeated\' then order_id end) as orders_all_Repeated ,count(distinct case when sku like \'%&%\' then order_id when right(sku,1) in (\'2\',\'3\',\'4\',\'5\',\'6\',\'7\',\'8\',\'9\') and new_customer_flag = \'New\' then order_id end ) as orders_combo_new ,count(distinct case when sku like \'%&%\' then order_id when right(sku,1) in (\'2\',\'3\',\'4\',\'5\',\'6\',\'7\',\'8\',\'9\') and new_customer_flag = \'Repeated\' then order_id end ) as orders_combo_Repeated ,sum(case when new_customer_flag = \'New\' then line_item_sales end) as gross_sales_new ,sum(case when new_customer_flag = \'Repeated\' then line_item_sales end) as gross_sales_Repeated ,sum(case when new_customer_flag = \'New\' then DISCOUNT end) as discount_new ,sum(case when new_customer_flag = \'Repeated\' then DISCOUNT end) as discount_Repeated ,sum(case when new_customer_flag = \'New\' then NET_SALES end) as net_sales_new ,sum(case when new_customer_flag = \'Repeated\' then NET_SALES end) as net_sales_Repeated from Gynoveda_db.maplemonk.FACT_ITEMS a left join cost b on a.order_timestamp::date = b.date group by 1,2 order by 1 desc ; Create or replace table Gynoveda_DB.MAPLEMONK.Sales_Cost_ProductType as with cost2 as ( select date ,products product_flag ,sum(spend) as cost from Gynoveda_DB.MAPLEMONK.MARKETING_CONSOLIDATED left join Gynoveda_DB.MAPLEMONK.product_campaign_mapping p on p.product_links = rtrim(ltrim(ad_URL,\'[\"\'),\'\"]\') group by 1,2 ) select order_timestamp::date as order_date ,s.sku_name as product_flag ,b.cost ,count(distinct case when new_customer_flag = \'New\' then order_id end) as orders_all_new ,count(distinct case when new_customer_flag = \'Repeated\' then order_id end) as orders_all_Repeated ,sum(case when new_customer_flag = \'New\' then line_item_sales end) as gross_sales_new ,sum(case when new_customer_flag = \'Repeated\' then line_item_sales end) as gross_sales_Repeated ,sum(case when new_customer_flag = \'New\' then DISCOUNT end) as discount_new ,sum(case when new_customer_flag = \'Repeated\' then DISCOUNT end) as discount_Repeated ,sum(case when new_customer_flag = \'New\' then NET_SALES end) as net_sales_new ,sum(case when new_customer_flag = \'Repeated\' then NET_SALES end) as net_sales_Repeated from Gynoveda_db.maplemonk.FACT_ITEMS a left join Gynoveda_DB.MAPLEMONK.skuname_mapping s on s.sku =a.sku left join cost2 b on a.order_timestamp::date = b.date and s.sku_name = b.product_flag group by 1,2,3 order by 1 desc; Create or replace table Gynoveda_DB.MAPLEMONK.Sales_Cost_ReferringChannel as select order_timestamp::date as order_date ,a.referring_channel ,count(distinct order_id) as orders ,sum(line_item_sales) as gross_sales ,sum(DISCOUNT) as discount ,sum(NET_SALES) as net_sales ,avg(REPLACE( sessions , \',\' )) as sessions from Gynoveda_db.maplemonk.FACT_ITEMS a left join Gynoveda_db.maplemonk.shopify_sessions_data s on a.order_timestamp::date = to_date(s.date,\'DD-MM-YYYY\') and a.referring_channel = case when s.referring_channel = \'FB\' then \'Facebook\' when s.referring_channel = \'IG\' then \'Instagram\' when s.referring_channel = \'Search\' then \'Google\' else s.referring_channel end group by 1,2 ; Create or replace table Gynoveda_DB.MAPLEMONK.Cost_by_Channel as select date,channel, sum(spend) as cost from Gynoveda_DB.MAPLEMONK.MARKETING_CONSOLIDATED group by 1,2 ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from GYNOVEDA_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        