{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table hox_db.maplemonk.HOX_BLANKO_packaging_material as with base as ( select reference_code, marketplace, report_date, report_type, total_product_weight, case when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" in (1,2) and \"20ml_quant\" <= 5 and \"8ml_quant\" <= 5 and \"Pack of 4-20 ml_quant\" <= 1 and report_date <= date(\'2023-09-20\') then \'Myntra paper bag + balaji new packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 1 and \"20ml_quant\" <= 5 and \"8ml_quant\" <= 5 and \"Pack of 4-20 ml_quant\" <= 1 and \"Pack of 8-8 ml_quant\" <= 1 and report_date > date(\'2023-09-20\') then \'Myntra paper bag + Xetgo single sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 2 and \"20ml_quant\" <= 5 and \"8ml_quant\" <= 5 and \"Pack of 4-20 ml_quant\" <= 1 and \"Pack of 8-8 ml_quant\" <= 1 and report_date > date(\'2023-09-20\') then \'Myntra paper bag + Xetgo double sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 2 and \"Pack of 4-20 ml_quant\" = 2 then \'Myntra paper bag + Xetgo double sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 1 and \"Pack of 4-20 ml_quant\" = 2 then \'Myntra paper bag + Xetgo single sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 1 and \"Pack of 8-8 ml_quant\" <= 2 then \'Myntra paper bag + Xetgo single sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"100ml_quant\" = 2 and \"Pack of 8-8 ml_quant\" <= 2 then \'Myntra paper bag + Xetgo double sku packaging box\' when lower(marketplace) = \'myntra ppmp\' and \"20ml_quant\" in (1,2,3,4,5) and \"8ml_quant\" in (1,2,3,4,5) and \"Pack of 4-20 ml_quant\" <= 2 then \'Myntra paper bag\' when lower(marketplace) = \'myntra ppmp\' and \"20ml_quant\" in (1,2,3,4,5) and \"8ml_quant\" in (1,2,3,4,5) and \"Pack of 8-8 ml_quant\" <= 2 then \'Myntra paper bag\' when lower(marketplace) = \'myntra ppmp\' and \"Pack of 4-20 ml_quant\" in (1,2) and \"Pack of 8-8 ml_quant\" = 1 then \'Myntra paper bag\' when lower(marketplace) = \'myntra ppmp\' and \"Pack of 4-20 ml_quant\" in (1,2) then \'Myntra paper bag\' when lower(marketplace) = \'myntra ppmp\' and \"Pack of 8-8 ml_quant\" in (1,2) then \'Myntra paper bag\' when lower(marketplace) = \'myntra ppmp\' and ((\"20ml_quant\" + \"8ml_quant\") between 1 and 8) and (\"100ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then \'Myntra paper bag\' when lower(marketplace) = \'flipkart\' and report_date <= date(\'2023-10-31\') and ((((\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") between 1 and 2) and \"Pack of 8-8 ml_quant\" = 0) or ((\"20ml_quant\" + \"8ml_quant\") between 1 and 6) or (\"Pack of 4-20 ml_quant\" = 1) ) then \'Flipkart 1st box\' when lower(marketplace) = \'flipkart\' and \"100ml_quant\" in (1,2) and (\"20ml_quant\" + \"8ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then (case when report_date <= date(\'2023-12-31\') then \'Flipkart 1st box\' when report_date >= date(\'2024-01-01\') then \'Flipkart 2nd box\' end) when lower(marketplace) = \'flipkart\' and \"100ml_quant\" = 1 and \"20ml_quant\" = 0 and \"8ml_quant\" = 1 and \"Pack of 4-20 ml_quant\" = 0 and \"Pack of 8-8 ml_quant\" = 0 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Flipkart 1st box\' when report_date >= date(\'2024-01-01\') then \'Flipkart 2nd box\' end) when lower(marketplace) = \'flipkart\' and \"100ml_quant\" in (1,2) and \"20ml_quant\" <= 5 and \"8ml_quant\" <= 5 and \"Pack of 4-20 ml_quant\" <= 1 and \"Pack of 8-8 ml_quant\" <= 1 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag+ Flipkart 1st box\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag+ Flipkart 2nd box\' end) when lower(marketplace) = \'flipkart\' and \"100ml_quant\" in (1,2) and \"Pack of 4-20 ml_quant\" = 2 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag+ Flipkart 1st box\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag+ Flipkart 2nd box\' end) when lower(marketplace) = \'flipkart\' and \"100ml_quant\" in (1,2) and \"Pack of 8-8 ml_quant\" <= 2 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag+ Flipkart 1st box\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag+ Flipkart 2nd box\' end) when lower(marketplace) = \'flipkart\' and \"20ml_quant\" in (1,2,3,4,5) and \"8ml_quant\" in (1,2,3,4,5) and \"Pack of 4-20 ml_quant\" <= 2 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag\' end) when lower(marketplace) = \'flipkart\' and \"20ml_quant\" in (1,2,3,4,5) and \"8ml_quant\" in (1,2,3,4,5) and \"Pack of 8-8 ml_quant\" <= 2 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag\' end) when lower(marketplace) = \'flipkart\' and \"Pack of 4-20 ml_quant\" in (1,2) and \"Pack of 8-8 ml_quant\" = 1 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag\' end) when lower(marketplace) = \'flipkart\' and (\"Pack of 4-20 ml_quant\" in (1,2) or \"Pack of 8-8 ml_quant\" in (1,2)) then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag\' end) when lower(marketplace) = \'flipkart\' and ((\"20ml_quant\" + \"8ml_quant\") between 1 and 8) and (\"100ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then (case when report_date between date(\'2023-11-01\') and date(\'2023-12-31\') then \'Blanko paper bag\' when report_date >= date(\'2024-01-01\') then \'Flipkart paper bag\' end) when lower(marketplace) like \'%cred%\' and \"100ml_quant\" in (1,2) and \"20ml_quant\" <= 5 and \"8ml_quant\" <= 5 and \"Pack of 4-20 ml_quant\" <= 1 and report_date <= date(\'2023-08-05\') then \'balaji new packaging box\' when lower(marketplace) like \'%cred%\' and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") = 1 and (report_date between date(\'2023-08-06\') and date(\'2023-10-31\')) then \'Xetgo single sku packaging box\' when lower(marketplace) like \'%cred%\' and \"Pack of 4-20 ml_quant\" = 1 and (report_date between date(\'2023-08-06\') and date(\'2023-10-31\')) then \'Xetgo double sku packaging box\' when lower(marketplace) like \'%cred%\' and \"Pack of 8-8 ml_quant\" = 1 and (report_date between date(\'2023-08-06\') and date(\'2023-10-31\')) then \'Blanko paper bag\' when lower(marketplace) like \'%amazon%\' and (\"100ml_quant\" >= 3 or \"20ml_quant\" > 10 or \"8ml_quant\" > 10 or \"Pack of 4-20 ml_quant\" > 3 or \"Pack of 8-8 ml_quant\" > 3) then \'Manufacturing box\' when lower(marketplace) like \'%amazon%\' and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") = 1 and(report_date <= date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 2 and (\"20ml_quant\" + \"8ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then \'Xetgo double sku packaging box\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 1 and \"20ml_quant\" = 0 and \"8ml_quant\" = 1 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 and (report_date > date(\'2023-10-20\')) then \'Xetgo double sku packaging box\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 1 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box + blanko paper bag\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 2 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 1 and (report_date > date(\'2023-10-20\')) then \'Xetgo double sku packaging box + blanko paper bag\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and (\"20ml_quant\" + \"8ml_quant\") <= 10 and (\"100ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then (case when (report_date <= date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' end ) when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") = 0 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 3 then (case when (report_date <= date(\'2023-10-20\')) then \'Manufacturing box\' when (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' end ) when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 0 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 2 and (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' when (lower(marketplace) like \'%amazon%\' or lower(marketplace) like \'%cred%\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and \"Pack of 4-20 ml_quant\" <= 2 and \"Pack of 8-8 ml_quant\" = 0 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box + blanko paper bag\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"100ml_quant\" >= 3 or \"20ml_quant\" > 10 or \"8ml_quant\" > 10 or \"CAP_quant\" > 3 or \"Tshirt_quant\" > 3 or \"Pack of 4-20 ml_quant\" > 3 or \"Pack of 8-8 ml_quant\" > 3) then \'Manufacturing box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (report_date between date(\'2023-04-01\') and date(\'2023-06-05\')) and \"100ml_quant\" in (1,2) then \'Balaji 1st box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (report_date between date(\'2023-06-06\') and date(\'2023-09-29\')) and \"100ml_quant\" in (1,2) then \'Balaji 2nd box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") = 1 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 and (report_date between date(\'2023-09-30\') and date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"100ml_quant\") in (1,2) and (\"20ml_quant\" + \"8ml_quant\") in (1,2) and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 and (report_date between date(\'2023-09-30\') and date(\'2023-10-20\')) then \'Xetgo double sku packaging box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") >= 0 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") > 0 and (report_date between date(\'2023-09-30\') and date(\'2023-10-20\')) then \'Manufacturing box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 2 and (\"20ml_quant\" + \"8ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then \'Xetgo double sku packaging box\' when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 1 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box + blanko paper bag\' when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 2 and (\"20ml_quant\" + \"8ml_quant\") <= 6 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 1 and (report_date > date(\'2023-10-20\')) then \'Xetgo double sku packaging box + blanko paper bag\' when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"20ml_quant\" + \"8ml_quant\") <= 10 and (\"100ml_quant\" + \"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") = 0 then (case when (report_date between date(\'2023-09-30\') and date(\'2023-10-20\')) then \'Xetgo single sku packaging box\' when (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' end ) when lower(marketplace) in (\'shopify\', \'retail customers\') and (\"100ml_quant\" + \"20ml_quant\" + \"8ml_quant\") = 0 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 3 then (case when (report_date between date(\'2023-09-30\') and date(\'2023-10-20\')) then \'Manufacturing box\' when (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' end ) when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 0 and (\"20ml_quant\" + \"8ml_quant\") <= 8 and (\"Pack of 4-20 ml_quant\" + \"Pack of 8-8 ml_quant\") <= 2 and (report_date > date(\'2023-10-20\')) then \'blanko paper bag\' when lower(marketplace) in (\'shopify\', \'retail customers\') and \"100ml_quant\" = 1 and (\"20ml_quant\" + \"8ml_quant\") <= 8 and \"Pack of 4-20 ml_quant\" <= 2 and \"Pack of 8-8 ml_quant\" = 0 and (report_date > date(\'2023-10-20\')) then \'Xetgo single sku packaging box + blanko paper bag\' else \'Manufacturing box\' end as packaging_box from ( select reference_code, report_date, marketplace, report_type, sum(total_weight) as total_product_weight, coalesce(sum(case when sku_type = \'100 ml\' then quantity end),0) as \"100ml_quant\", coalesce(sum(case when sku_type = \'20 ml\' then quantity end),0) as \"20ml_quant\", coalesce(sum(case when sku_type = \'8 ml\' then quantity end),0) as \"8ml_quant\", coalesce(sum(case when sku_type = \'CAP\' then quantity end),0) as \"CAP_quant\", coalesce(sum(case when sku_type = \'Pack of 4 - 20 ml\' then quantity end),0) as \"Pack of 4-20 ml_quant\", coalesce(sum(case when sku_type = \'Pack of 8 - 8 ml\' then quantity end),0) as \"Pack of 8-8 ml_quant\", coalesce(sum(case when sku_type = \'Tshirt\' then quantity end),0) as \"Tshirt_quant\" from hox_db.maplemonk.HOX_BLANKO_Tax_consolidated_report_intermediate where lower(order_status) not like \'%cancel%\' and report_type in (\'Easyecom sale\', \'Amazon Sales\') and lower(marketplace) in (\'amazon easyship\', \'cred-api\', \'flipkart\', \'myntra ppmp\', \'shopify\', \'amazon fba\', \'retail customers\') group by 1,2,3,4 )as o group by 1,2,3,4, 5,6 ) select o.*, coalesce(round(((packaging_weight + total_product_weight)/1000),2), 0) as final_order_weight from ( select o.*, case when trim(lower(packaging_box)) = \'balaji 1st box\' then 4.15 when trim(lower(packaging_box)) = \'balaji 2nd box\' then 16 when trim(lower(packaging_box)) = \'balaji new packaging box\' then 18 when trim(lower(packaging_box)) = \'blanko paper bag\' then 10 when trim(lower(packaging_box)) = \'blanko paper bag+ flipkart 1st box\' then 21 when trim(lower(packaging_box)) = \'flipkart 1st box\' then 11 when trim(lower(packaging_box)) = \'flipkart 2nd box\' then 7.5 when trim(lower(packaging_box)) = \'flipkart paper bag\' then 4.5 when trim(lower(packaging_box)) = \'flipkart paper bag+ flipkart 2nd box\' then 12 when trim(lower(packaging_box)) = \'manufacturing box\' then 0 when trim(lower(packaging_box)) = \'myntra paper bag\' then 4.5 when trim(lower(packaging_box)) = \'myntra paper bag + balaji new packaging box\' then 22.5 when trim(lower(packaging_box)) = \'myntra paper bag + xetgo double sku packaging box\' then 35.5 when trim(lower(packaging_box)) = \'myntra paper bag + xetgo single sku packaging box\' then 28.5 when trim(lower(packaging_box)) = \'xetgo double sku packaging box\' then 31 when trim(lower(packaging_box)) = \'xetgo double sku packaging box + blanko paper bag\' then 41 when trim(lower(packaging_box)) = \'xetgo single sku packaging box\' then 24 when trim(lower(packaging_box)) = \'xetgo single sku packaging box + blanko paper bag\' then 34 end as packaging_cost, case when trim(lower(packaging_box)) = \'balaji 1st box\' then 109 when trim(lower(packaging_box)) = \'balaji 2nd box\' then 109 when trim(lower(packaging_box)) = \'balaji new packaging box\' then 109 when trim(lower(packaging_box)) = \'blanko paper bag\' then 34 when trim(lower(packaging_box)) = \'blanko paper bag+ flipkart 1st box\' then 143 when trim(lower(packaging_box)) = \'flipkart 1st box\' then 109 when trim(lower(packaging_box)) = \'flipkart 2nd box\' then 109 when trim(lower(packaging_box)) = \'flipkart paper bag\' then 23 when trim(lower(packaging_box)) = \'flipkart paper bag+ flipkart 2nd box\' then 132 when trim(lower(packaging_box)) = \'manufacturing box\' then 0 when trim(lower(packaging_box)) = \'myntra paper bag\' then 23 when trim(lower(packaging_box)) = \'myntra paper bag + balaji new packaging box\' then 132 when trim(lower(packaging_box)) = \'myntra paper bag + xetgo double sku packaging box\' then 178 when trim(lower(packaging_box)) = \'myntra paper bag + xetgo single sku packaging box\' then 107 when trim(lower(packaging_box)) = \'xetgo double sku packaging box\' then 155 when trim(lower(packaging_box)) = \'xetgo double sku packaging box + blanko paper bag\' then 189 when trim(lower(packaging_box)) = \'xetgo single sku packaging box\' then 84 when trim(lower(packaging_box)) = \'xetgo single sku packaging box + blanko paper bag\' then 118 end as packaging_weight from ( select distinct reference_code, marketplace, report_date, report_type, total_product_weight, case when (packaging_box is null or packaging_box = \'\') then \'Manufacturing box\' else packaging_box end as packaging_box from base )as o )as o",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from HOX_DB.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        