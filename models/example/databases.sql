{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "Create or replace table SNITCH_DB.maplemonk.Weight_reconciliation as With ClickPost_data as ( select AWB_NUMBER, PICKUP_DATE::date as pickup_date, CURRENT_STATUS, COURIER_PARTNER, PAYMENT_METHOD from SNITCH_DB.SNITCH.SLEEPYCAT_DB_CLICKPOST_FACT_ITEMS ), Unicommerce_data as ( select awb, order_id, pincode, shipping_courier, zone as snitch_zone, sum(SUBORDER_QUANTITY) as quantity, sum(selling_price1) as selling_price, sum(weight1) as weight, div0(weight+99,500) as slab, ceil(SLAB) AS RoundedSlab from ( select awb, order_id, pincode, uf.sku, SUBORDER_QUANTITY, selling_price as selling_price1, SHIPPING_COURIER , pd.\"WEIGHT(KG)\"*1000*SUBORDER_QUANTITY as weight1, p.zone as zone from (select * from snitch_db.maplemonk.unicommerce_fact_items_snitch where MARKETPLACE_MAPPED = \'SHOPIFY\' )uf left join snitch_db.snitch.product_dim pd on pd.sku = uf.sku left join snitch_db.maplemonk.pincodemappingzoneupdatedsnitch p on uf.pincode = p.delivery_postcode ) group by 1,2,3,4,5 ) select lk.*, czm.\" Zone\" as updated_zone , case when COURIER_PARTNER = \'Blitz (Formerly Grow Simplee)\' then 25+(23*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'A\' then (ROUNDEDSLAB*20.80) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'B\' then (ROUNDEDSLAB*22) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'C1\' then 26.75+(24.75*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'C2\' then 26.75+(24.75*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'D1\' then 29.80+(27.8*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'D2\' then 29.80+(27.8*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'E\' then (39 * ROUNDEDSLAB) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) like \'delhivery surface%\' and PICKUP_DATE::date >= \'2024-01-01\' and updated_zone = \'F\' then (39 * ROUNDEDSLAB) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\') and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'A\' then (ROUNDEDSLAB*20.80) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\') and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'B\' then (ROUNDEDSLAB*22) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\') and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'C\' then (ROUNDEDSLAB*34) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\') and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'D\' then (ROUNDEDSLAB*39) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\')and PICKUP_DATE::date >=\'2024-01-01\' and updated_zone = \'E\' then 49+(47*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and lower(shipping_courier) in (\'delhivery\') and PICKUP_DATE::date >= \'2024-01-01\' and updated_zone = \'F\' then 59+(39*(ROUNDEDSLAB-1)) when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'A\' then (ROUNDEDSLAB*24.20) when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'B\' then (ROUNDEDSLAB*27.60) when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'C1\' then 31.20*ROUNDEDSLAB when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'C2\' then 31.20*ROUNDEDSLAB when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'D1\' then 42.90*ROUNDEDSLAB when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'D2\' then 42.90*ROUNDEDSLAB when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'E\' then (63 * ROUNDEDSLAB) when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and updated_zone = \'F\' then (63 * ROUNDEDSLAB) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) in (\'bluedart\',\'blue dart\') and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'intra city\') then (ROUNDEDSLAB*22) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) in (\'bluedart\',\'blue dart\') and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'intra region\') then (ROUNDEDSLAB*24) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) in (\'bluedart\',\'blue dart\') and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'roi\') then (ROUNDEDSLAB*28) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) in (\'bluedart\',\'blue dart\') and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'ne&jk&zpecial zone\') then (ROUNDEDSLAB*46) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) in (\'bluedart\',\'blue dart\') and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'metro\') then (ROUNDEDSLAB*25) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) like \'bluedart brands 500%\' and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'intra city\') then (ROUNDEDSLAB*18) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) like \'bluedart brands 500%\' and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'intra region\') then (ROUNDEDSLAB*18.5) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) like \'bluedart brands 500%\' and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'roi\') then (ROUNDEDSLAB*28) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) like \'bluedart brands 500%\' and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'ne&jk&zpecial zone\') then (ROUNDEDSLAB*29) when COURIER_PARTNER = \'Bluedart\' and lower(shipping_courier) like \'bluedart brands 500%\' and PICKUP_DATE::date >=\'2024-01-01\' and lower(updated_zone) = lower(\'metro\') then (ROUNDEDSLAB*25) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date <\'2024-01-01\' and lower(updated_zone) = lower(\'intra city\') then (ROUNDEDSLAB*22) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date < \'2024-01-01\' and lower(updated_zone) = lower(\'intra region\') then (ROUNDEDSLAB*24) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date < \'2024-01-01\' and lower(updated_zone) = lower(\'roi\') then (ROUNDEDSLAB*28) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date < \'2024-01-01\' and lower(updated_zone) = lower(\'ne&jk&zpecial zone\') then (ROUNDEDSLAB*46) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date < \'2024-01-01\' and lower(updated_zone) = lower(\'metro\') then (ROUNDEDSLAB*25) when COURIER_PARTNER = \'Shiprocket\' and lower(shipping_courier) like \'Shadowfax NDD Air\' and PICKUP_DATE::date >=\'2024-03-16\' and updated_zone = lower(\'c\') then (ROUNDEDSLAB*36) when COURIER_PARTNER = \'Shiprocket\'and lower(updated_zone) = \'a\' then (ROUNDEDSLAB*27) when COURIER_PARTNER = \'Shiprocket\'and lower(updated_zone) = \'b\' then (ROUNDEDSLAB*31) when COURIER_PARTNER = \'Shiprocket\'and lower(updated_zone) = \'c\' then (ROUNDEDSLAB*37) when COURIER_PARTNER = \'Shiprocket\'and lower(updated_zone) = \'d\' then (ROUNDEDSLAB*42) when COURIER_PARTNER = \'Shiprocket\'and lower(updated_zone) = \'e\' then (ROUNDEDSLAB*69) end as Logistic_cost , case WHEN COURIER_PARTNER = \'Delhivery\' AND LOWER(shipping_courier) LIKE \'delhivery\' AND PICKUP_DATE::DATE >= \'2024-01-01\' THEN CASE WHEN updated_zone = \'A\' THEN ROUNDEDSLAB * 20.80 WHEN updated_zone = \'B\' THEN ROUNDEDSLAB * 22 WHEN updated_zone = \'C1\' THEN 26.75 + (24.75 * (ROUNDEDSLAB - 1)) WHEN updated_zone = \'C2\' THEN 26.75 + (24.75 * (ROUNDEDSLAB - 1)) WHEN updated_zone = \'D1\' THEN 29.80 + (27.8 * (ROUNDEDSLAB - 1)) WHEN updated_zone = \'D2\' THEN 29.80 + (27.8 * (ROUNDEDSLAB - 1)) WHEN updated_zone = \'E\' THEN 39 * ROUNDEDSLAB WHEN updated_zone = \'F\' THEN 39 * ROUNDEDSLAB END WHEN COURIER_PARTNER = \'Delhivery\' AND PICKUP_DATE::DATE < \'2024-01-01\' THEN CASE WHEN updated_zone = \'A\' THEN ROUNDEDSLAB * 24.20 WHEN updated_zone = \'B\' THEN ROUNDEDSLAB * 27.60 WHEN updated_zone IN (\'C1\', \'C2\') THEN 31.20 * ROUNDEDSLAB WHEN updated_zone IN (\'D1\', \'D2\') THEN 42.90 * ROUNDEDSLAB WHEN updated_zone IN (\'E\', \'F\') THEN 63 * ROUNDEDSLAB END END AS Delhivery_Surface, CASE WHEN COURIER_PARTNER = \'Delhivery\' AND LOWER(shipping_courier) = \'delhivery\' AND PICKUP_DATE::DATE >= \'2024-01-01\' THEN CASE WHEN updated_zone = \'A\' THEN ROUNDEDSLAB * 20.80 WHEN updated_zone = \'B\' THEN ROUNDEDSLAB * 22 WHEN updated_zone = \'C1\' THEN ROUNDEDSLAB * 34 WHEN updated_zone = \'C2\' THEN ROUNDEDSLAB * 34 WHEN updated_zone = \'D1\' THEN ROUNDEDSLAB * 39 WHEN updated_zone = \'D2\' THEN ROUNDEDSLAB * 39 WHEN updated_zone = \'E\' THEN 49 + (47 * (ROUNDEDSLAB - 1)) WHEN updated_zone = \'F\' THEN 59 + (39 * (ROUNDEDSLAB - 1)) END WHEN COURIER_PARTNER = \'Delhivery\' AND PICKUP_DATE::DATE < \'2024-01-01\' THEN CASE WHEN updated_zone = \'A\' THEN ROUNDEDSLAB * 24.20 WHEN updated_zone = \'B\' THEN ROUNDEDSLAB * 27.60 WHEN updated_zone IN (\'C1\', \'C2\') THEN 31.20 * ROUNDEDSLAB WHEN updated_zone IN (\'D1\', \'D2\') THEN 42.90 * ROUNDEDSLAB WHEN updated_zone IN (\'E\', \'F\') THEN 63 * ROUNDEDSLAB END END AS Delhivery_Air, CASE WHEN COURIER_PARTNER = \'Blitz (Formerly Grow Simplee)\' THEN 25 + (23 * (ROUNDEDSLAB - 1)) WHEN COURIER_PARTNER = \'Bluedart\' AND AWB LIKE \'8%\' AND PICKUP_DATE::DATE >= \'2024-01-01\' THEN CASE WHEN LOWER(updated_zone) = \'intra city\' THEN ((ROUNDEDSLAB * 22) + (ROUNDEDSLAB * 22) * 0.15) WHEN LOWER(updated_zone) = \'intra region\' THEN ((ROUNDEDSLAB * 24) + (ROUNDEDSLAB * 24) * 0.20) WHEN LOWER(updated_zone) = \'roi\' THEN ((ROUNDEDSLAB * 28) + (ROUNDEDSLAB * 28) * 0.35) WHEN LOWER(updated_zone) = \'ne&jk&zpecial zone\' THEN ((ROUNDEDSLAB * 46) * (ROUNDEDSLAB * 46) * 0.60) WHEN LOWER(updated_zone) = \'metro to metro\' THEN ((ROUNDEDSLAB * 25) + (ROUNDEDSLAB * 25) * 0.35) END WHEN COURIER_PARTNER = \'Bluedart\' AND AWB LIKE \'7%\' AND PICKUP_DATE::DATE >= \'2024-01-01\' THEN CASE WHEN LOWER(updated_zone) = \'intra city\' THEN ((ROUNDEDSLAB * 18) + (ROUNDEDSLAB * 18) * 0.15) WHEN LOWER(updated_zone) = \'intra region\' THEN ((ROUNDEDSLAB * 18.5) + (ROUNDEDSLAB * 18.5) * 0.20) WHEN LOWER(updated_zone) = \'roi\' THEN ((ROUNDEDSLAB * 28) + (ROUNDEDSLAB * 28) * 0.30) WHEN LOWER(updated_zone) = \'ne&jk&zpecial zone\' THEN ((ROUNDEDSLAB * 29) + (ROUNDEDSLAB * 29) * 0.40) WHEN LOWER(updated_zone) = \'metro to metro\' THEN ((ROUNDEDSLAB * 25) + (ROUNDEDSLAB * 28) * 0.30) END WHEN COURIER_PARTNER = \'Bluedart\' AND PICKUP_DATE::DATE < \'2024-01-01\' THEN CASE WHEN LOWER(updated_zone) = \'intra city\' THEN (ROUNDEDSLAB * 22) WHEN LOWER(updated_zone) = \'intra region\' THEN (ROUNDEDSLAB * 24) WHEN LOWER(updated_zone) = \'roi\' THEN (ROUNDEDSLAB * 28) WHEN LOWER(updated_zone) = \'ne&jk&zpecial zone\' THEN (ROUNDEDSLAB * 46) WHEN LOWER(updated_zone) = \'metro to metro\' THEN (ROUNDEDSLAB * 25) END WHEN COURIER_PARTNER = \'Shiprocket\' AND LOWER(shipping_courier) LIKE \'Shadowfax NDD Air\' AND PICKUP_DATE::DATE >= \'2024-03-16\' THEN CASE WHEN LOWER(updated_zone) = \'c\' THEN (ROUNDEDSLAB * 36) END WHEN COURIER_PARTNER = \'Shiprocket\' THEN CASE WHEN LOWER(updated_zone) = \'a\' THEN (ROUNDEDSLAB * 27) WHEN LOWER(updated_zone) = \'b\' THEN (ROUNDEDSLAB * 31) WHEN LOWER(updated_zone) = \'c\' THEN (ROUNDEDSLAB * 37) WHEN LOWER(updated_zone) = \'d\' THEN (ROUNDEDSLAB * 42) WHEN LOWER(updated_zone) = \'e\' THEN (ROUNDEDSLAB * 69) END END AS Logistic_cost1 from (select cd.*, ud.*, case when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date >=\'2024-01-01\' and payment_method = \'COD\' then greatest(selling_price*1.25,22) when COURIER_PARTNER = \'Delhivery\' and PICKUP_DATE::date < \'2024-01-01\' and payment_method = \'COD\' then greatest(selling_price*1.20,25) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date >= \'2024-01-01\' and payment_method = \'COD\' then greatest(selling_price*1.50,30) when COURIER_PARTNER = \'Bluedart\' and PICKUP_DATE::date < \'2024-01-01\' and payment_method = \'COD\' then greatest(selling_price*1.50,30) when COURIER_PARTNER = \'Shiprocket\' and lower(shipping_courier) like \'Shadowfax NDD Air\' and PICKUP_DATE::date >=\'2024-03-16\' and payment_method = \'COD\' then greatest(selling_price*1.50,30) when COURIER_PARTNER = \'Shiprocket\' and payment_method = \'COD\' then greatest(selling_price*1.50,25) when payment_method = \'COD\' and selling_price*0.025>20 then selling_price*0.025 when payment_method = \'COD\' and selling_price*0.025<=20 then 20 else 0 end as Collection_fee from ClickPost_data cd left join unicommerce_data ud on cd.awb_number = ud.awb )lk left join SNITCH_DB.maplemonk.pincodemappingzoneupdated czm on czm.\"Delivery Postcode\" = lk.pincode and trim(lower(czm.\"Name \"),\' \') = trim(lower(lk.COURIER_PARTNER),\' \')",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from snitch_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        