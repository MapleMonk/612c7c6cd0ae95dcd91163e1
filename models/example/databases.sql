{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table snitch_db.maplemonk.shipping_timestamps_L7 as select a.order_name, a.order_id, a.shipping_package_code, a.quantity, a.created_timestamp, b.picking_timestamp, c.picked_timestamp, d.packed_timestamp, e.manifested_timestamp, f.dispatched_timestamp, g.ready_to_ship_timestamp, facility from ( (select \"Display Order Code\" order_name, \"Sale Order Code\" order_id, \"Shipping Package Code\" shipping_package_code, \"No. of Items\" quantity, to_timestamp(\"Time Stamp\") created_timestamp, case when lower(_AB_SOURCE_FILE_URL) like \'%sapl-wh%\' then \'SAPL-WH\' when lower(_AB_SOURCE_FILE_URL) like \'%sapl-sr%\' then \'SAPL-SR\' end as facility from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'CREATED\') a left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") picking_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'PICKING\') b on a.shipping_package_code = b.shipping_package_code left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") picked_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'PICKED\') c on a.shipping_package_code = c.shipping_package_code left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") packed_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'PACKED\') d on a.shipping_package_code = d.shipping_package_code left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") manifested_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'MANIFESTED\') e on a.shipping_package_code = e.shipping_package_code left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") dispatched_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'DISPATCHED\') f on a.shipping_package_code = f.shipping_package_code left join (select \"Shipping Package Code\" shipping_package_code, to_timestamp(\"Time Stamp\") ready_to_ship_timestamp from snitch_db.maplemonk.shipping_package_timeline_l7 where \"New Value\" = \'READY_TO_SHIP\') g on a.shipping_package_code = g.shipping_package_code ) ; create or replace table snitch_db.maplemonk.shipping_package_sla as select a.order_id, a.marketplace, a.awb, a.shippingpackagecode, a.fulfillment_tat, b.created_timestamp, b.picking_timestamp, b.picked_timestamp, b.packed_timestamp, b.ready_to_ship_timestamp, b.facility from( select replace(saleorderdto:code,\'\"\',\'\') as order_id, CONVERT_TIMEZONE(\'UTC\',\'Asia/Kolkata\',dateadd(\'ms\',saleorderdto:fulfillmentTat,\'1970-01-01\')) Fulfillment_tat, replace(saleorderdto:facilityName,\'\"\',\'\') Facility, replace(saleorderdto:channel,\'\"\',\'\') marketplace, replace(A.Value:trackingNumber,\'\"\',\'\') awb, replace(A.Value:code,\'\"\',\'\') as shippingPackageCode from snitch_db.maplemonk.SNITCH_UNICOMMERCE_GET_ORDERS_BY_IDS_TEST, LATERAL FLATTEN (INPUT => saleorderdto:shippingPackages)A where date(CONVERT_TIMEZONE(\'UTC\',\'Asia/Kolkata\',dateadd(\'ms\',saleorderdto:displayOrderDateTime,\'1970-01-01\')))::date >= getdate()::date - 1 ) a left join snitch_db.maplemonk.shipping_timestamps_L7 b on a.shippingPackageCode = b.shipping_package_code ;",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from snitch_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        