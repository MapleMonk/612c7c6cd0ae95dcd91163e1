{{ config(
                        materialized='table',
                            post_hook={
                                "sql": "create or replace table snitch_db.maplemonk.discoverability as ( with source_wise_clicks AS ( SELECT CAST(a.itemid AS VARCHAR) AS itemid, TO_DATE(a.date, \'YYYYMMDD\')::date AS formatted_date, \'web\' AS type, SUM(a.itemsviewed) AS clicks, a.sessionmedium, a.sessionsource, a.sessioncampaignname, COALESCE( CASE when lower(a.sessionsource) like \'%facebook%\' and lower(a.sessionmedium) = \'paid\' then \'Facebook_Ads\' when lower(a.sessionmedium) = \'affiliate\' then \'Affiliate\' when lower(a.sessionsource) = \'whatsapp\' and lower(a.sessionmedium) = \'sms\' then \'Whatsapp\' when lower(a.sessionsource) = \'email\' and lower (a.sessionmedium) = \'mailmodo\' then \'Email\' when lower(a.sessionsource) = \'google\' and lower(a.sessionmedium) = \'cpc\' then \'Google_Ads\' when lower(a.sessioncampaignname) = \'affiliate_bajaj\' then \'Affilliate\' when (lower(a.sessionsource) = \'bing\' or lower(a.sessionsource) = \'duckduckgo\' and lower(a.sessionsource) = \'yahoo\') and lower(a.sessionmedium) = \'organic\' then \'Direct\' when lower(a.sessionsource) = \'facebookads\' and a.sessionmedium = \'Custom Ads - Cost Cap - Prospect\' then \'Facebook_Ads\' when lower(a.sessionsource) = \'google\' and a.sessionmedium = \'cpc\' then \'Google_Ads\' when a.sessionsource = \'mailmodo\' and a.sessionsource = \'email_amp\' then \'Email\' when a.sessionsource = \'(not set)\' then \'Direct\' when a.sessionsource = \'Limechat\' and a.sessionmedium = \'Whatsapp\' then \'Direct\' when lower(a.sessionmedium) = \'referral\' then \'Direct\' when a.sessionmedium is null and a.sessionsource is null and a.sessioncampaignname is null then \'Direct\' when a.sessionmedium = \'(none)\' and a.sessionsource = \'(direct)\' then \'Direct\' when a.sessionsource = \'Facebookads\' then \'Facebook_ads\' when a.sessionmedium = \'Stories\' and a.sessionsource = \'Instagram\' then \'Direct\' when a.sessionmedium = \'WhatsApp\' and a.sessionsource = \'Limechat\' then \'Whatsapp\' when a.sessionmedium = \'cpc_EMAIL\' or sessionmedium = \'email_amp\' then \'Email\' when a.sessionmedium = \'organic\' then \'Direct\' when a.sessionmedium = \'SMS\' then \'SMS\' when a.sessionsource = \'criteo\' then \'Criteo\' when a.sessionmedium = \'email\' then \'Email\' ELSE b.channel END, b.channel ) AS channel FROM snitch_db.maplemonk.web_sku_group_clicks_source_medium a LEFT JOIN snitch_db.maplemonk.GA_CHANNEL_MAPPING b ON LOWER(a.sessionsource) = LOWER(b.source) AND LOWER(a.sessionmedium) = LOWER(b.medium) AND LOWER(a.sessioncampaignname) = LOWER(b.sessioncampaignname) GROUP BY CAST(a.itemid AS VARCHAR), type, a.sessionmedium, a.sessionsource, a.sessioncampaignname, b.channel, a.date UNION SELECT CAST(a.itemid AS VARCHAR) AS itemid, TO_DATE(a.date, \'YYYYMMDD\')::date AS formatted_date, \'app\' AS type, SUM(a.itemsviewed) AS clicks, a.sessionmedium, a.sessionsource, a.sessioncampaignname, COALESCE( CASE when lower(a.sessionsource) like \'%facebook%\' and lower(a.sessionmedium) = \'paid\' then \'Facebook_Ads\' when lower(a.sessionmedium) = \'affiliate\' then \'Affiliate\' when lower(a.sessionsource) = \'whatsapp\' and lower(a.sessionmedium) = \'sms\' then \'Whatsapp\' when lower(a.sessionsource) = \'email\' and lower (a.sessionmedium) = \'mailmodo\' then \'Email\' when lower(a.sessionsource) = \'google\' and lower(a.sessionmedium) = \'cpc\' then \'Google_Ads\' when lower(a.sessioncampaignname) = \'affiliate_bajaj\' then \'Affilliate\' when (lower(a.sessionsource) = \'bing\' or lower(a.sessionsource) = \'duckduckgo\' and lower(a.sessionsource) = \'yahoo\') and lower(a.sessionmedium) = \'organic\' then \'Direct\' when lower(a.sessionsource) = \'facebookads\' and a.sessionmedium = \'Custom Ads - Cost Cap - Prospect\' then \'Facebook_Ads\' when lower(a.sessionsource) = \'google\' and a.sessionmedium = \'cpc\' then \'Google_Ads\' when lower(a.sessionsource) = \'mailmodo\' then \'Email\' when a.sessionsource = \'(not set)\' then \'Direct\' when a.sessionsource = \'Limechat\' and a.sessionmedium = \'Whatsapp\' then \'Direct\' when a.sessionsource = \'direct\' then \'Direct\' when a.sessionsource = \'(direct)\' then \'Direct\' when a.sessionmedium is null and a.sessionsource is null and a.sessioncampaignname is null then \'Direct\' when a.sessionmedium = \'organic\' then \'Direct\' when a.sessionmedium = \'email_html\' and sessionsource = \'mailmodo\' then \'Email\' when a.sessionmedium = \'email\' then \'Email\' when a.sessionmedium = \'WhatsApp\' then \'WhatsApp\' when a.sessionmedium = \'SMS \' or a.sessionmedium = \'SMS\' then \'SMS\' when lower(a.sessionmedium) = \'push\' then \'Push\' when a.sessionsource = \'wishlink\' then \'Affiliate\' when a.sessionmedium = \'cpc_EMAIL\' or a.sessionmedium = \'Email\' then \'Email\' ELSE b.channel END, b.channel ) AS channel FROM snitch_db.maplemonk.app_sku_clicks_source_medium a LEFT JOIN snitch_db.maplemonk.app_mapping b ON LOWER(a.sessionsource) = LOWER(b.source) AND LOWER(a.sessionmedium) = LOWER(b.medium) AND LOWER(a.sessioncampaignname) = LOWER(b.sessioncampaignname) GROUP BY CAST(a.itemid AS VARCHAR), type, a.sessionmedium, a.sessionsource, a.sessioncampaignname, b.channel, a.date ) select type,formatted_date, COALESCE(channel, \'Others\') AS channel, CASE WHEN channel = \'Direct\' OR sessionmedium = \'organic\' THEN \'Organic\' ELSE \'Paid\' END AS source, sum(clicks) as clicks from source_wise_clicks group by 1,2,3,4 ); create or replace table snitch_db.maplemonk.banner_funnel_data as ( select to_date(date,\'YYYYMMDD\') as ga_date, itempromotionname as banner_name, itemsviewedinpromotion as views, itemsclickedinpromotion as clicks, itempromotionclickthroughrate as ctr from snitch_db.maplemonk.WEB_BANNER_VIEWS_CLICKS where banner_name != \'(not set)\' );",
                                "transaction": true
                            }
                        ) }}
                        with sample_data as (

                            select * from snitch_db.information_schema.databases
                        ),
                        
                        final as (
                            select * from sample_data
                        )
                        select * from final
                        